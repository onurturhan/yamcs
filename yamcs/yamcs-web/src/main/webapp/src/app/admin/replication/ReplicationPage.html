<app-admin-page>
  <app-admin-toolbar>
    Replication
  </app-admin-toolbar>

  <div class="panel-content">
    <h4>Inbound</h4>
    <ng-container *ngIf="hasSlaves$ | async; else nodata">
      <table mat-table [dataSource]="slavesDataSource" class="ya-data-table">

        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef class="status"></th>
          <td mat-cell *matCellDef="let slave" class="status">
            <app-replication-state [connected]="!!slave.localAddress && !!slave.remoteAddress"></app-replication-state>
          </td>
        </ng-container>

        <ng-container matColumnDef="instance">
          <th mat-header-cell *matHeaderCellDef style="width: 130px">Instance</th>
          <td mat-cell *matCellDef="let row">{{ row.instance }}</td>
        </ng-container>

        <ng-container matColumnDef="streams">
          <th mat-header-cell *matHeaderCellDef style="width: 250px">Streams</th>
          <td mat-cell *matCellDef="let row">{{ row.streams?.join(', ') || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="mode">
          <th mat-header-cell *matHeaderCellDef width="1">Mode</th>
          <td mat-cell *matCellDef="let row" style="text-align: center">
            {{ row.push ? 'PUSH' : 'PULL' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="localAddress">
          <th mat-header-cell *matHeaderCellDef>Local Address</th>
          <td mat-cell *matCellDef="let row">
            {{ row.localAddress || '-' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="remoteAddress">
          <th mat-header-cell *matHeaderCellDef>Remote Address</th>
          <td mat-cell *matCellDef="let row">
            {{ row.remoteAddress || '-' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="pullFrom">
          <th mat-header-cell *matHeaderCellDef style="width: 130px">Pull From</th>
          <td mat-cell *matCellDef="let row">{{ row.pullFrom || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="tx">
          <th mat-header-cell *matHeaderCellDef width="1">TX</th>
          <td mat-cell *matCellDef="let row">{{ (row.tx | number) || '-' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="slaveColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: slaveColumns;"></tr>
      </table>
    </ng-container>
    <p>&nbsp;</p>

    <div class="section-divider">
      <mat-divider></mat-divider>
    </div>
    <h4>Outbound</h4>
    <ng-container *ngIf="hasMasters$ | async; else nodata">
      <table mat-table [dataSource]="mastersDataSource" class="ya-data-table">

        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef class="status"></th>
          <td mat-cell *matCellDef="let master" class="status">
            <app-replication-state [connected]="!!master.localAddress && !!master.remoteAddress">
            </app-replication-state>
          </td>
        </ng-container>

        <ng-container matColumnDef="instance">
          <th mat-header-cell *matHeaderCellDef style="width: 130px">Instance</th>
          <td mat-cell *matCellDef="let row">{{ row.instance }}</td>
        </ng-container>

        <ng-container matColumnDef="streams">
          <th mat-header-cell *matHeaderCellDef style="width: 250px">Streams</th>
          <td mat-cell *matCellDef="let row">{{ row.streams?.join(', ') || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="mode">
          <th mat-header-cell *matHeaderCellDef width="1">Mode</th>
          <td mat-cell *matCellDef="let row" style="text-align: center">
            {{ row.push ? 'PUSH' : 'PULL' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="localAddress">
          <th mat-header-cell *matHeaderCellDef>Local Address</th>
          <td mat-cell *matCellDef="let row">
            {{ row.localAddress || '-' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="remoteAddress">
          <th mat-header-cell *matHeaderCellDef>Remote Address</th>
          <td mat-cell *matCellDef="let row">
            {{ row.remoteAddress || '-' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="pushTo">
          <th mat-header-cell *matHeaderCellDef style="width: 130px">Push To</th>
          <td mat-cell *matCellDef="let row">{{ row.pushTo || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="localTx">
          <th mat-header-cell *matHeaderCellDef width="1">Local&nbsp;TX</th>
          <td mat-cell *matCellDef="let row">{{ (row.localTx | number) || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="nextTx">
          <th mat-header-cell *matHeaderCellDef width="1">Next&nbsp;TX</th>
          <td mat-cell *matCellDef="let row">{{ (row.nextTx | number) || '-' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="masterColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: masterColumns;"></tr>
      </table>
    </ng-container>
  </div>
</app-admin-page>

<ng-template #nodata>
  <app-empty-message marginTop="0">Not configured</app-empty-message>
</ng-template>
