"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[67],{4898:(yl,_t,m)=>{m.r(_t),m.d(_t,{CommandingModule:()=>Tl});var oe=m(7573),h=m(1083),ce=m(7309),pt=m(4375),se=m(1943),le=m(9326),l=m(3075),r=m(8279),y=m(381),x=m(2134),t=m(5e3),I=m(4454),k=m(2313),A=m(8928),S=m(9140),H=m(3251);const re=function(){return{matrixParams:"exact",paths:"exact",queryParams:"ignored"}},gt=function(n){return{c:n}};let ft=(()=>{class n{constructor(e){this.yamcs=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-clearances-page-tabs"]],decls:7,vars:10,consts:[["mat-tab-nav-bar",""],["mat-tab-link","","routerLink","/commanding/clearances","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["rla","routerLinkActive"],["mat-tab-link","","routerLink","/commanding/clearances/log","routerLinkActive","",3,"active","queryParams"],["rlb","routerLinkActive"]],template:function(e,a){if(1&e&&(t.TgZ(0,"nav",0),t.TgZ(1,"a",1,2),t._uU(3," CLEARANCES "),t.qZA(),t.TgZ(4,"a",3,4),t._uU(6," ACTION LOG "),t.qZA(),t.qZA()),2&e){const o=t.MAs(2),c=t.MAs(5);t.xp6(1),t.Q6J("routerLinkActiveOptions",t.DdM(5,re))("active",o.isActive)("queryParams",t.VKq(6,gt,a.yamcs.context)),t.xp6(3),t.Q6J("active",c.isActive)("queryParams",t.VKq(8,gt,a.yamcs.context))}},directives:[H.BU,h.yS,H.Nj,h.Od],styles:[".mat-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0}),n})();var B=m(141),d=m(9808),R=m(4071),N=m(119),ht=m(5869);const me=["intervalSelect"];function ue(n,i){if(1&n){const e=t.EpF();t.ynx(0),t._UZ(1,"app-date-time-input",16),t._UZ(2,"app-date-time-input",17),t.TgZ(3,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().applyCustomDates()}),t._uU(4,"Apply"),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("disabled",e.filterForm.invalid)}}function de(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",19),t.NdJ("click",function(){return t.CHM(e),t.oxw().jumpToNow()}),t._uU(2," Jump to now "),t.qZA(),t.BQk()}}function _e(n,i){1&n&&(t.TgZ(0,"th",20),t._uU(1,"Time"),t.qZA())}function pe(n,i){if(1&n&&(t.TgZ(0,"td",21),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,e.time))}}function ge(n,i){1&n&&(t.TgZ(0,"th",20),t._uU(1,"User"),t.qZA())}function fe(n,i){if(1&n&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Oqu(e.user||"-")}}function he(n,i){1&n&&(t.TgZ(0,"th",20),t._uU(1,"Action"),t.qZA())}function xe(n,i){if(1&n&&(t.TgZ(0,"td",21),t._UZ(1,"span",22),t.ALo(2,"actionLogFormat"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,e.summary)||"-",t.oJD)}}function Te(n,i){1&n&&t._UZ(0,"th",23)}function Ze(n,i){1&n&&t._UZ(0,"td",21)}function ye(n,i){1&n&&t._UZ(0,"tr",24)}function Ce(n,i){1&n&&t._UZ(0,"tr",25)}let xt=(()=>{class n{constructor(e,a,o,c,s){this.yamcs=e,this.messageService=a,this.router=o,this.route=c,this.filterForm=new l.cw({filter:new l.NI,interval:new l.NI("NO_LIMIT"),customStart:new l.NI(null),customStop:new l.NI(null)}),this.displayedColumns=["time","user","summary","actions"],this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.dataSource=new r.by,s.setTitle("Clearances"),this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(u=>{if("CUSTOM"===u){const _=new Date,f=this.validStart||_,p=this.validStop||_;this.filterForm.get("customStart").setValue(x.Y6(f)),this.filterForm.get("customStop").setValue(x.Y6(p))}else"NO_LIMIT"===u?(this.validStart=null,this.validStop=null,this.appliedInterval=u,this.loadData()):(this.validStop=new Date,this.validStart=(0,x.rV)(this.validStop,u),this.appliedInterval=u,this.loadData())})}initializeOptions(){const e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),"CUSTOM"===this.appliedInterval){const a=e.get("customStart");this.filterForm.get("customStart").setValue(a),this.validStart=x.ZU(a);const o=e.get("customStop");this.filterForm.get("customStop").setValue(o),this.validStop=x.ZU(o)}else"NO_LIMIT"===this.appliedInterval?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=(0,x.rV)(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=x.ZU(this.filterForm.value.customStart),this.validStop=x.ZU(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();const e={service:"ClearanceApi"};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.filter&&(e.q=this.filter),this.yamcs.yamcsClient.getAuditRecords("_global",e).then(a=>this.dataSource.data=a.records||[]).catch(a=>this.messageService.showError(a))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,interval:this.appliedInterval,customStart:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStart:null,customStop:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C),t.Y36(I.e),t.Y36(h.F0),t.Y36(h.gz),t.Y36(k.Dx))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&t.Gf(me,5),2&e){let o;t.iGM(o=t.CRH())&&(a.intervalSelect=o.first)}},decls:26,vars:7,consts:[[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["intervalSelect",""],[4,"ngIf"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"disabled","click"],[1,"ya-button",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,a){1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Clearances "),t.qZA(),t.TgZ(3,"div",0),t._UZ(4,"app-clearances-page-tabs"),t.TgZ(5,"form",1),t.TgZ(6,"div",2),t._UZ(7,"app-select",3,4),t.YNc(9,ue,5,1,"ng-container",5),t.YNc(10,de,3,0,"ng-container",5),t.qZA(),t.qZA(),t.TgZ(11,"table",6),t.ynx(12,7),t.YNc(13,_e,2,0,"th",8),t.YNc(14,pe,3,3,"td",9),t.BQk(),t.ynx(15,10),t.YNc(16,ge,2,0,"th",8),t.YNc(17,fe,2,1,"td",9),t.BQk(),t.ynx(18,11),t.YNc(19,he,2,0,"th",8),t.YNc(20,xe,3,3,"td",9),t.BQk(),t.ynx(21,12),t.YNc(22,Te,1,0,"th",13),t.YNc(23,Ze,1,0,"td",9),t.BQk(),t.YNc(24,ye,1,0,"tr",14),t.YNc(25,Ce,1,0,"tr",15),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.Q6J("formGroup",a.filterForm),t.xp6(2),t.Q6J("options",a.intervalOptions),t.xp6(2),t.Q6J("ngIf","CUSTOM"===a.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf","CUSTOM"!==a.filterForm.value.interval),t.xp6(1),t.Q6J("dataSource",a.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns))},directives:[A.a,S.k,ft,l._Y,l.JL,l.sg,B.P,l.JJ,l.u,d.O5,R.Y,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk],pipes:[N.i,ht.N],encapsulation:2,changeDetection:0}),n})();var D=m(480);let be=(()=>{class n{constructor(e,a){this.router=a,this.config=e.getConfig()}canActivate(e,a){return this.config.commandClearanceEnabled}canActivateChild(e,a){return this.canActivate(e,a)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(D.E),t.LFG(h.F0))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var M=m(449),J=m(6087),O=m(4847),g=m(8966),Y=m(9006);let ve=(()=>{class n{constructor(e,a,o){this.dialogRef=e,this.data=o,this.form=a.group({level:new l.NI(null,[l.kI.required])}),o.clearance&&this.form.setValue({level:o.clearance.level||"DISABLED"})}confirm(){this.dialogRef.close({level:"DISABLED"===this.form.value.level?void 0:this.form.value.level})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so),t.Y36(l.qu),t.Y36(g.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-change-level-dialog"]],decls:31,vars:8,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","radio","formControlName","level","value","DISABLED"],[2,"font-weight","normal"],["type","radio","formControlName","level","value","NONE"],["level","NONE",3,"grayscale"],["type","radio","formControlName","level","value","WATCH"],["level","WATCH",3,"grayscale"],["type","radio","formControlName","level","value","WARNING"],["level","WARNING",3,"grayscale"],["type","radio","formControlName","level","value","DISTRESS"],["level","DISTRESS",3,"grayscale"],["type","radio","formControlName","level","value","CRITICAL"],["level","CRITICAL",3,"grayscale"],["type","radio","formControlName","level","value","SEVERE"],["level","SEVERE",3,"grayscale"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(e,a){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Command clearance"),t.qZA(),t.TgZ(2,"mat-dialog-content",1),t.TgZ(3,"form",2),t.TgZ(4,"label"),t._UZ(5,"input",3),t.TgZ(6,"span",4),t._uU(7,"No clearance"),t.qZA(),t.qZA(),t.TgZ(8,"label"),t._UZ(9,"input",5),t._UZ(10,"app-significance-level",6),t.qZA(),t.TgZ(11,"label"),t._UZ(12,"input",7),t._UZ(13,"app-significance-level",8),t.qZA(),t.TgZ(14,"label"),t._UZ(15,"input",9),t._UZ(16,"app-significance-level",10),t.qZA(),t.TgZ(17,"label"),t._UZ(18,"input",11),t._UZ(19,"app-significance-level",12),t.qZA(),t.TgZ(20,"label"),t._UZ(21,"input",13),t._UZ(22,"app-significance-level",14),t.qZA(),t.TgZ(23,"label"),t._UZ(24,"input",15),t._UZ(25,"app-significance-level",16),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"mat-dialog-actions",17),t.TgZ(27,"button",18),t._uU(28,"CANCEL"),t.qZA(),t.TgZ(29,"button",19),t.NdJ("click",function(){return a.confirm()}),t._uU(30,"SAVE CHANGES"),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("formGroup",a.form),t.xp6(7),t.Q6J("grayscale",!0),t.xp6(3),t.Q6J("grayscale",!0),t.xp6(3),t.Q6J("grayscale",!0),t.xp6(3),t.Q6J("grayscale",!0),t.xp6(3),t.Q6J("grayscale",!0),t.xp6(3),t.Q6J("grayscale",!0),t.xp6(4),t.Q6J("disabled",!a.form.valid))},directives:[g.uh,g.xY,l._Y,l.JL,l.sg,l._,l.Fj,l.JJ,l.u,Y.U,g.H8,g.ZT],styles:["[_ngcontent-%COMP%]:focus{outline:none}"]}),n})();var z=m(97),$=m(7423),v=m(3874),b=m(7587);function Ae(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"th",19),t.TgZ(1,"input",20),t.NdJ("change",function(o){t.CHM(e);const c=t.oxw(2);return o?c.masterToggle():null}),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("checked",e.selection.hasValue()&&e.isAllSelected())}}function Se(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"td",21),t.TgZ(1,"input",22),t.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const s=t.CHM(e).$implicit,u=t.oxw(2);return o?u.selection.toggle(s):null}),t.qZA(),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("checked",a.selection.isSelected(e))}}function ke(n,i){1&n&&(t.TgZ(0,"th",23),t._uU(1,"Username"),t.qZA())}function we(n,i){if(1&n&&(t.TgZ(0,"td",24),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.username," ")}}function qe(n,i){1&n&&(t.TgZ(0,"th",23),t._uU(1,"May Command"),t.qZA())}function Ne(n,i){1&n&&(t.TgZ(0,"mat-icon"),t._uU(1,"check"),t.qZA())}function Ue(n,i){1&n&&(t.TgZ(0,"mat-icon"),t._uU(1,"close"),t.qZA())}function Qe(n,i){if(1&n&&(t.TgZ(0,"td",24),t.YNc(1,Ne,2,0,"mat-icon",25),t.YNc(2,Ue,2,0,"mat-icon",25),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.hasCommandPrivileges),t.xp6(1),t.Q6J("ngIf",!e.hasCommandPrivileges)}}function Pe(n,i){1&n&&(t.TgZ(0,"th",23),t._uU(1,"Clearance Level"),t.qZA())}function Ie(n,i){1&n&&(t.ynx(0),t._uU(1,"No clearance"),t.BQk())}function De(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-significance-level",26),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("level",e.level)("grayscale",!0)}}function Je(n,i){if(1&n&&(t.TgZ(0,"td",24),t.YNc(1,Ie,2,0,"ng-container",25),t.YNc(2,De,2,2,"ng-container",25),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",!e.level),t.xp6(1),t.Q6J("ngIf",e.level)}}function Oe(n,i){1&n&&(t.TgZ(0,"th",23),t._uU(1,"Issued"),t.qZA())}function Ye(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" by ",e.issuedBy," ")}}function Fe(n,i){if(1&n&&(t.TgZ(0,"td",24),t._uU(1),t.ALo(2,"datetime"),t.YNc(3,Ye,2,1,"ng-container",25),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,2,e.issueTime)||"-"," "),t.xp6(2),t.Q6J("ngIf",e.issuedBy)}}function Me(n,i){1&n&&t._UZ(0,"th",27)}function $e(n,i){1&n&&t._UZ(0,"td",28)}function Ee(n,i){1&n&&t._UZ(0,"tr",29)}function Le(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr",30),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).toggleOne(c)}),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw(2);t.ekj("selected",a.selection.isSelected(e))}}function He(n,i){if(1&n&&(t.TgZ(0,"table",4),t.ynx(1,5),t.YNc(2,Ae,2,1,"th",6),t.YNc(3,Se,2,1,"td",7),t.BQk(),t.ynx(4,8),t.YNc(5,ke,2,0,"th",9),t.YNc(6,we,2,1,"td",10),t.BQk(),t.ynx(7,11),t.YNc(8,qe,2,0,"th",9),t.YNc(9,Qe,3,2,"td",10),t.BQk(),t.ynx(10,12),t.YNc(11,Pe,2,0,"th",9),t.YNc(12,Je,3,2,"td",10),t.BQk(),t.ynx(13,13),t.YNc(14,Oe,2,0,"th",9),t.YNc(15,Fe,4,4,"td",10),t.BQk(),t.ynx(16,14),t.YNc(17,Me,1,0,"th",15),t.YNc(18,$e,1,0,"td",16),t.BQk(),t.YNc(19,Ee,1,0,"tr",17),t.YNc(20,Le,1,2,"tr",18),t.qZA()),2&n){const e=t.oxw();t.Q6J("dataSource",e.dataSource),t.xp6(19),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns)}}let Tt=(()=>{class n{constructor(e,a,o){this.yamcs=e,this.dialog=o,this.displayedColumns=["select","username","hasCommandPrivileges","level","issued","actions"],this.dataSource=new r.by,this.selection=new M.Ov(!0,[]),a.setTitle("Clearances"),this.refresh()}ngAfterViewInit(){this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator}isAllSelected(){return this.selection.selected.length===this.dataSource.data.length}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e))}toggleOne(e){(!this.selection.isSelected(e)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(e)}refresh(){this.selection.clear(),this.yamcs.yamcsClient.getClearances().then(e=>{this.dataSource.data=e.clearances||[]})}isGroupChangeLevelEnabled(){return!this.selection.isEmpty()}openChangeLevelDialog(){let e;1===this.selection.selected.length&&(e=this.selection.selected[0]),this.dialog.open(ve,{data:{clearance:e},width:"400px"}).afterClosed().subscribe(o=>{if(o){const c=[];if(o.level)for(const s of this.selection.selected)c.push(this.yamcs.yamcsClient.changeClearance(s.username,{level:o.level}));else for(const s of this.selection.selected)c.push(this.yamcs.yamcsClient.deleteClearance(s.username));c.length&&Promise.all(c).then(()=>this.refresh())}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C),t.Y36(k.Dx),t.Y36(g.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&(t.Gf(O.YE,5),t.Gf(J.NW,5)),2&e){let o;t.iGM(o=t.CRH())&&(a.sort=o.first),t.iGM(o=t.CRH())&&(a.paginator=o.first)}},decls:17,vars:5,consts:[["mat-button","","color","primary",3,"disabled","click"],[1,"panel-content"],["mat-table","","matSort","","class","ya-data-table expand","style","margin-top: 16px","matSortActive","username","matSortDirection","asc","matSortDisableClear","",3,"dataSource",4,"ngIf"],[3,"pageSize","hidePageSize","showFirstLastButtons"],["mat-table","","matSort","","matSortActive","username","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",2,"margin-top","16px",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","username"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","hasCommandPrivileges"],["matColumnDef","level"],["matColumnDef","issued"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","expand",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[4,"ngIf"],[3,"level","grayscale"],["mat-header-cell",""],["mat-cell","",1,"expand"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Clearances "),t.TgZ(3,"app-help"),t.TgZ(4,"p"),t._uU(5,"Clearances allow central control over the level of commands that users are able to send."),t.qZA(),t.TgZ(6,"p"),t._uU(7," Clearance works in addition to regular permission checks. So if a user does anyway not have authorization to send certain commands, giving this user clearance will not change this fact. "),t.qZA(),t.qZA(),t._uU(8," \xa0\xa0\xa0 "),t.TgZ(9,"button",0),t.NdJ("click",function(){return a.openChangeLevelDialog()}),t.TgZ(10,"mat-icon"),t._uU(11,"how_to_reg"),t.qZA(),t._uU(12," CHANGE LEVEL "),t.qZA(),t.qZA(),t.TgZ(13,"div",1),t._UZ(14,"app-clearances-page-tabs"),t.YNc(15,He,21,3,"table",2),t._UZ(16,"mat-paginator",3),t.qZA(),t.qZA()),2&e&&(t.xp6(9),t.Q6J("disabled",!a.isGroupChangeLevelEnabled()),t.xp6(6),t.Q6J("ngIf",a.dataSource),t.xp6(1),t.Q6J("pageSize",100)("hidePageSize",!0)("showFirstLastButtons",!0))},directives:[A.a,S.k,z.W,$.lW,v.Hw,ft,d.O5,r.BZ,O.YE,b.fo,b.D5,r.ge,b.O_,r.ev,r.w1,r.fO,O.nU,r.Dz,Y.U,r.as,r.XQ,r.nj,r.Gk,J.NW],pipes:[N.i],encapsulation:2,changeDetection:0}),n})();var T=m(1135),Be=m(8372),Re=m(4e3),E=m(1731);class je{constructor(){this.dirty=!1,this.archiveRecords=[]}addArchiveData(i){this.archiveRecords=this.archiveRecords.concat(i),this.dirty=!0}reset(){this.archiveRecords=[],this.dirty=!0}snapshot(){return this.archiveRecords}}class F{constructor(i){this.assignments=[],this.userAssignments=[],this.extraAcks=[],this.extra=[],this.acksByName={},this.entry=i,this.id=i.id,this.generationTime=i.generationTime,this.origin=i.origin,this.sequenceNumber=i.sequenceNumber,this.commandName=i.commandName;for(const e of i.assignments||[])this.assignments.push(e),e.userInput&&this.userAssignments.push(e);for(const e of i.attr)if("username"===e.name)this.username=e.value.stringValue;else if("source"!==e.name)if("binary"===e.name)this.binary=e.value.binaryValue;else if("comment"===e.name)this.comment=e.value.stringValue;else if("queue"===e.name)this.queue=e.value.stringValue;else if(e.name.endsWith("_Message")){const a=e.name.substring(0,e.name.length-"_Message".length);this.saveAckMessage(a,e.value.stringValue)}else if(e.name.endsWith("_Time")){const a=e.name.substring(0,e.name.length-"_Time".length);this.saveAckTime(a,e.value.stringValue)}else if(e.name.endsWith("_Status")){const a=e.name.substring(0,e.name.length-"_Status".length);this.saveAckStatus(a,e.value.stringValue)}else this.extra.push({name:e.name,value:x.c7(e.value)});for(const e of Object.values(this.acksByName))"CommandComplete"===e.name?this.completed=e:"TransmissionConstraints"===e.name?this.transmissionConstraints=e:"Acknowledge_Queued"===e.name?this.queued=e:"Acknowledge_Released"===e.name?this.released=e:"Acknowledge_Sent"===e.name?this.sent=e:this.extraAcks.push(e)}mergeEntry(i){const e=[...this.entry.attr,...i.attr],a=Object.assign(Object.assign(Object.assign({},i),this.entry),{attr:e});return new F(a)}saveAckTime(i,e){let a=null;for(const o in this.acksByName)if(o===i){a=this.acksByName[o];break}a||(a={name:i},this.acksByName[i]=a),a.time=e}saveAckStatus(i,e){let a=null;for(const o in this.acksByName)if(o===i){a=this.acksByName[o];break}a||(a={name:i},this.acksByName[i]=a),a.status=e}saveAckMessage(i,e){let a=null;for(const o in this.acksByName)if(o===i){a=this.acksByName[o];break}a||(a={name:i},this.acksByName[i]=a),a.message=e}}var Zt=function(n,i,e,a){return new(e||(e=Promise))(function(c,s){function u(p){try{f(a.next(p))}catch(Z){s(Z)}}function _(p){try{f(a.throw(p))}catch(Z){s(Z)}}function f(p){p.done?c(p.value):function o(c){return c instanceof e?c:new e(function(s){s(c)})}(p.value).then(u,_)}f((a=a.apply(n,i||[])).next())})};class Ve extends M.o2{constructor(i,e){super(),this.yamcs=i,this.pageSize=100,this.blockHasMore=!1,this.records$=new T.X([]),this.loading$=new T.X(!1),this.syncSubscription=e.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.records$.next(this.buffer.snapshot()),this.buffer.dirty=!1)}),this.buffer=new je}connect(){return this.records$}loadEntries(i){return this.loading$.next(!0),this.loadPage(Object.assign(Object.assign({},i),{limit:this.pageSize})).then(e=>{this.buffer.reset(),this.blockHasMore=!1,this.buffer.addArchiveData(e.map(a=>new F(a)))}).finally(()=>{this.loading$.next(!1)})}hasMore(){return!!this.continuationToken&&!this.blockHasMore}loadPage(i){return Zt(this,void 0,void 0,function*(){return this.yamcs.yamcsClient.getCommandHistoryEntries(this.yamcs.instance,i).then(e=>(this.continuationToken=e.continuationToken,e.entry||[]))})}loadMoreData(i){return Zt(this,void 0,void 0,function*(){if(this.continuationToken)return this.loadPage(Object.assign(Object.assign({},i),{next:this.continuationToken,limit:this.pageSize})).then(e=>{this.buffer.addArchiveData(e.map(a=>new F(a)))})})}disconnect(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.records$.complete(),this.loading$.complete()}isEmpty(){return!this.records$.getValue().length}}var Ge=m(9177),U=m(4834),w=m(7238);function We(n,i){if(1&n&&(t.TgZ(0,"mat-icon",7),t._uU(1,"schedule"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": Scheduled")}}function ze(n,i){if(1&n&&(t.TgZ(0,"mat-icon",8),t._uU(1,"check_circle_outline"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": OK")}}function Xe(n,i){if(1&n&&(t.TgZ(0,"mat-icon",7),t._uU(1,"lens"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": PENDING")}}function Ke(n,i){if(1&n&&(t.TgZ(0,"mat-icon",9),t._uU(1,"block"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": CANCELLED")}}function tn(n,i){if(1&n&&(t.TgZ(0,"mat-icon",9),t._uU(1,"block"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": DISABLED")}}function en(n,i){if(1&n&&(t.TgZ(0,"mat-icon",10),t._uU(1,"highlight_off"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": TIMEOUT")}}function nn(n,i){if(1&n&&(t.TgZ(0,"mat-icon",10),t._uU(1,"highlight_off"),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip",e.ack.name+": "+e.ack.status+" ("+e.ack.message+")")}}function an(n,i){if(1&n&&(t.ynx(0),t.ynx(1,1),t.YNc(2,We,2,1,"mat-icon",2),t.YNc(3,ze,2,1,"mat-icon",3),t.YNc(4,Xe,2,1,"mat-icon",2),t.YNc(5,Ke,2,1,"mat-icon",4),t.YNc(6,tn,2,1,"mat-icon",4),t.YNc(7,en,2,1,"mat-icon",5),t.YNc(8,nn,2,1,"mat-icon",6),t.BQk(),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngSwitch",e.ack.status),t.xp6(1),t.Q6J("ngSwitchCase","SCHEDULED"),t.xp6(1),t.Q6J("ngSwitchCase","OK"),t.xp6(1),t.Q6J("ngSwitchCase","PENDING"),t.xp6(1),t.Q6J("ngSwitchCase","CANCELLED"),t.xp6(1),t.Q6J("ngSwitchCase","DISABLED"),t.xp6(1),t.Q6J("ngSwitchCase","TIMEOUT")}}function on(n,i){1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",11),t._uU(2,"lens"),t.qZA(),t.BQk()),2&n&&(t.xp6(1),t.Q6J("matTooltip","Unknown"))}let X=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-acknowledgment-icon"]],inputs:{ack:"ack"},decls:2,vars:2,consts:[[4,"ngIf"],[3,"ngSwitch"],["class","icon16 down",3,"matTooltip",4,"ngSwitchCase"],["class","icon16","style","color: #00c752",3,"matTooltip",4,"ngSwitchCase"],["class","icon16","style","color: lightgrey",3,"matTooltip",4,"ngSwitchCase"],["class","icon16","style","color: red",3,"matTooltip",4,"ngSwitchCase"],["class","icon16","style","color: red",3,"matTooltip",4,"ngSwitchDefault"],[1,"icon16","down",3,"matTooltip"],[1,"icon16",2,"color","#00c752",3,"matTooltip"],[1,"icon16",2,"color","lightgrey",3,"matTooltip"],[1,"icon16",2,"color","red",3,"matTooltip"],[1,"down","icon16",3,"matTooltip"]],template:function(e,a){1&e&&(t.YNc(0,an,9,7,"ng-container",0),t.YNc(1,on,3,1,"ng-container",0)),2&e&&(t.Q6J("ngIf",a.ack),t.xp6(1),t.Q6J("ngIf",!a.ack))},directives:[d.O5,d.RF,d.n9,v.Hw,w.gM,d.ED],styles:["[_nghost-%COMP%]{line-height:0;font-size:0}"],changeDetection:0}),n})();function cn(n,i){1&n&&(t.TgZ(0,"mat-icon",3),t._uU(1,"cached "),t.qZA())}function sn(n,i){1&n&&(t.TgZ(0,"mat-icon",4),t._uU(1,"lens"),t.qZA())}let yt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-transmission-constraints-icon"]],inputs:{command:"command"},decls:3,vars:2,consts:[[3,"ngSwitch"],["class","down icon16 spin","matTooltip","Checking transmission constraints",4,"ngSwitchCase"],["class","down icon16",4,"ngSwitchDefault"],["matTooltip","Checking transmission constraints",1,"down","icon16","spin"],[1,"down","icon16"]],template:function(e,a){1&e&&(t.ynx(0,0),t.YNc(1,cn,2,0,"mat-icon",1),t.YNc(2,sn,2,0,"mat-icon",2),t.BQk()),2&e&&(t.Q6J("ngSwitch",null==a.command||null==a.command.transmissionConstraints?null:a.command.transmissionConstraints.status),t.xp6(1),t.Q6J("ngSwitchCase","PENDING"))},directives:[d.RF,d.n9,v.Hw,w.gM,d.ED],styles:["[_nghost-%COMP%]{line-height:0;font-size:0}.spin[_ngcontent-%COMP%]{animation:yspin 2s infinite linear}"],changeDetection:0}),n})();var Ct=m(2768);function ln(n,i){if(1&n&&(t.TgZ(0,"td",5),t.TgZ(1,"div",6),t._UZ(2,"app-acknowledgment-icon",7),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ack",e.command.queued)}}function rn(n,i){if(1&n&&t._UZ(0,"app-transmission-constraints-icon",10),2&n){const e=t.oxw(3);t.Q6J("command",e.command)}}function mn(n,i){if(1&n&&t._UZ(0,"app-acknowledgment-icon",7),2&n){const e=t.oxw(3);t.Q6J("ack",e.command.released)}}function un(n,i){if(1&n&&(t.TgZ(0,"td"),t.TgZ(1,"div",6),t.YNc(2,rn,1,1,"app-transmission-constraints-icon",8),t.YNc(3,mn,1,1,"app-acknowledgment-icon",9),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ngIf",!e.command.released),t.xp6(1),t.Q6J("ngIf",e.command.released)}}function dn(n,i){if(1&n&&(t.TgZ(0,"td"),t.TgZ(1,"div",6),t._UZ(2,"app-acknowledgment-icon",7),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ack",e.command.sent)}}function _n(n,i){if(1&n&&(t.TgZ(0,"table"),t.TgZ(1,"tr"),t.YNc(2,ln,3,1,"td",1),t.TgZ(3,"td",2),t._uU(4,"Queued"),t.qZA(),t.TgZ(5,"td",3),t._uU(6),t.qZA(),t.TgZ(7,"td"),t.TgZ(8,"span",4),t._uU(9),t.ALo(10,"deltaWith"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"tr"),t.YNc(12,un,4,2,"td",0),t.TgZ(13,"td"),t._uU(14,"Released"),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t.TgZ(18,"span",4),t._uU(19),t.ALo(20,"deltaWith"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(21,"tr"),t.YNc(22,dn,3,1,"td",0),t.TgZ(23,"td"),t._uU(24,"Sent"),t.qZA(),t.TgZ(25,"td"),t._uU(26),t.qZA(),t.TgZ(27,"td"),t.TgZ(28,"span",4),t._uU(29),t.ALo(30,"deltaWith"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",e.showIcons),t.xp6(4),t.Oqu((null==e.command.queued?null:e.command.queued.status)||"-"),t.xp6(2),t.Q6J("matTooltip",null==e.command.queued?null:e.command.queued.time),t.xp6(1),t.hij(" ",t.xi3(10,12,null==e.command.queued?null:e.command.queued.time,e.command.generationTime)||"-"," "),t.xp6(3),t.Q6J("ngIf",e.showIcons),t.xp6(4),t.hij(" ",(null==e.command.released?null:e.command.released.status)||(null==e.command.transmissionConstraints?null:e.command.transmissionConstraints.status)||"-"," "),t.xp6(2),t.Q6J("matTooltip",null==e.command.released?null:e.command.released.time),t.xp6(1),t.hij(" ",t.xi3(20,15,null==e.command.released?null:e.command.released.time,e.command.generationTime)||"-"," "),t.xp6(3),t.Q6J("ngIf",e.showIcons),t.xp6(4),t.Oqu((null==e.command.sent?null:e.command.sent.status)||"-"),t.xp6(2),t.Q6J("matTooltip",null==e.command.sent?null:e.command.sent.time),t.xp6(1),t.hij(" ",t.xi3(30,18,null==e.command.sent?null:e.command.sent.time,e.command.generationTime)||"-"," ")}}let bt=(()=>{class n{constructor(){this.inline=!1,this.showIcons=!0}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-yamcs-acknowledgments-table"]],inputs:{command:"command",inline:"inline",showIcons:"showIcons"},decls:1,vars:1,consts:[[4,"ngIf"],["style","width: 16px",4,"ngIf"],[2,"width","150px"],[2,"width","70px"],[3,"matTooltip"],[2,"width","16px"],[2,"display","flex","align-items","center"],[3,"ack"],[3,"command",4,"ngIf"],[3,"ack",4,"ngIf"],[3,"command"]],template:function(e,a){1&e&&t.YNc(0,_n,31,21,"table",0),2&e&&t.Q6J("ngIf",a.command)},directives:[d.O5,X,w.gM,yt],pipes:[Ct.m],styles:["table[_ngcontent-%COMP%]{width:auto}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none;padding:0}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child){padding-left:10px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;line-height:16px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#000000a7}"],changeDetection:0}),n})();function pn(n,i){if(1&n&&(t.TgZ(0,"td",7),t.TgZ(1,"div",8),t._UZ(2,"app-acknowledgment-icon",9),t.qZA(),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("ack",e)}}function gn(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1,"-"),t.qZA())}function fn(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1,"-"),t.qZA())}function hn(n,i){if(1&n&&(t.TgZ(0,"span",10),t._uU(1),t.ALo(2,"deltaWith"),t.qZA()),2&n){const e=t.oxw().$implicit,a=t.oxw();t.Q6J("matTooltip",e.time),t.xp6(1),t.hij(" ",t.xi3(2,2,e.time,a.command.generationTime)," ")}}function xn(n,i){if(1&n&&(t.TgZ(0,"tr"),t.YNc(1,pn,3,1,"td",1),t.TgZ(2,"td",2),t._uU(3),t.qZA(),t.TgZ(4,"td",3),t._uU(5),t.qZA(),t.TgZ(6,"td"),t.ynx(7,4),t.YNc(8,gn,2,0,"span",5),t.YNc(9,fn,2,0,"span",5),t.YNc(10,hn,3,5,"span",6),t.BQk(),t.qZA(),t.qZA()),2&n){const e=i.$implicit,a=t.oxw();t.xp6(1),t.Q6J("ngIf",a.showIcons),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.status),t.xp6(2),t.Q6J("ngSwitch",e.status),t.xp6(1),t.Q6J("ngSwitchCase","SCHEDULED"),t.xp6(1),t.Q6J("ngSwitchCase","PENDING")}}let vt=(()=>{class n{constructor(){this.inline=!1,this.showIcons=!0}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-extra-acknowledgments-table"]],inputs:{command:"command",inline:"inline",showIcons:"showIcons"},decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["style","width: 16px",4,"ngIf"],[2,"width","150px"],[2,"width","70px"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"matTooltip",4,"ngSwitchDefault"],[2,"width","16px"],[2,"display","flex","align-items","center"],[3,"ack"],[3,"matTooltip"]],template:function(e,a){1&e&&(t.TgZ(0,"table"),t.YNc(1,xn,11,6,"tr",0),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",a.command.extraAcks))},directives:[d.sg,d.O5,X,d.RF,d.n9,d.ED,w.gM],pipes:[Ct.m],styles:["table[_ngcontent-%COMP%]{width:auto}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none;padding:0}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(:first-child){padding-left:10px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;line-height:16px}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:#000000a7}"],changeDetection:0}),n})();var K=m(496),Tn=m(6258);function Zn(n,i){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td",9),t._uU(2),t.qZA(),t.TgZ(3,"td",10),t._uU(4),t.ALo(5,"value"),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(t.lcZ(5,2,e.value))}}function yn(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",2),t._uU(2,"Binary"),t.qZA(),t.TgZ(3,"div",11),t._UZ(4,"app-hex",12),t.qZA(),t.TgZ(5,"div",13),t._uU(6),t.ALo(7,"hex"),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("base64String",e.command.binary),t.xp6(2),t.hij(" ",t.lcZ(7,2,e.command.binary)||"-"," ")}}function Cn(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.hij("@",e.command.origin," ")}}function bn(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",2),t._uU(2,"Queue"),t.qZA(),t.TgZ(3,"div",1),t._uU(4),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(4),t.hij(" ",e.command.queue||"-"," ")}}function vn(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"mat-divider",7),t.TgZ(2,"div",0),t._uU(3,"Comment"),t.qZA(),t.TgZ(4,"div",1),t._uU(5),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(5),t.hij(" ",e.command.comment," ")}}function An(n,i){if(1&n&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.AsE("",e.name,": ",e.value,"")}}function Sn(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"mat-divider",7),t.TgZ(2,"div",0),t._uU(3,"Extra attributes"),t.qZA(),t.TgZ(4,"div",1),t.TgZ(5,"ul"),t.YNc(6,An,2,2,"li",5),t.qZA(),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngForOf",e.command.extra)}}function kn(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",2),t._uU(2,"Extra acknowledgments"),t.qZA(),t.TgZ(3,"div",1),t._UZ(4,"app-extra-acknowledgments-table",8),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("command",e.command)("showIcons",e.showIcons)}}function wn(n,i){1&n&&(t.ynx(0),t._uU(1,"SUCCESS"),t.BQk())}function qn(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.hij(" FAILURE: ",null==e.command.completed?null:e.command.completed.message," ")}}function Nn(n,i){1&n&&(t.ynx(0),t._uU(1,"-"),t.BQk())}let tt=(()=>{class n{constructor(){this.showIcons=!0}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-command-detail2"]],inputs:{command:"command",showIcons:"showIcons"},decls:37,vars:18,consts:[[1,"block-title",2,"padding-top","0"],[1,"block"],[1,"block-title"],[1,"block","command-text"],[1,"args"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"margin-top","1em","margin-bottom","1em"],[3,"command","showIcons"],["width","1",1,"key"],[1,"value"],[1,"block","no-print"],[3,"base64String"],[1,"block","print-only"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0),t._uU(1,"ID"),t.qZA(),t.TgZ(2,"div",1),t._uU(3),t.qZA(),t.TgZ(4,"div",2),t._uU(5,"Command"),t.qZA(),t.TgZ(6,"div",3),t._uU(7),t.TgZ(8,"table",4),t.YNc(9,Zn,6,4,"tr",5),t.qZA(),t.qZA(),t.YNc(10,yn,8,4,"ng-container",6),t._UZ(11,"mat-divider",7),t.TgZ(12,"div",0),t._uU(13,"Time"),t.qZA(),t.TgZ(14,"div",1),t._uU(15),t.ALo(16,"datetime"),t.qZA(),t.TgZ(17,"div",2),t._uU(18,"Issuer"),t.qZA(),t.TgZ(19,"div",1),t._uU(20),t.YNc(21,Cn,2,1,"ng-container",6),t.qZA(),t.YNc(22,bn,5,1,"ng-container",6),t.YNc(23,vn,6,1,"ng-container",6),t.YNc(24,Sn,7,1,"ng-container",6),t._UZ(25,"mat-divider",7),t.TgZ(26,"div",0),t._uU(27,"Yamcs acknowledgments"),t.qZA(),t.TgZ(28,"div",1),t._UZ(29,"app-yamcs-acknowledgments-table",8),t.qZA(),t.YNc(30,kn,5,2,"ng-container",6),t.TgZ(31,"div",2),t._uU(32,"Completion"),t.qZA(),t.TgZ(33,"div",1),t.YNc(34,wn,2,0,"ng-container",6),t.YNc(35,qn,2,1,"ng-container",6),t.YNc(36,Nn,2,0,"ng-container",6),t.qZA()),2&e&&(t.xp6(3),t.hij(" ",a.command.id,"\n"),t.xp6(4),t.hij(" ",a.command.commandName," "),t.xp6(2),t.Q6J("ngForOf",a.command.userAssignments),t.xp6(1),t.Q6J("ngIf",a.command.binary),t.xp6(5),t.hij(" ",t.lcZ(16,16,a.command.generationTime),"\n"),t.xp6(5),t.hij(" ",a.command.username,""),t.xp6(1),t.Q6J("ngIf",a.command.origin),t.xp6(1),t.Q6J("ngIf",a.command.queue),t.xp6(1),t.Q6J("ngIf",a.command.comment),t.xp6(1),t.Q6J("ngIf",a.command.extra.length),t.xp6(5),t.Q6J("command",a.command)("showIcons",a.showIcons),t.xp6(1),t.Q6J("ngIf",a.command.extraAcks.length),t.xp6(4),t.Q6J("ngIf","OK"===(null==a.command.completed?null:a.command.completed.status)),t.xp6(1),t.Q6J("ngIf","NOK"===(null==a.command.completed?null:a.command.completed.status)),t.xp6(1),t.Q6J("ngIf",!a.command.completed))},directives:[d.sg,d.O5,Ge.p,U.d,bt,vt],pipes:[K.V,Tn.l,N.i],styles:[".step[_ngcontent-%COMP%]{margin-right:8px}.step.mat-icon[_ngcontent-%COMP%]{font-size:14px!important;vertical-align:middle}.command-text[_ngcontent-%COMP%]{font-size:10px;line-height:12px;font-family:Roboto Mono,monospace}.command-text[_ngcontent-%COMP%]   .args[_ngcontent-%COMP%]{margin:0 0 0 10px}.command-text[_ngcontent-%COMP%]   .args[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{min-width:120px;white-space:nowrap}.command-text[_ngcontent-%COMP%]   .args[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:gray;padding-left:10px}"],changeDetection:0}),n})();function Un(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-command-detail2",1),t._UZ(2,"div",2),t.BQk()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("command",e)("showIcons",!1)}}let Qn=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-command-history-printable"]],inputs:{pageTitle:"pageTitle",data:"data"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"command","showIcons"],[2,"page-break-after","always"]],template:function(e,a){1&e&&t.YNc(0,Un,3,2,"ng-container",0),2&e&&t.Q6J("ngForOf",a.data)},directives:[d.sg,tt],encapsulation:2,changeDetection:0}),n})();var Pn=m(3480),At=m(5328),In=m(9287),q=m(2181),St=m(3284),kt=m(3156),et=m(9971),nt=m(4574),Dn=m(729),wt=m(8726),at=m(8493),Jn=m(490),Q=m(4594);let qt=(()=>{class n{constructor(e){this.yamcs=e}transform(e){return e?this.yamcs.yamcsClient.getCommandDownloadURL(this.yamcs.instance,e.id):null}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C,16))},n.\u0275pipe=t.Yjl({name:"commandDownloadLink",type:n,pure:!0}),n})();const On=["intervalSelect"];function Yn(n,i){if(1&n&&(t.TgZ(0,"button",10),t.ALo(1,"async"),t.TgZ(2,"mat-icon"),t._uU(3,"save_alt"),t.qZA(),t._uU(4," EXPORT "),t.qZA()),2&n){const e=t.oxw(),a=t.MAs(4);let o;t.Q6J("matMenuTriggerFor",a)("disabled",!(null!=(o=t.lcZ(1,2,e.dataSource.records$))&&o.length))}}const Nt=function(n){return["/commanding/send",n]},Ut=function(n,i){return{c:n,template:i}};function Fn(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"br"),t._UZ(2,"mat-divider"),t._UZ(3,"br"),t.TgZ(4,"button",14),t._uU(5," Resend "),t.qZA(),t.BQk()),2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(4),t.Q6J("routerLink",t.VKq(2,Nt,null==e?null:e.commandName))("queryParams",t.WLB(4,Ut,a.yamcs.context,null==e?null:e.id))}}function Mn(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"app-detail-toolbar"),t._uU(2," Command Detail "),t.qZA(),t.TgZ(3,"div",11),t._UZ(4,"app-command-detail2",12),t.YNc(5,Fn,6,7,"ng-container",13),t.TgZ(6,"p"),t._uU(7,"\xa0"),t.qZA(),t.qZA(),t.BQk()),2&n){const e=i.ngIf,a=t.oxw();t.xp6(4),t.Q6J("command",e),t.xp6(1),t.Q6J("ngIf",a.showResend())}}function $n(n,i){1&n&&(t.TgZ(0,"app-detail-toolbar"),t._uU(1," Select a command "),t.qZA())}function En(n,i){if(1&n){const e=t.EpF();t.ynx(0),t._UZ(1,"app-date-time-input",58),t._UZ(2,"app-date-time-input",59),t.TgZ(3,"button",57),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).applyCustomDates()}),t._uU(4,"Apply"),t.qZA(),t.BQk()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("disabled",e.filterForm.invalid)}}function Ln(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",60),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).jumpToNow()}),t._uU(2," Jump to now "),t.qZA(),t.BQk()}}function Hn(n,i){1&n&&t._UZ(0,"app-dots")}function Bn(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1," Showing entries from "),t.TgZ(2,"b"),t._uU(3,"the last hour"),t.qZA(),t._uU(4," ending at "),t.TgZ(5,"b"),t._uU(6),t.ALo(7,"datetime"),t.qZA(),t._uU(8," (Mission Time) "),t.qZA()),2&n){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,1,e.validStop))}}function Rn(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1," Showing entries from "),t.TgZ(2,"b"),t._uU(3,"the last 6 hours"),t.qZA(),t._uU(4," ending at "),t.TgZ(5,"b"),t._uU(6),t.ALo(7,"datetime"),t.qZA(),t._uU(8," (Mission Time) "),t.qZA()),2&n){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,1,e.validStop))}}function jn(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1," Showing entries from "),t.TgZ(2,"b"),t._uU(3,"the last 24 hours"),t.qZA(),t._uU(4," ending at "),t.TgZ(5,"b"),t._uU(6),t.ALo(7,"datetime"),t.qZA(),t._uU(8," (Mission Time) "),t.qZA()),2&n){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,1,e.validStop))}}function Vn(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1," Showing entries from "),t.TgZ(2,"b"),t._uU(3,"all time"),t.qZA(),t.qZA())}function Gn(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1," Showing entries from "),t.TgZ(2,"b"),t._uU(3),t.ALo(4,"datetime"),t.qZA(),t._uU(5," to "),t.TgZ(6,"b"),t._uU(7),t.ALo(8,"datetime"),t.qZA(),t._uU(9," (Mission Time) "),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(t.lcZ(4,2,e.validStart)),t.xp6(4),t.Oqu(t.lcZ(8,4,e.validStop))}}function Wn(n,i){1&n&&(t.TgZ(0,"th",61),t._uU(1,"ID"),t.qZA())}function zn(n,i){if(1&n&&(t.TgZ(0,"td",62),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.id," ")}}function Xn(n,i){1&n&&(t.TgZ(0,"th",61),t._uU(1,"Time"),t.qZA())}function Kn(n,i){if(1&n&&(t.TgZ(0,"td",62),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e.generationTime)," ")}}function ta(n,i){1&n&&(t.TgZ(0,"th",63),t.TgZ(1,"mat-icon",64),t._uU(2,"comment"),t.qZA(),t.qZA())}function ea(n,i){if(1&n&&(t.TgZ(0,"mat-icon",67),t._uU(1,"comment"),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("matTooltip",e.comment)}}function na(n,i){1&n&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function aa(n,i){if(1&n&&(t.TgZ(0,"td",65),t.YNc(1,ea,2,1,"mat-icon",66),t.YNc(2,na,2,0,"ng-container",13),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.comment),t.xp6(1),t.Q6J("ngIf",!e.comment)}}function ia(n,i){1&n&&(t.TgZ(0,"th",61),t._uU(1,"Command"),t.qZA())}function oa(n,i){if(1&n&&(t.TgZ(0,"td",62),t._UZ(1,"app-highlight",68),t.qZA()),2&n){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("text",e.commandName)("term",a.filterForm.value.filter)}}function ca(n,i){1&n&&(t.TgZ(0,"th",61),t._uU(1,"Issuer"),t.qZA())}function sa(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij("@",e.origin,"")}}function la(n,i){if(1&n&&(t.TgZ(0,"td",62),t._uU(1),t.YNc(2,sa,2,1,"span",13),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.username,""),t.xp6(1),t.Q6J("ngIf",e.origin)}}function ra(n,i){1&n&&(t.TgZ(0,"th",61),t._uU(1,"Queue"),t.qZA())}function ma(n,i){if(1&n&&(t.TgZ(0,"td",62),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.queue||"-"," ")}}function ua(n,i){1&n&&(t.TgZ(0,"th",61),t._uU(1,"Sequence number"),t.qZA())}function da(n,i){if(1&n&&(t.TgZ(0,"td",62),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.sequenceNumber," ")}}function _a(n,i){1&n&&(t.TgZ(0,"th",69),t._uU(1,"Q "),t.qZA())}function pa(n,i){if(1&n&&(t.TgZ(0,"td",70),t.TgZ(1,"div",71),t._UZ(2,"app-acknowledgment-icon",72),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Q6J("ack",e.queued)}}function ga(n,i){1&n&&(t.TgZ(0,"th",73),t._uU(1," R "),t.qZA())}function fa(n,i){if(1&n&&t._UZ(0,"app-transmission-constraints-icon",12),2&n){const e=t.oxw().$implicit;t.Q6J("command",e)}}function ha(n,i){if(1&n&&t._UZ(0,"app-acknowledgment-icon",72),2&n){const e=t.oxw().$implicit;t.Q6J("ack",e.released)}}function xa(n,i){if(1&n&&(t.TgZ(0,"td",70),t.TgZ(1,"div",71),t.YNc(2,fa,1,1,"app-transmission-constraints-icon",74),t.YNc(3,ha,1,1,"app-acknowledgment-icon",75),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Q6J("ngIf",!e.released),t.xp6(1),t.Q6J("ngIf",e.released)}}function Ta(n,i){1&n&&(t.TgZ(0,"th",76),t._uU(1,"S "),t.qZA())}function Za(n,i){if(1&n&&(t.TgZ(0,"td",70),t.TgZ(1,"div",71),t._UZ(2,"app-acknowledgment-icon",72),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Q6J("ack",e.sent)}}function ya(n,i){1&n&&(t.TgZ(0,"th",77),t._uU(1,"Acks"),t.qZA())}function Ca(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-acknowledgment-icon",72),t.BQk()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ack",e)}}function ba(n,i){1&n&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function va(n,i){if(1&n&&(t.TgZ(0,"td",78),t.TgZ(1,"div",71),t.YNc(2,Ca,2,1,"ng-container",79),t.qZA(),t.YNc(3,ba,2,0,"ng-container",13),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Q6J("ngForOf",e.extraAcks),t.xp6(1),t.Q6J("ngIf",!e.extraAcks.length)}}function Aa(n,i){1&n&&(t.TgZ(0,"th",80),t._uU(1,"Completion"),t.qZA())}function Sa(n,i){1&n&&(t.ynx(0),t._uU(1,"SUCCESS"),t.BQk())}function ka(n,i){if(1&n&&(t.TgZ(0,"span",83),t._uU(1," FAILURE "),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("matTooltip",null==e.completed?null:e.completed.message)}}function wa(n,i){1&n&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function qa(n,i){if(1&n&&(t.TgZ(0,"td",81),t.YNc(1,Sa,2,0,"ng-container",13),t.YNc(2,ka,2,1,"span",82),t.YNc(3,wa,2,0,"ng-container",13),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf","OK"===(null==e.completed?null:e.completed.status)),t.xp6(1),t.Q6J("ngIf","NOK"===(null==e.completed?null:e.completed.status)),t.xp6(1),t.Q6J("ngIf",!e.completed)}}function Na(n,i){1&n&&t._UZ(0,"th",84)}function Ua(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"button",85),t._uU(2," Resend "),t.qZA(),t._UZ(3,"mat-divider"),t.BQk()),2&n){const e=t.oxw().$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("routerLink",t.VKq(2,Nt,e.commandName))("queryParams",t.WLB(4,Ut,a.yamcs.context,e.id))}}function Qa(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"mat-divider"),t.TgZ(2,"app-download-menu-item",86),t.ALo(3,"commandDownloadLink"),t._uU(4," Download "),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("link",t.lcZ(3,1,e))}}function Pa(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"td",62),t.TgZ(1,"app-more"),t.YNc(2,Ua,4,7,"ng-container",13),t.TgZ(3,"button",3),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).copyHex(c)}),t._uU(4," Copy Hex "),t.qZA(),t.TgZ(5,"button",3),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).copyBinary(c)}),t._uU(6," Copy Binary "),t.qZA(),t.YNc(7,Qa,5,3,"ng-container",13),t.qZA(),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ngIf",e.showResend()),t.xp6(5),t.Q6J("ngIf",e.showCommandExports())}}function Ia(n,i){1&n&&t._UZ(0,"tr",87)}function Da(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr",88),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).selectRecord(c)}),t.ALo(1,"async"),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw(2);t.ekj("selected",t.lcZ(1,7,a.selectedRecord$)===e)("success","OK"===(null==e.completed?null:e.completed.status))("failed","NOK"===(null==e.completed?null:e.completed.status)),t.Q6J("@rowAnimation",e.animate)}}function Ja(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",15),t.TgZ(1,"form",16),t.TgZ(2,"div",17),t._UZ(3,"app-search-filter",18),t._UZ(4,"app-column-chooser",19,20),t.qZA(),t.TgZ(6,"div",17),t._UZ(7,"app-select",21),t._UZ(8,"app-select",22,23),t.YNc(10,En,5,1,"ng-container",13),t.YNc(11,Ln,3,0,"ng-container",13),t.YNc(12,Hn,1,0,"app-dots",13),t.ALo(13,"async"),t.qZA(),t.qZA(),t.TgZ(14,"div",24),t._UZ(15,"div",25),t.YNc(16,Bn,9,3,"span",26),t.YNc(17,Rn,9,3,"span",26),t.YNc(18,jn,9,3,"span",26),t.YNc(19,Vn,4,0,"span",26),t.YNc(20,Gn,10,6,"span",26),t.qZA(),t.TgZ(21,"table",27),t.ynx(22,28),t.YNc(23,Wn,2,0,"th",29),t.YNc(24,zn,2,1,"td",30),t.BQk(),t.ynx(25,31),t.YNc(26,Xn,2,0,"th",29),t.YNc(27,Kn,3,3,"td",30),t.BQk(),t.ynx(28,32),t.YNc(29,ta,3,0,"th",33),t.YNc(30,aa,3,2,"td",34),t.BQk(),t.ynx(31,35),t.YNc(32,ia,2,0,"th",29),t.YNc(33,oa,2,2,"td",30),t.BQk(),t.ynx(34,36),t.YNc(35,ca,2,0,"th",29),t.YNc(36,la,3,2,"td",30),t.BQk(),t.ynx(37,37),t.YNc(38,ra,2,0,"th",29),t.YNc(39,ma,2,1,"td",30),t.BQk(),t.ynx(40,38),t.YNc(41,ua,2,0,"th",29),t.YNc(42,da,2,1,"td",30),t.BQk(),t.ynx(43,39),t.YNc(44,_a,2,0,"th",40),t.YNc(45,pa,3,1,"td",41),t.BQk(),t.ynx(46,42),t.YNc(47,ga,2,0,"th",43),t.YNc(48,xa,4,2,"td",41),t.BQk(),t.ynx(49,44),t.YNc(50,Ta,2,0,"th",45),t.YNc(51,Za,3,1,"td",41),t.BQk(),t.ynx(52,46),t.YNc(53,ya,2,0,"th",47),t.YNc(54,va,4,2,"td",48),t.BQk(),t.ynx(55,49),t.YNc(56,Aa,2,0,"th",50),t.YNc(57,qa,4,3,"td",51),t.BQk(),t.ynx(58,52),t.YNc(59,Na,1,0,"th",53),t.YNc(60,Pa,8,2,"td",30),t.BQk(),t.YNc(61,Ia,1,0,"tr",54),t.ALo(62,"async"),t.YNc(63,Da,2,9,"tr",55),t.ALo(64,"async"),t.qZA(),t.TgZ(65,"mat-toolbar"),t._UZ(66,"span",56),t.TgZ(67,"button",57),t.NdJ("click",function(){return t.CHM(e),t.oxw().loadMoreData()}),t._uU(68,"Load More"),t.qZA(),t._UZ(69,"span",56),t.qZA(),t.qZA()}if(2&n){const e=t.MAs(5),a=t.oxw();t.xp6(1),t.Q6J("formGroup",a.filterForm),t.xp6(3),t.Q6J("columns",a.columns),t.xp6(3),t.Q6J("options",a.queueOptions),t.xp6(1),t.Q6J("options",a.intervalOptions),t.xp6(2),t.Q6J("ngIf","CUSTOM"===a.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf","CUSTOM"!==a.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf",t.lcZ(13,17,a.dataSource.loading$)),t.xp6(2),t.Q6J("ngSwitch",a.appliedInterval),t.xp6(2),t.Q6J("ngSwitchCase","PT1H"),t.xp6(1),t.Q6J("ngSwitchCase","PT6H"),t.xp6(1),t.Q6J("ngSwitchCase","P1D"),t.xp6(1),t.Q6J("ngSwitchCase","NO_LIMIT"),t.xp6(1),t.Q6J("ngSwitchCase","CUSTOM"),t.xp6(1),t.Q6J("dataSource",a.dataSource),t.xp6(40),t.Q6J("matHeaderRowDef",t.lcZ(62,19,e.displayedColumns$)),t.xp6(2),t.Q6J("matRowDefColumns",t.lcZ(64,21,e.displayedColumns$)),t.xp6(4),t.Q6J("disabled",!a.dataSource.hasMore())}}const L="PT1H";let Qt=(()=>{class n{constructor(e,a,o,c,s,u,_,f,p,Z){this.yamcs=e,this.messageService=c,this.router=s,this.route=u,this.printService=_,this.clipboard=Z,this.selectedRecord$=new T.X(null),this.filterForm=new l.cw({filter:new l.NI,queue:new l.NI("ANY"),interval:new l.NI(L),customStart:new l.NI(null),customStop:new l.NI(null)}),this.columns=[{id:"commandId",label:"ID"},{id:"generationTime",label:"Time",alwaysVisible:!0},{id:"comment",label:"Comment",visible:!0},{id:"command",label:"Command",alwaysVisible:!0},{id:"issuer",label:"Issuer"},{id:"queue",label:"Queue"},{id:"queued",label:"Queued",visible:!0},{id:"released",label:"Released",visible:!0},{id:"sent",label:"Sent",visible:!0},{id:"acknowledgments",label:"Extra acknowledgments",visible:!0},{id:"completion",label:"Completion",visible:!0},{id:"actions",label:"",alwaysVisible:!0}],this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.config=a.getConfig(),this.user=o.getUser(),f.setTitle("Command History"),this.dataSource=new Ve(this.yamcs,p),this.queueOptions=[{id:"ANY",label:"Any queue"}];for(const C of this.config.queueNames)this.queueOptions.push({id:C,label:C});this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe((0,Be.b)(400)).forEach(C=>{this.filter=C,this.loadData()}),this.filterForm.get("queue").valueChanges.forEach(C=>{this.queue="ANY"!==C?C:null,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(C=>{if("CUSTOM"===C){const W=this.validStart||this.yamcs.getMissionTime(),P=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(x.Y6(W)),this.filterForm.get("customStop").setValue(x.Y6(P))}else"NO_LIMIT"===C?(this.validStart=null,this.validStop=null,this.appliedInterval=C,this.loadData()):(this.validStop=e.getMissionTime(),this.validStart=(0,x.rV)(this.validStop,C),this.appliedInterval=C,this.loadData())})}initializeOptions(){const e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("queue")&&(this.queue=e.get("queue"),this.filterForm.get("queue").setValue(this.queue)),e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),"CUSTOM"===this.appliedInterval){const a=e.get("customStart");this.filterForm.get("customStart").setValue(a),this.validStart=new Date(a);const o=e.get("customStop");this.filterForm.get("customStop").setValue(o),this.validStop=new Date(o)}else"NO_LIMIT"===this.appliedInterval?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=(0,x.rV)(this.validStop,this.appliedInterval));else this.appliedInterval=L,this.validStop=this.yamcs.getMissionTime(),this.validStart=(0,x.rV)(this.validStop,L)}jumpToNow(){const e=this.filterForm.value.interval;"NO_LIMIT"===e||"CUSTOM"===e?this.filterForm.get("interval").setValue(L):(this.validStop=this.yamcs.getMissionTime(),this.validStart=(0,x.rV)(this.validStop,e),this.loadData())}applyCustomDates(){this.validStart=x.ZU(this.filterForm.value.customStart),this.validStop=x.ZU(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();const e={};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.filter&&(e.q=this.filter),this.queue&&(e.queue=this.queue),this.dataSource.loadEntries(e).catch(a=>this.messageService.showError(a))}loadMoreData(){const e={};this.validStart&&(e.start=this.validStart.toISOString()),this.filter&&(e.q=this.filter),this.queue&&(e.queue=this.queue),this.dataSource.loadMoreData(e).catch(a=>this.messageService.showError(a))}showResend(){return this.config.tc&&this.user.hasAnyObjectPrivilegeOfType("Command")}showCommandExports(){return this.config.commandExports}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,queue:this.queue||null,interval:this.appliedInterval,customStart:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStart:null,customStop:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}copyHex(e){const a=x.TR(e.binary);this.clipboard.copy(a)}copyBinary(e){const a=atob(e.binary);this.clipboard.copy(a)}selectRecord(e){this.selectedRecord$.next(e)}printReport(){const e=this.dataSource.records$.value.slice().reverse();this.printService.printComponent(Qn,"Command Report",e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C),t.Y36(D.E),t.Y36(E.e),t.Y36(I.e),t.Y36(h.F0),t.Y36(h.gz),t.Y36(Pn.Y),t.Y36(k.Dx),t.Y36(At.j),t.Y36(In.TU))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&t.Gf(On,5),2&e){let o;t.iGM(o=t.CRH())&&(a.intervalSelect=o.first)}},decls:20,vars:7,consts:[[3,"hasDetailPane"],[1,"ya-menu"],["exportMenu","matMenu"],["mat-menu-item","",3,"click"],["mat-button","","color","primary",3,"matMenuTriggerFor","disabled",4,"ngIf"],["mat-button","","matTooltip","Jump to now","color","primary",3,"click"],[4,"ngIf","ngIfElse"],["noSelection",""],[1,"table-wrapper"],["class","panel-content",4,"ngIf"],["mat-button","","color","primary",3,"matMenuTriggerFor","disabled"],[2,"padding","0 16px"],[3,"command"],[4,"ngIf"],[1,"ya-button",3,"routerLink","queryParams"],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","cmdhist",3,"columns"],["columnChooser",""],["formControlName","queue",3,"options"],["icon","access_time","formControlName","interval",3,"options"],["intervalSelect",""],[1,"table-status",3,"ngSwitch"],[1,"message-zone"],[4,"ngSwitchCase"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","commandId"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","generationTime"],["matColumnDef","comment"],["mat-header-cell","","class","iconcol",4,"matHeaderCellDef"],["mat-cell","","class","iconcol",4,"matCellDef"],["matColumnDef","command"],["matColumnDef","issuer"],["matColumnDef","queue"],["matColumnDef","sequenceNumber"],["matColumnDef","queued"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command queued",4,"matHeaderCellDef"],["mat-cell","","class","iconcol dense","style","text-align: center",4,"matCellDef"],["matColumnDef","released"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command released",4,"matHeaderCellDef"],["matColumnDef","sent"],["mat-header-cell","","class","iconcol dense","style","text-align: center","matTooltip","Command sent",4,"matHeaderCellDef"],["matColumnDef","acknowledgments"],["mat-header-cell","","class","dense",4,"matHeaderCellDef"],["mat-cell","","class","dense",4,"matCellDef"],["matColumnDef","completion"],["mat-header-cell","","style","padding-left: 8px",4,"matHeaderCellDef"],["mat-cell","","class","completion","style","text-align: center; padding-left: 8px",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","success","failed","click",4,"matRowDef","matRowDefColumns"],[2,"flex","1 1 auto"],[1,"ya-button",3,"disabled","click"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"click"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"iconcol"],["matTooltip","Comment",1,"icon16"],["mat-cell","",1,"iconcol"],["class","icon16",3,"matTooltip",4,"ngIf"],[1,"icon16",3,"matTooltip"],[3,"text","term"],["mat-header-cell","","matTooltip","Command queued",1,"iconcol","dense",2,"text-align","center"],["mat-cell","",1,"iconcol","dense",2,"text-align","center"],[2,"display","flex","align-items","center"],[3,"ack"],["mat-header-cell","","matTooltip","Command released",1,"iconcol","dense",2,"text-align","center"],[3,"command",4,"ngIf"],[3,"ack",4,"ngIf"],["mat-header-cell","","matTooltip","Command sent",1,"iconcol","dense",2,"text-align","center"],["mat-header-cell","",1,"dense"],["mat-cell","",1,"dense"],[4,"ngFor","ngForOf"],["mat-header-cell","",2,"padding-left","8px"],["mat-cell","",1,"completion",2,"text-align","center","padding-left","8px"],[3,"matTooltip",4,"ngIf"],[3,"matTooltip"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"routerLink","queryParams"],[3,"link"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar",0),t._uU(2," Command History \xa0\xa0\xa0 "),t.TgZ(3,"mat-menu",1,2),t.TgZ(5,"button",3),t.NdJ("click",function(){return a.printReport()}),t.TgZ(6,"mat-icon"),t._uU(7,"print"),t.qZA(),t._uU(8," Print report "),t.qZA(),t.qZA(),t.YNc(9,Yn,5,4,"button",4),t.TgZ(10,"button",5),t.NdJ("click",function(){return a.jumpToNow()}),t.TgZ(11,"mat-icon"),t._uU(12,"refresh"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(13,"app-detail-pane"),t.YNc(14,Mn,8,2,"ng-container",6),t.ALo(15,"async"),t.YNc(16,$n,2,0,"ng-template",null,7,t.W1O),t.qZA(),t.TgZ(18,"div",8),t.YNc(19,Ja,70,23,"div",9),t.qZA(),t.qZA()),2&e){const o=t.MAs(17);t.xp6(1),t.Q6J("hasDetailPane",!0),t.xp6(8),t.Q6J("ngIf",a.showCommandExports()),t.xp6(5),t.Q6J("ngIf",t.lcZ(15,5,a.selectedRecord$))("ngIfElse",o),t.xp6(5),t.Q6J("ngIf",a.dataSource)}},directives:[A.a,S.k,q.VK,q.OP,v.Hw,d.O5,$.lW,q.p6,w.gM,St.Z,kt.j,tt,U.d,h.rH,l._Y,l.JL,l.sg,et.a,l.JJ,l.u,nt.k,B.P,R.Y,Dn.b,d.RF,d.n9,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,wt.y,X,yt,d.sg,at.T,Jn.t,r.as,r.XQ,r.nj,r.Gk,Q.Ye],pipes:[d.Ov,N.i,qt],styles:[".table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}.table-status[_ngcontent-%COMP%]{background-color:#f7f7f7;height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.mat-row[_ngcontent-%COMP%]{cursor:pointer}tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:red}tr.success[_ngcontent-%COMP%]   td.completion[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}tr.failed[_ngcontent-%COMP%]   td.completion[_ngcontent-%COMP%]{background-color:#ffeef0;color:red}th.dense[_ngcontent-%COMP%], td.dense[_ngcontent-%COMP%]{width:1px;white-space:nowrap;padding-left:12px;padding-right:12px}"],data:{animation:[Re.q]},changeDetection:0}),n})(),it=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-send-command-wizard-step"]],inputs:{step:"step"},decls:11,vars:6,consts:[[1,"sub"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-toolbar",0),t.TgZ(1,"mat-toolbar-row"),t.TgZ(2,"span"),t.TgZ(3,"span"),t._uU(4,"1. Select command"),t.qZA(),t._uU(5," \xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),t.TgZ(6,"span"),t._uU(7,"2. Configure command"),t.qZA(),t._uU(8," \xa0\xa0\xa0\xa0\xa0\xa0\xa0 "),t.TgZ(9,"span"),t._uU(10,"3. View report"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.ekj("active",1==a.step),t.xp6(3),t.ekj("active",2==a.step),t.xp6(3),t.ekj("active",3==a.step))},directives:[Q.Ye,Q.rD],styles:["span[_ngcontent-%COMP%]{cursor:default}span[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{opacity:.3}span[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{opacity:1}mat-toolbar.sub[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;font-size:12px}.mat-toolbar-row[_ngcontent-%COMP%]{height:32px;padding:0 24px}.mat-toolbar-multiple-rows[_ngcontent-%COMP%]{min-height:32px}"],changeDetection:0}),n})();const Oa=function(n){return{c:n}},Ya=function(n){return["/commanding/send",n]},Fa=function(n,i){return{c:n,template:i}};function Ma(n,i){if(1&n&&(t.TgZ(0,"div",2),t._UZ(1,"app-command-detail2",3),t.ynx(2),t._UZ(3,"br"),t._UZ(4,"mat-divider"),t._UZ(5,"br"),t.TgZ(6,"button",4),t._uU(7," Send another command "),t.qZA(),t._uU(8," \xa0\xa0 "),t.TgZ(9,"button",5),t._uU(10," Resend this command "),t.qZA(),t.BQk(),t.qZA()),2&n){const e=i.ngIf,a=t.oxw();t.xp6(1),t.Q6J("command",e),t.xp6(5),t.Q6J("queryParams",t.VKq(4,Oa,a.yamcs.context)),t.xp6(3),t.Q6J("routerLink",t.VKq(6,Ya,e.commandName))("queryParams",t.WLB(8,Fa,a.yamcs.context,e.id))}}let Pt=(()=>{class n{constructor(e,a){this.yamcs=a,this.command$=new T.X(null);const o=e.snapshot.paramMap.get("commandId");a.yamcsClient.getCommandHistoryEntry(this.yamcs.instance,o).then(c=>{this.mergeEntry(c),this.commandSubscription=a.yamcsClient.createCommandSubscription({instance:a.instance,processor:a.processor,ignorePastCommands:!1},s=>{s.id===o&&this.mergeEntry(s)})})}mergeEntry(e){const a=this.command$.value;if(a){const o=a.mergeEntry(e);this.command$.next(o)}else this.command$.next(new F(e))}ngOnDestroy(){this.commandSubscription&&this.commandSubscription.cancel()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.gz),t.Y36(y.C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:6,vars:3,consts:[["step","3"],["class","panel-content",4,"ngIf"],[1,"panel-content"],[3,"command"],["routerLink","/commanding/send",1,"ya-button",3,"queryParams"],[1,"ya-button",3,"routerLink","queryParams"]],template:function(e,a){1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Send a command "),t.qZA(),t._UZ(3,"app-send-command-wizard-step",0),t.YNc(4,Ma,11,11,"div",1),t.ALo(5,"async"),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngIf",t.lcZ(5,1,a.command$)))},directives:[A.a,S.k,it,d.O5,tt,U.d,h.rH],pipes:[d.Ov],encapsulation:2,changeDetection:0}),n})();var It=m(3494);function $a(n,i){1&n&&(t.TgZ(0,"th",17),t._uU(1,"Value"),t.qZA())}function Ea(n,i){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.value," ")}}function La(n,i){1&n&&(t.TgZ(0,"th",17),t._uU(1,"Label"),t.qZA())}function Ha(n,i){if(1&n&&(t.TgZ(0,"td",18),t.TgZ(1,"strong"),t._uU(2),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.Oqu(e.label)}}function Ba(n,i){1&n&&(t.TgZ(0,"th",17),t._uU(1,"Hex value"),t.qZA())}function Ra(n,i){if(1&n&&(t.TgZ(0,"td",18),t._uU(1),t.qZA()),2&n){const e=i.$implicit,a=t.oxw();t.xp6(1),t.hij(" ",a.toHex(e.value)," ")}}function ja(n,i){1&n&&t._UZ(0,"tr",19)}function Va(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr",20),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw().selection.toggle(c)}),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw();t.ekj("selected",a.selection.isSelected(e))}}let Ga=(()=>{class n{constructor(e,a){this.dialogRef=e,this.data=a,this.filterControl=new l.NI,this.dataSource=new r.by([]),this.selection=new M.Ov,this.displayedColumns=["name","value"];const o=a.argument,c="UNSIGNED"===o.type.dataEncoding.encoding;this.dataSource.filterPredicate=(s,u)=>{const{label:_,value:f}=s;return _.toLowerCase().indexOf(u)>=0||String(f).indexOf(u)>=0||c&&Number(f).toString(16).indexOf(u)>=0},this.dataSource.data=o.type.enumValue||[],c&&this.displayedColumns.push("hex")}ngAfterViewInit(){this.filterControl.valueChanges.subscribe(()=>{this.dataSource.filter=(this.filterControl.value||"").toLowerCase()}),this.dataSource.paginator=this.paginator}selectNext(){const e=this.dataSource.filteredData;let a=0;if(this.selection.hasValue()){const o=this.selection.selected[0];-1!==e.indexOf(o)&&(a=Math.min(e.indexOf(o)+1,e.length-1))}this.selection.select(e[a])}selectPrevious(){const e=this.dataSource.filteredData;let a=0;if(this.selection.hasValue()){const o=this.selection.selected[0];-1!==e.indexOf(o)&&(a=Math.max(e.indexOf(o)-1,0))}this.selection.select(e[a])}toHex(e){return Number(e).toString(16)}applySelection(){const e=this.selection.selected;e.length&&this.dialogRef.close(e[0])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so),t.Y36(g.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-select-enumeration-dialog"]],viewQuery:function(e,a){if(1&e&&t.Gf(J.NW,7),2&e){let o;t.iGM(o=t.CRH())&&(a.paginator=o.first)}},decls:25,vars:8,consts:[[2,"background-color","#fff"],[1,"filter-bar"],["width","100%",3,"formControl","onArrowDown","onArrowUp","onEnter"],[1,"scrollpane"],["mat-table","",1,"ya-data-table",2,"width","100%",3,"dataSource"],["cdkColumnDef","value"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","name"],["cdkColumnDef","hex"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["align","end"],[3,"pageSize","hidePageSize","showFirstLastButtons"],[2,"flex","1 1 auto"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-toolbar",0),t._uU(1," Select enumeration state\n"),t.qZA(),t.TgZ(2,"mat-dialog-content"),t.TgZ(3,"div",1),t.TgZ(4,"app-search-filter",2),t.NdJ("onArrowDown",function(){return a.selectNext()})("onArrowUp",function(){return a.selectPrevious()})("onEnter",function(){return a.applySelection()}),t.qZA(),t.qZA(),t.TgZ(5,"div",3),t.TgZ(6,"table",4),t.ynx(7,5),t.YNc(8,$a,2,0,"th",6),t.YNc(9,Ea,2,1,"td",7),t.BQk(),t.ynx(10,8),t.YNc(11,La,2,0,"th",6),t.YNc(12,Ha,3,1,"td",7),t.BQk(),t.ynx(13,9),t.YNc(14,Ba,2,0,"th",6),t.YNc(15,Ra,2,1,"td",7),t.BQk(),t.YNc(16,ja,1,0,"tr",10),t.YNc(17,Va,1,2,"tr",11),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"mat-dialog-actions",12),t._UZ(19,"mat-paginator",13),t._UZ(20,"div",14),t.TgZ(21,"button",15),t._uU(22,"CANCEL"),t.qZA(),t.TgZ(23,"button",16),t.NdJ("click",function(){return a.applySelection()}),t._uU(24," SELECT "),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("formControl",a.filterControl),t.xp6(2),t.Q6J("dataSource",a.dataSource),t.xp6(10),t.Q6J("cdkHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("cdkRowDefColumns",a.displayedColumns),t.xp6(2),t.Q6J("pageSize",100)("hidePageSize",!0)("showFirstLastButtons",!0),t.xp6(4),t.Q6J("disabled",a.selection.isEmpty()))},directives:[Q.Ye,g.xY,et.a,l.JJ,l.oH,r.BZ,b.fo,b.D5,r.ge,b.O_,r.ev,b.s$,r.XQ,b.Sq,r.Gk,g.H8,J.NW,g.ZT],styles:["td[_ngcontent-%COMP%]{cursor:pointer}.scrollpane[_ngcontent-%COMP%]{overflow:auto;height:200px}.mat-dialog-actions[_ngcontent-%COMP%]{padding:24px}.filter-bar[_ngcontent-%COMP%]{display:block;padding:24px}"],changeDetection:0}),n})();var Wa=m(3748),za=m(471),Xa=m(193),Ka=m(289),ti=m(6057);function ei(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"label"),t.TgZ(1,"div",4),t.TgZ(2,"div",5),t._uU(3),t.qZA(),t.qZA(),t._uU(4),t._UZ(5,"app-errors",6),t.TgZ(6,"div",7),t._UZ(7,"app-select",8),t._uU(8,"\xa0 "),t.TgZ(9,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).openSelectEnumerationDialog()}),t.TgZ(10,"mat-icon"),t._uU(11,"search"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(3),t.Oqu(a.argument.type.engType),t.xp6(1),t.hij(" ",a.argument.name," "),t.xp6(1),t.Q6J("controlName",e),t.xp6(2),t.Q6J("formControlName",e)("options",a.selectOptions)}}function ni(n,i){if(1&n&&(t.TgZ(0,"label"),t._uU(1),t._UZ(2,"app-errors",6),t._UZ(3,"br"),t._UZ(4,"input",10),t._uU(5),t._UZ(6,"input",11),t._uU(7),t.qZA()),2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.hij(" ",a.argument.name," "),t.xp6(1),t.Q6J("controlName",e),t.xp6(2),t.Q6J("formControlName",e),t.xp6(1),t.hij(" ",a.argument.type.oneStringValue," "),t.xp6(1),t.Q6J("formControlName",e),t.xp6(1),t.hij(" ",a.argument.type.zeroStringValue," ")}}function ai(n,i){if(1&n&&(t.TgZ(0,"label"),t._uU(1),t._UZ(2,"app-errors",6),t._UZ(3,"app-date-time-input",12),t.qZA()),2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.hij(" ",a.argument.name," "),t.xp6(1),t.Q6J("controlName",e),t.xp6(1),t.Q6J("formControlName",e)}}function ii(n,i){if(1&n&&(t.TgZ(0,"label"),t.TgZ(1,"div",4),t.TgZ(2,"div",5),t.ALo(3,"async"),t._uU(4),t.qZA(),t.qZA(),t._uU(5),t._UZ(6,"app-errors",6,13),t._UZ(8,"app-binary-input",12),t.qZA()),2&n){const e=t.MAs(7),a=t.oxw().ngIf,o=t.oxw();t.xp6(2),t.ekj("error",t.lcZ(3,6,e.invalid$)),t.xp6(2),t.Oqu(o.argument.type.engType),t.xp6(1),t.hij(" ",o.argument.name," "),t.xp6(1),t.Q6J("controlName",a),t.xp6(2),t.Q6J("formControlName",a)}}function oi(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-command-form-argument",16),t._UZ(2,"br"),t.BQk()),2&n){const e=i.$implicit,a=t.oxw(3);t.xp6(1),t.Q6J("argument",e)("formGroup",a.formGroup)("parent",a.parent?a.parent+"."+a.argument.name:a.argument.name)}}function ci(n,i){if(1&n&&(t.TgZ(0,"label"),t.TgZ(1,"div",4),t.TgZ(2,"div",5),t._uU(3),t.qZA(),t.qZA(),t._uU(4),t.TgZ(5,"div",14),t.YNc(6,oi,3,3,"ng-container",15),t.qZA(),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.argument.type.engType),t.xp6(1),t.hij(" ",e.argument.name," "),t.xp6(2),t.Q6J("ngForOf",null==e.argument.type?null:e.argument.type.member)}}function si(n,i){if(1&n&&(t.TgZ(0,"div",5),t._UZ(1,"app-interval",24),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("left",e.argument.type.rangeMin)("right",e.argument.type.rangeMax)}}function li(n,i){if(1&n&&(t.TgZ(0,"div",5),t._uU(1," chars: "),t._UZ(2,"app-interval",24),t.qZA()),2&n){const e=t.oxw(3);t.xp6(2),t.Q6J("left",e.argument.type.minChars)("right",e.argument.type.maxChars)}}function ri(n,i){if(1&n&&(t.TgZ(0,"div",5),t._uU(1),t.ALo(2,"units"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",t.lcZ(2,1,null==e.argument.type?null:e.argument.type.unitSet)," ")}}function mi(n,i){if(1&n&&(t.TgZ(0,"div",25),t.NdJ("click",function(a){return a.stopPropagation()}),t._uU(1,"\u2630"),t.qZA()),2&n){t.oxw();const e=t.MAs(9);t.Q6J("matMenuTriggerFor",e)}}function ui(n,i){if(1&n&&t._UZ(0,"input",26),2&n){const e=t.oxw(2).ngIf;t.Q6J("formControlName",e)}}function di(n,i){if(1&n&&t._UZ(0,"app-hex-integer-input",12),2&n){const e=t.oxw(2).ngIf;t.Q6J("formControlName",e)}}function _i(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"label"),t.TgZ(1,"div",4),t.ALo(2,"async"),t.YNc(3,si,2,2,"div",17),t.YNc(4,li,3,2,"div",17),t.YNc(5,ri,3,3,"div",17),t.TgZ(6,"div",5),t._uU(7),t.qZA(),t.TgZ(8,"mat-menu",18,19),t.TgZ(10,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).hexToggle$.next(!0)}),t.TgZ(11,"mat-icon"),t.ALo(12,"async"),t._uU(13,"check"),t.qZA(),t._uU(14," Hex input "),t.qZA(),t.TgZ(15,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).hexToggle$.next(!1)}),t.TgZ(16,"mat-icon"),t.ALo(17,"async"),t._uU(18,"check"),t.qZA(),t._uU(19," Decimal input "),t.qZA(),t.qZA(),t.YNc(20,mi,2,1,"div",21),t.qZA(),t._uU(21),t._UZ(22,"app-errors",6,13),t.YNc(24,ui,1,1,"input",22),t.ALo(25,"async"),t.YNc(26,di,1,1,"app-hex-integer-input",23),t.ALo(27,"async"),t.qZA()}if(2&n){const e=t.MAs(23),a=t.oxw().ngIf,o=t.oxw();t.xp6(1),t.ekj("error",t.lcZ(2,15,e.invalid$)),t.xp6(2),t.Q6J("ngIf",void 0!==o.argument.type.rangeMin||void 0!==o.argument.type.rangeMax),t.xp6(1),t.Q6J("ngIf",void 0!==o.argument.type.minChars||void 0!==o.argument.type.maxChars),t.xp6(1),t.Q6J("ngIf",null==o.argument.type?null:o.argument.type.unitSet),t.xp6(2),t.Oqu(o.argument.type.engType),t.xp6(4),t.Udp("visibility",t.lcZ(12,17,o.hexToggle$)?"visible":"hidden"),t.xp6(5),t.Udp("visibility",t.lcZ(17,19,o.hexToggle$)?"hidden":"visible"),t.xp6(4),t.Q6J("ngIf","UNSIGNED"===o.argument.type.dataEncoding.encoding),t.xp6(1),t.hij(" ",o.argument.name," "),t.xp6(1),t.Q6J("controlName",a),t.xp6(2),t.Q6J("ngIf",!t.lcZ(25,21,o.hexToggle$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(27,23,o.hexToggle$))}}function pi(n,i){if(1&n&&(t.ynx(0,1),t.YNc(1,ei,12,5,"label",2),t.YNc(2,ni,8,6,"label",2),t.YNc(3,ai,4,3,"label",2),t.YNc(4,ii,9,8,"label",2),t.YNc(5,ci,7,3,"label",2),t.YNc(6,_i,28,25,"label",3),t.BQk()),2&n){const e=t.oxw();t.Q6J("formGroup",e.formGroup)("ngSwitch",null==e.argument.type?null:e.argument.type.engType),t.xp6(1),t.Q6J("ngSwitchCase","enumeration"),t.xp6(1),t.Q6J("ngSwitchCase","boolean"),t.xp6(1),t.Q6J("ngSwitchCase","time"),t.xp6(1),t.Q6J("ngSwitchCase","binary"),t.xp6(1),t.Q6J("ngSwitchCase","aggregate")}}let gi=(()=>{class n{constructor(e){this.dialog=e,this.controlName$=new T.X(null),this.hexToggle$=new T.X(!1)}ngOnInit(){this.controlName$.next(this.parent?this.parent+"."+this.argument.name:this.argument.name)}ngAfterViewInit(){var e,a;if("enumeration"===(null===(a=null===(e=this.argument)||void 0===e?void 0:e.type)||void 0===a?void 0:a.engType)){this.selectOptions=[];for(const o of this.argument.type.enumValue||[])this.selectOptions.push({id:o.label,label:o.label})}}openSelectEnumerationDialog(){this.dialog.open(Ga,{width:"600px",data:{argument:this.argument},panelClass:["no-padding-dialog"]}).afterClosed().subscribe(e=>{e&&this.formGroup.controls[this.controlName$.value].setValue(e.label)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-command-form-argument"]],inputs:{formGroup:"formGroup",argument:"argument",parent:"parent"},decls:2,vars:3,consts:[[3,"formGroup","ngSwitch",4,"ngIf"],[3,"formGroup","ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"meta"],[1,"item"],[3,"controlName"],[1,"control-group"],[3,"formControlName","options"],["matTooltip","Lookup enumeration state",1,"ya-button",3,"click"],["type","radio","value","true",3,"formControlName"],["type","radio","value","false",3,"formControlName"],[3,"formControlName"],["err",""],[1,"members"],[4,"ngFor","ngForOf"],[3,"argument","formGroup","parent"],["class","item",4,"ngIf"],[1,"ya-menu"],["argMenu","matMenu"],["mat-menu-item","",3,"click"],["class","item menu","matTooltip","Input options",3,"matMenuTriggerFor","click",4,"ngIf"],["type","text",3,"formControlName",4,"ngIf"],[3,"formControlName",4,"ngIf"],[3,"left","right"],["matTooltip","Input options",1,"item","menu",3,"matMenuTriggerFor","click"],["type","text",3,"formControlName"]],template:function(e,a){1&e&&(t.YNc(0,pi,7,7,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,a.controlName$))},directives:[d.O5,l.JL,l.sg,d.RF,d.n9,Wa.D,B.P,l.JJ,l.u,w.gM,v.Hw,l._,l.Fj,R.Y,za.Y,d.sg,n,d.ED,Xa.X,q.VK,q.OP,q.p6,Ka.$],pipes:[d.Ov,ti.H],styles:[".meta[_ngcontent-%COMP%]{position:absolute;top:0;right:0;display:flex}.meta[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{flex:none;background-color:#eee;font-weight:400;font-family:Roboto Mono,monospace;color:#000000a7;padding-left:2px;padding-right:2px;margin-left:10px}.meta.error[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{background-color:#dc143c;color:#fff}.members[_ngcontent-%COMP%]{margin-top:5px;padding-top:5px;padding-left:10px}.meta[_ngcontent-%COMP%]   .item.menu[_ngcontent-%COMP%]:hover{background-color:#5787b1;color:#fff;cursor:pointer}"],changeDetection:0}),n})();var ot=m(1711);function fi(n,i){1&n&&t._UZ(0,"br")}function hi(n,i){if(1&n&&(t.ynx(0),t.YNc(1,fi,1,0,"br",2),t._UZ(2,"app-command-form-argument",5),t.BQk()),2&n){const e=i.$implicit,a=i.first,o=t.oxw();t.xp6(1),t.Q6J("ngIf",!a),t.xp6(1),t.Q6J("argument",e)("formGroup",o.form)}}function xi(n,i){1&n&&t._UZ(0,"br",8)}function Ti(n,i){if(1&n&&(t.ynx(0),t.YNc(1,xi,1,0,"br",6),t._UZ(2,"app-command-form-argument",7),t.BQk()),2&n){const e=i.$implicit,a=i.first,o=t.oxw();t.xp6(1),t.Q6J("ngIf",!a||o.arguments.length),t.xp6(1),t.Q6J("argument",e)("formGroup",o.form)}}function Zi(n,i){1&n&&t._UZ(0,"br")}function yi(n,i){1&n&&(t.ynx(0),t._uU(1,"s"),t.BQk())}function Ci(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.YNc(1,Zi,1,0,"br",2),t.TgZ(2,"app-text-action",9),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).showAll$.next(!0)}),t._uU(3),t.YNc(4,yi,2,0,"ng-container",2),t._uU(5," with defaults "),t.qZA(),t.BQk()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.arguments.length),t.xp6(2),t.hij(" Show ",e.argumentsWithInitial.length," argument"),t.xp6(1),t.Q6J("ngIf",1!==e.argumentsWithInitial.length)}}function bi(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Ci,6,3,"ng-container",2),t.ALo(2,"async"),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.argumentsWithInitial.length&&!t.lcZ(2,1,e.showAll$))}}function vi(n,i){if(1&n&&(t.TgZ(0,"app-help",16),t._UZ(1,"div",17),t.qZA()),2&n){const e=t.oxw(2).$implicit;t.Q6J("dialogTitle",e.verboseName||e.id),t.xp6(1),t.Q6J("innerHTML",e.help,t.oJD)}}function Ai(n,i){if(1&n&&(t.TgZ(0,"label"),t._uU(1),t.YNc(2,vi,2,2,"app-help",13),t._UZ(3,"br"),t._UZ(4,"input",14),t._uU(5," true "),t._UZ(6,"input",15),t._uU(7," false "),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.verboseName||e.id," "),t.xp6(1),t.Q6J("ngIf",e.help),t.xp6(2),t.Q6J("formControlName","extra__"+e.id),t.xp6(2),t.Q6J("formControlName","extra__"+e.id)}}function Si(n,i){if(1&n&&(t.TgZ(0,"app-help",16),t._UZ(1,"div",17),t.qZA()),2&n){const e=t.oxw(2).$implicit;t.Q6J("dialogTitle",e.verboseName||e.id),t.xp6(1),t.Q6J("innerHTML",e.help,t.oJD)}}function ki(n,i){if(1&n&&(t.TgZ(0,"label"),t._uU(1),t.YNc(2,Si,2,2,"app-help",13),t._UZ(3,"input",18),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.verboseName||e.id," "),t.xp6(1),t.Q6J("ngIf",e.help),t.xp6(1),t.Q6J("formControlName","extra__"+e.id)}}function wi(n,i){if(1&n&&(t.ynx(0),t.ynx(1,10),t.YNc(2,Ai,8,4,"label",11),t.YNc(3,ki,4,3,"label",12),t.BQk(),t._UZ(4,"br"),t.BQk()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngSwitch",e.type),t.xp6(1),t.Q6J("ngSwitchCase","BOOLEAN")}}function qi(n,i){if(1&n&&(t.ynx(0),t.YNc(1,wi,5,2,"ng-container",1),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.commandOptions)}}function Dt(n,i){let e={};for(let a=0;a<i.name.length;a++){const o=i.name[a],c=i.value[a];"AGGREGATE"===c.type?e=Object.assign(Object.assign({},e),Dt(n+o+".",c.aggregateValue)):e[n+o]=ct(c)}return e}function ct(n){switch(n.type){case"BOOLEAN":return""+n.booleanValue;case"FLOAT":return""+n.floatValue;case"DOUBLE":return""+n.doubleValue;case"UINT32":return""+n.uint32Value;case"SINT32":return""+n.sint32Value;case"BINARY":return x.TR(n.binaryValue);case"ENUMERATED":case"STRING":case"TIMESTAMP":return n.stringValue;case"UINT64":return""+n.uint64Value;case"SINT64":return""+n.sint64Value}}let Jt=(()=>{class n{constructor(e,a){this.arguments=[],this.argumentsWithInitial=[],this.showAll$=new T.X(!1),this.form=new l.cw({}),this.user=a.getUser(),this.commandOptions=e.getCommandOptions(),this.form.addControl("extra__comment",new l.NI(""));for(const o of this.commandOptions)this.form.addControl("extra__"+o.id,new l.NI(""));this.config=e.getConfig(),this.showAll$.next(!this.config.collapseInitializedArguments)}ngOnChanges(){var e;this.arguments=[],this.argumentsWithInitial=[],this.showAll$.next(!this.config.collapseInitializedArguments);for(const u in this.form.controls)u.startsWith("extra__")||this.form.removeControl(u);this.form.reset();const a=(null===(e=this.templateProvider)||void 0===e?void 0:e.getComment())||"";if(this.form.controls.extra__comment.setValue(a),!this.command)return;const o=[];let c=this.command;for(;c;)o.unshift(c),c=c.baseCommand;const s=new Map;for(const u of o){if(u.argument)for(const _ of u.argument){if(this.templateProvider){const f=this.templateProvider.getAssignment(_.name);if(void 0!==f){const p=ct(f);let Z=_.initialValue;"boolean"===_.type.engType&&(Z=""+(_.type.oneStringValue===Z)),p===Z?this.argumentsWithInitial.push(_):this.arguments.push(_);continue}}void 0!==_.initialValue?this.argumentsWithInitial.push(_):this.arguments.push(_)}if(u.argumentAssignment)for(const _ of u.argumentAssignment)s.set(_.name,_.value)}this.arguments=this.arguments.filter(u=>!s.has(u.name)),this.argumentsWithInitial=this.argumentsWithInitial.filter(u=>!s.has(u.name));for(const u of this.arguments)this.addControl(u,this.templateProvider);for(const u of this.argumentsWithInitial)this.addControl(u,this.templateProvider)}getAssignments(){const e={};for(const a of[...this.arguments,...this.argumentsWithInitial])if("aggregate"===a.type.engType){const o=this.getMemberAssignments(a.name+".",a);e[a.name]=o}else{const o=this.form.controls[a.name];(!this.isArgumentWithInitialValue(a.name)||o.dirty)&&(e[a.name]="boolean"===a.type.engType?"true"===this.form.value[a.name]:this.form.value[a.name])}return e}getMemberAssignments(e,a){const o={};for(const c of a.type.member||[])if("aggregate"===c.type.engType)o[c.name]=this.getMemberAssignments(e+c.name+".",c);else{const s=this.form.controls[e+c.name];switch(c.type.engType){case"boolean":o[c.name]="true"===s.value;case"float":case"double":case"integer":o[c.name]=Number(s.value);break;default:o[c.name]=s.value}}return o}getComment(){return this.form.value.extra__comment||void 0}getExtraOptions(){const e={};for(const a in this.form.controls)if(a.startsWith("extra__")&&"extra__comment"!==a){const o=this.form.controls[a];if(null!==o.value){const c=a.replace("extra__","");e[c]=this.toYamcsValue(c,o.value)}}return e}toYamcsValue(e,a){let o;for(const c of this.commandOptions)c.id===e&&(o=c);switch(o.type){case"BOOLEAN":return"true"===a?{type:"BOOLEAN",booleanValue:!0}:{type:"BOOLEAN",booleanValue:!1};case"NUMBER":return{type:"SINT32",sint32Value:Number(a)};default:return{type:"STRING",stringValue:String(a)}}}showCommandOptions(){return this.user.hasSystemPrivilege("CommandOptions")}addControl(e,a){if("aggregate"===e.type.engType)this.addAggregateControl(e,a);else{let o;if(o="boolean"===e.type.engType&&e.initialValue?""+(e.initialValue===e.type.oneStringValue):e.initialValue,a){const s=a.getAssignment(e.name);void 0!==s&&(o=ct(s))}void 0===o&&(o="");const c=this.getValidatorsForType(e.type);this.form.addControl(e.name,new l.NI(o,c))}}addAggregateControl(e,a){if(this.addMemberControls(e.name+".",e.type.member||[]),a){const o=a.getAssignment(e.name);if(void 0!==o&&"AGGREGATE"===o.type){const c=Dt(e.name+".",o.aggregateValue);for(const s in c)s in this.form.controls&&this.form.controls[s].setValue(c[s])}}}addMemberControls(e,a){for(const o of a)if("aggregate"===o.type.engType)this.addMemberControls(e+o.name+".",o.type.member||[]);else{const c=e+o.name,s=this.getValidatorsForType(o.type);this.form.addControl(c,new l.NI("",s))}}getValidatorsForType(e){const a=[];return 0!==e.minChars&&a.push(l.kI.required),"integer"===e.engType?a.push(It.V):"float"===e.engType&&a.push(It.H),void 0!==e.rangeMax&&a.push(l.kI.max(e.rangeMax)),void 0!==e.rangeMin&&a.push(l.kI.min(e.rangeMin)),void 0!==e.minChars&&a.push(l.kI.minLength(e.minChars)),void 0!==e.maxChars&&a.push(l.kI.maxLength(e.maxChars)),a}isArgumentWithInitialValue(e){for(const a of this.argumentsWithInitial)if(a.name===e)return!0;return!1}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.E),t.Y36(E.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-command-form"]],inputs:{command:"command",templateProvider:"templateProvider"},features:[t.TTD],decls:15,vars:9,consts:[[1,"ya-form",3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"hint"],["formControlName","extra__comment","rows","3",2,"width","100%","resize","none"],[3,"argument","formGroup"],["class","hasInitial",4,"ngIf"],[1,"hasInitial",3,"argument","formGroup"],[1,"hasInitial"],["icon","double_arrow",3,"click"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"dialogTitle",4,"ngIf"],["type","radio","value","true",3,"formControlName"],["type","radio","value","false",3,"formControlName"],[3,"dialogTitle"],[3,"innerHTML"],["type","text",3,"formControlName"]],template:function(e,a){1&e&&(t.TgZ(0,"form",0),t.ALo(1,"async"),t.YNc(2,hi,3,3,"ng-container",1),t.YNc(3,Ti,3,3,"ng-container",1),t.YNc(4,bi,3,3,"ng-container",2),t.TgZ(5,"p"),t._uU(6,"\xa0"),t.qZA(),t.TgZ(7,"h3"),t._uU(8,"Options"),t.qZA(),t.YNc(9,qi,2,1,"ng-container",2),t.TgZ(10,"label"),t._uU(11," Comment "),t.TgZ(12,"span",3),t._uU(13,"(optional)"),t.qZA(),t._UZ(14,"textarea",4),t.qZA(),t.qZA()),2&e&&(t.ekj("showAll",t.lcZ(1,7,a.showAll$)),t.Q6J("formGroup",a.form),t.xp6(2),t.Q6J("ngForOf",a.arguments),t.xp6(1),t.Q6J("ngForOf",a.argumentsWithInitial),t.xp6(1),t.Q6J("ngIf",a.config.collapseInitializedArguments),t.xp6(5),t.Q6J("ngIf",a.showCommandOptions()))},directives:[l._Y,l.JL,l.sg,d.sg,d.O5,gi,ot.l,d.RF,d.n9,z.W,l._,l.Fj,l.JJ,l.u,d.ED],pipes:[d.Ov],styles:[".hasInitial[_ngcontent-%COMP%]{display:none}.showAll[_ngcontent-%COMP%]   .hasInitial[_ngcontent-%COMP%]{display:block}"],changeDetection:0}),n})();var j=m(911),Ot=m(8619),Ni=m(4511),Yt=m(5981),Ft=m(4502),Ui=m(2368),Mt=m(3995),st=m(4302);const Qi=["commandForm"],Pi=["another"];function Ii(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"dt"),t._uU(2),t.qZA(),t.TgZ(3,"dd"),t._uU(4),t.qZA(),t.BQk()),2&n){const e=i.$implicit;t.xp6(2),t.Oqu(e.namespace),t.xp6(2),t.Oqu(e.name)}}function Di(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"dt"),t._uU(2,"Description"),t.qZA(),t.TgZ(3,"dd"),t._UZ(4,"app-markdown",14),t.qZA(),t.BQk()),2&n){const e=t.oxw(2).ngIf;t.xp6(4),t.Q6J("text",e.longDescription)}}function Ji(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"dt"),t._uU(2,"Description"),t.qZA(),t.TgZ(3,"dd"),t._uU(4),t.qZA(),t.BQk()),2&n){const e=t.oxw(2).ngIf;t.xp6(4),t.hij(" ",e.shortDescription||"-"," ")}}function Oi(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Di,5,1,"ng-container",3),t.YNc(2,Ji,5,1,"ng-container",3),t.BQk()),2&n){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",e.longDescription),t.xp6(1),t.Q6J("ngIf",!e.longDescription)}}function Yi(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-significance-level",15),t._uU(2),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("level",e.consequenceLevel),t.xp6(1),t.hij(" \xa0\xa0",e.reasonForWarning," ")}}function Fi(n,i){if(1&n&&(t.TgZ(0,"dl",11),t.TgZ(1,"dt"),t._uU(2,"Command"),t.qZA(),t.TgZ(3,"dd"),t._uU(4),t.ALo(5,"shortName"),t.qZA(),t.TgZ(6,"dt"),t._uU(7,"Space system"),t.qZA(),t.TgZ(8,"dd"),t._uU(9),t.ALo(10,"spaceSystemName"),t.qZA(),t.YNc(11,Ii,5,2,"ng-container",12),t.YNc(12,Oi,3,2,"ng-container",3),t.TgZ(13,"dt"),t._uU(14,"Significance"),t.qZA(),t.TgZ(15,"dd"),t.YNc(16,Yi,3,2,"ng-container",13),t.ALo(17,"effectiveSignificance"),t.qZA(),t.qZA()),2&n){const e=i.ngIf;t.oxw();const a=t.MAs(31);t.xp6(4),t.Oqu(t.lcZ(5,6,e.qualifiedName)),t.xp6(5),t.Oqu(t.lcZ(10,8,e.qualifiedName)||"-"),t.xp6(2),t.Q6J("ngForOf",e.alias),t.xp6(1),t.Q6J("ngIf",e.longDescription||e.shortDescription),t.xp6(4),t.Q6J("ngIf",t.lcZ(17,10,e))("ngIfElse",a)}}function Mi(n,i){1&n&&(t.TgZ(0,"app-warning-message"),t._uU(1," You're not cleared to send this command "),t.qZA())}function $i(n,i){1&n&&(t.TgZ(0,"span",21),t._uU(1," satisfied "),t.qZA())}function Ei(n,i){1&n&&(t.TgZ(0,"span",22),t._uU(1," not satisfied "),t.qZA())}function Li(n,i){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t.YNc(6,$i,2,0,"span",17),t.ALo(7,"async"),t.YNc(8,Ei,2,0,"span",18),t.ALo(9,"async"),t._UZ(10,"app-live-expression",19,20),t.qZA(),t.qZA()),2&n){const e=i.$implicit,a=t.MAs(11);t.xp6(2),t.Oqu(e.expression),t.xp6(2),t.Oqu(e.timeout||"-"),t.xp6(2),t.Q6J("ngIf",!0===t.lcZ(7,7,a.result$)),t.xp6(2),t.Q6J("ngIf",!1===t.lcZ(9,9,a.result$)),t.xp6(2),t.Udp("display","none"),t.Q6J("expression",e.expression)}}function Hi(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"p"),t._uU(2,"\xa0"),t.qZA(),t.TgZ(3,"h3"),t._uU(4,"Constraints"),t.qZA(),t.TgZ(5,"table",16),t.TgZ(6,"tr"),t.TgZ(7,"th"),t._uU(8,"Constraint"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Timeout"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"Live Evaluation"),t.qZA(),t.qZA(),t.YNc(13,Li,12,11,"tr",12),t.qZA(),t.BQk()),2&n){const e=t.oxw().ngIf;t.xp6(13),t.Q6J("ngForOf",e.constraint)}}function Bi(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Hi,14,1,"ng-container",3),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("ngIf",e.constraint)}}function Ri(n,i){1&n&&(t.TgZ(0,"p"),t._uU(1,"\xa0"),t.qZA())}function ji(n,i){1&n&&(t.TgZ(0,"h3"),t._uU(1,"Arguments"),t.qZA())}function Vi(n,i){if(1&n&&(t.TgZ(0,"mat-slide-toggle",23),t._uU(1," Arm "),t.qZA()),2&n){const e=t.oxw();t.Q6J("formControl",e.armControl)}}function Gi(n,i){1&n&&t._uU(0," -\n")}let $t=(()=>{class n{constructor(e,a,o,c,s,u,_,f,p){this.router=a,this.messageService=c,this.yamcs=s,this.location=u,this.command$=new T.X(null),this.templateProvider$=new T.X(null),this.cleared$=new T.X(!0),this.armControl=new l.NI,this.config=_.getConfig();const Z=e.snapshot.paramMap.get("qualifiedName");o.setTitle(`Send a command: ${Z}`);const C=[this.yamcs.yamcsClient.getCommand(this.yamcs.instance,Z)],W=e.snapshot.queryParamMap.get("template");if(W){const P=this.yamcs.yamcsClient.getCommandHistoryEntry(this.yamcs.instance,W);C.push(P)}Promise.all(C).then(P=>{const ie=P[0];let ut;P.length>1&&(ut=P[1]),this.command$.next(ie),this.templateProvider$.next(ut?new Wi(ut):null),this.config.commandClearanceEnabled&&(this.connectionInfoSubscription=s.clearance$.subscribe(Zl=>{const dt=p.transform(ie);this.cleared$.next(this.isCleared(Zl,null==dt?void 0:dt.consequenceLevel))}))})}ngAfterViewInit(){this.config.twoStageCommanding&&(this.commandForm.form.valueChanges.subscribe(()=>{this.armControl.setValue(!1)}),this.commandForm.form.statusChanges.subscribe(()=>{this.commandForm.form.valid?this.armControl.enable():this.armControl.disable()}))}goBack(){this.location.back()}sendCommand(){this.armControl.setValue(!1);const e=this.commandForm.getAssignments(),a=this.commandForm.getComment(),o=this.commandForm.getExtraOptions();this.yamcs.yamcsClient.issueCommand(this.yamcs.instance,this.yamcs.processor,this.command$.value.qualifiedName,{args:e,comment:a,extra:o}).then(s=>{this.router.navigate(["/commanding/report",s.id],{queryParams:{c:this.yamcs.context}})}).catch(s=>{this.messageService.showError(s)})}isCleared(e,a){if(!e)return!1;switch(e.level){case"SEVERE":if("SEVERE"===a)return!0;case"CRITICAL":if("CRITICAL"===a)return!0;case"DISTRESS":if("DISTRESS"===a)return!0;case"WARNING":if("WARNING"===a)return!0;case"WATCH":if("WATCH"===a)return!0;case"NONE":if("NONE"===a||!a)return!0}return!1}ngOnDestroy(){this.connectionInfoSubscription&&this.connectionInfoSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.gz),t.Y36(h.F0),t.Y36(k.Dx),t.Y36(I.e),t.Y36(y.C),t.Y36(d.Ye),t.Y36(D.E),t.Y36(E.e),t.Y36(j.m))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&(t.Gf(Qi,5),t.Gf(Pi,5)),2&e){let o;t.iGM(o=t.CRH())&&(a.commandForm=o.first),t.iGM(o=t.CRH())&&(a.anotherChild=o.first)}},decls:32,vars:21,consts:[["step","2"],[1,"form-content"],["class","dl-horizontal no-lead no-trail",4,"ngIf"],[4,"ngIf"],[3,"command","templateProvider"],["commandForm",""],[1,"ya-button",3,"click"],[2,"flex","1 1 auto"],["color","primary",3,"formControl",4,"ngIf"],[1,"ya-button","primary",3,"disabled","click"],["dash",""],[1,"dl-horizontal","no-lead","no-trail"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[3,"text"],[3,"level"],["yaDataTable",""],["class","evaluation valid",4,"ngIf"],["class","evaluation invalid",4,"ngIf"],[3,"expression"],["expr",""],[1,"evaluation","valid"],[1,"evaluation","invalid"],["color","primary",3,"formControl"]],template:function(e,a){if(1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Send a command "),t.qZA(),t._UZ(3,"app-send-command-wizard-step",0),t.TgZ(4,"div",1),t.YNc(5,Fi,18,12,"dl",2),t.ALo(6,"async"),t.YNc(7,Mi,2,0,"app-warning-message",3),t.ALo(8,"async"),t.YNc(9,Bi,2,1,"ng-container",3),t.ALo(10,"async"),t.YNc(11,Ri,2,0,"p",3),t.YNc(12,ji,2,0,"h3",3),t._UZ(13,"app-command-form",4,5),t.ALo(15,"async"),t.ALo(16,"async"),t.TgZ(17,"p"),t._uU(18,"\xa0"),t.qZA(),t.TgZ(19,"mat-toolbar"),t.TgZ(20,"button",6),t.NdJ("click",function(){return a.goBack()}),t._uU(21," Cancel "),t.qZA(),t._UZ(22,"span",7),t.YNc(23,Vi,2,1,"mat-slide-toggle",8),t._uU(24," \xa0\xa0\xa0\xa0 "),t.TgZ(25,"button",9),t.NdJ("click",function(){return a.sendCommand()}),t.ALo(26,"async"),t.TgZ(27,"mat-icon"),t._uU(28,"send"),t.qZA(),t._uU(29," Send "),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(30,Gi,1,0,"ng-template",null,10,t.W1O)),2&e){const o=t.MAs(14);t.xp6(5),t.Q6J("ngIf",t.lcZ(6,9,a.command$)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(8,11,a.cleared$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(10,13,a.command$)),t.xp6(2),t.Q6J("ngIf",o.arguments.length||o.argumentsWithInitial.length),t.xp6(1),t.Q6J("ngIf",o.arguments.length||o.argumentsWithInitial.length),t.xp6(1),t.Q6J("command",t.lcZ(15,15,a.command$))("templateProvider",t.lcZ(16,17,a.templateProvider$)),t.xp6(10),t.Q6J("ngIf",a.config.twoStageCommanding),t.xp6(2),t.Q6J("disabled",a.config.twoStageCommanding&&!a.armControl.value||!t.lcZ(26,19,a.cleared$)||!o.form.valid)}},directives:[A.a,S.k,it,d.O5,d.sg,Ot.U,Y.U,Ni.j,Yt.O,Ft.Q,Jt,Q.Ye,Ui.Rr,l.JJ,l.oH,v.Hw],pipes:[d.Ov,Mt.y,st.B,j.m],styles:[".evaluation[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace;background-color:#ffeef0;color:red;padding-left:2px;padding-right:2px}.evaluation.valid[_ngcontent-%COMP%]{background-color:#e6ffed;color:#00c752}"],changeDetection:0}),n})();class Wi{constructor(i){this.entry=i}getAssignment(i){if(this.entry.assignments)for(const e of this.entry.assignments)if(e.name===i)return e.value}getComment(){}}var zi=m(7740),Et=m(4298),Lt=m(1821),lt=m(5632),Ht=m(7365),Xi=m(1672);const Ki=["top"];function to(n,i){if(1&n&&t._UZ(0,"app-breadcrumb",16),2&n){const e=i.$implicit;t.Q6J("link",e.route)("queryParams",e.queryParams)("label",e.name)}}const Bt=function(n){return{c:n}};function eo(n,i){if(1&n&&(t.TgZ(0,"div",6),t.TgZ(1,"app-breadcrumb-trail"),t._UZ(2,"app-breadcrumb",14),t.YNc(3,to,1,3,"app-breadcrumb",15),t.qZA(),t.qZA()),2&n){const e=t.oxw().ngIf,a=t.oxw(2);t.xp6(2),t.Q6J("queryParams",t.VKq(2,Bt,a.yamcs.context)),t.xp6(1),t.Q6J("ngForOf",e)}}function no(n,i){if(1&n&&(t.ynx(0),t.YNc(1,eo,4,4,"div",13),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("ngIf",e.length)}}function ao(n,i){1&n&&(t.TgZ(0,"th",31),t._uU(1,"Significance"),t.qZA())}function io(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-significance-level",34),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("level",e.consequenceLevel)}}function oo(n,i){if(1&n&&(t.TgZ(0,"td",32),t.YNc(1,io,2,1,"ng-container",33),t.ALo(2,"effectiveSignificance"),t.qZA()),2&n){const e=i.$implicit;t.oxw(3);const a=t.MAs(9);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,e.command))("ngIfElse",a)}}function co(n,i){1&n&&(t.TgZ(0,"th",31),t._uU(1,"Name"),t.qZA())}const so=function(){return["/commanding/send"]},lo=function(n,i){return{c:n,system:i}};function ro(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",36),t._uU(2,"folder"),t.qZA(),t.TgZ(3,"a",37),t._uU(4),t.ALo(5,"filename"),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit,a=t.oxw(3);t.xp6(3),t.Q6J("routerLink",t.DdM(5,so))("queryParams",t.WLB(6,lo,a.yamcs.context,e.name)),t.xp6(1),t.hij(" ",t.lcZ(5,3,e.name),"/ ")}}function mo(n,i){if(1&n&&t._UZ(0,"app-highlight",39),2&n){const e=t.oxw(2).$implicit,a=t.oxw(3);t.Q6J("text",e.command.qualifiedName)("term",a.filterControl.value)}}function uo(n,i){if(1&n&&(t._UZ(0,"app-highlight",39),t.ALo(1,"slice")),2&n){const e=t.oxw(2).$implicit,a=t.oxw(3);t.Q6J("text",t.xi3(1,2,e.command.qualifiedName,a.system.length+1))("term",a.filterControl.value)}}const _o=function(n){return["/commanding/send",n]};function po(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",36),t._uU(2,"rss_feed"),t.qZA(),t.TgZ(3,"a",37),t.YNc(4,mo,1,2,"app-highlight",38),t.YNc(5,uo,2,5,"app-highlight",38),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit,a=t.oxw(3);t.xp6(3),t.Q6J("routerLink",t.VKq(4,_o,e.command.qualifiedName))("queryParams",t.VKq(6,Bt,a.yamcs.context)),t.xp6(1),t.Q6J("ngIf",!a.system),t.xp6(1),t.Q6J("ngIf",a.system)}}function go(n,i){if(1&n&&(t.TgZ(0,"td",35),t.YNc(1,ro,6,9,"ng-container",5),t.YNc(2,po,6,8,"ng-container",5),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.spaceSystem),t.xp6(1),t.Q6J("ngIf",!e.spaceSystem)}}function fo(n,i){1&n&&(t.TgZ(0,"th",31),t._uU(1,"Description"),t.qZA())}function ho(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-highlight",39),t.BQk()),2&n){const e=i.ngIf,a=t.oxw(4);t.xp6(1),t.Q6J("text",e)("term",a.filterControl.value)}}function xo(n,i){if(1&n&&(t.TgZ(0,"td",40),t.YNc(1,ho,2,2,"ng-container",33),t.qZA()),2&n){const e=i.$implicit;t.oxw(3);const a=t.MAs(9);t.xp6(1),t.Q6J("ngIf",null==e.command?null:e.command.shortDescription)("ngIfElse",a)}}function To(n,i){if(1&n&&(t.TgZ(0,"th",31),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.label," ")}}function Zo(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-highlight",39),t.BQk()),2&n){const e=i.ngIf,a=t.oxw(5);t.xp6(1),t.Q6J("text",e)("term",a.filterControl.value)}}function yo(n,i){if(1&n&&(t.TgZ(0,"td",32),t.YNc(1,Zo,2,2,"ng-container",33),t.ALo(2,"alias"),t.qZA()),2&n){const e=i.$implicit,a=t.oxw().$implicit;t.oxw(3);const o=t.MAs(9);t.xp6(1),t.Q6J("ngIf",t.xi3(2,2,e.command,a.id))("ngIfElse",o)}}function Co(n,i){1&n&&(t.ynx(0,41),t.YNc(1,To,2,1,"th",19),t.YNc(2,yo,3,5,"td",20),t.BQk()),2&n&&t.Q6J("matColumnDef",i.$implicit.id)}function bo(n,i){1&n&&t._UZ(0,"th",42)}function vo(n,i){1&n&&t._UZ(0,"td",32)}function Ao(n,i){1&n&&t._UZ(0,"tr",43)}function So(n,i){if(1&n&&t._UZ(0,"tr",44),2&n){const e=i.$implicit,a=t.oxw(3);t.ekj("selected",a.selection.isSelected(e))}}function ko(n,i){if(1&n&&(t.TgZ(0,"table",17),t.ynx(1,18),t.YNc(2,ao,2,0,"th",19),t.YNc(3,oo,3,4,"td",20),t.BQk(),t.ynx(4,21),t.YNc(5,co,2,0,"th",22),t.YNc(6,go,3,2,"td",23),t.BQk(),t.ynx(7,24),t.YNc(8,fo,2,0,"th",19),t.YNc(9,xo,2,2,"td",25),t.BQk(),t.YNc(10,Co,3,1,"ng-container",26),t.ALo(11,"async"),t.ynx(12,27),t.YNc(13,bo,1,0,"th",28),t.YNc(14,vo,1,0,"td",20),t.BQk(),t.YNc(15,Ao,1,0,"tr",29),t.ALo(16,"async"),t.YNc(17,So,1,2,"tr",30),t.ALo(18,"async"),t.qZA()),2&n){t.oxw();const e=t.MAs(7),a=t.oxw();t.Q6J("dataSource",a.dataSource),t.xp6(10),t.Q6J("ngForOf",t.lcZ(11,4,a.aliasColumns$)),t.xp6(5),t.Q6J("matHeaderRowDef",t.lcZ(16,6,e.displayedColumns$)),t.xp6(2),t.Q6J("matRowDefColumns",t.lcZ(18,8,e.displayedColumns$))}}function wo(n,i){1&n&&(t.ynx(0),t._uU(1,"replay"),t.BQk())}function qo(n,i){if(1&n&&(t.TgZ(0,"app-empty-message",45),t.TgZ(1,"p"),t._uU(2," You are connected to the "),t.YNc(3,wo,2,0,"ng-container",5),t._uU(4," processor "),t.TgZ(5,"strong"),t._uU(6),t.qZA(),t._uU(7,". "),t.qZA(),t.TgZ(8,"p"),t._uU(9," This processor does not support commanding. "),t.qZA(),t.qZA()),2&n){const e=t.oxw().ngIf;t.xp6(3),t.Q6J("ngIf",null==e.processor?null:e.processor.replay),t.xp6(3),t.Oqu(null==e.processor?null:e.processor.name)}}function No(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",4),t.TgZ(1,"div"),t.YNc(2,no,2,1,"ng-container",5),t.ALo(3,"async"),t.TgZ(4,"div",6),t.TgZ(5,"app-search-filter",7),t.NdJ("onArrowDown",function(){return t.CHM(e),t.oxw().selectNext()})("onArrowUp",function(){return t.CHM(e),t.oxw().selectPrevious()})("onEnter",function(){return t.CHM(e),t.oxw().applySelection()}),t.qZA(),t._UZ(6,"app-column-chooser",8,9),t.qZA(),t.YNc(8,ko,19,10,"table",10),t._UZ(9,"mat-paginator",11),t.ALo(10,"async"),t.qZA(),t.YNc(11,qo,10,2,"app-empty-message",12),t.qZA()}if(2&n){const e=i.ngIf,a=t.oxw();t.xp6(1),t.ekj("noDisplay",!(null!=e.processor&&e.processor.hasCommanding)),t.xp6(1),t.Q6J("ngIf",t.lcZ(3,11,a.breadcrumb$)),t.xp6(3),t.Q6J("formControl",a.filterControl),t.xp6(1),t.Q6J("columns",a.columns),t.xp6(2),t.Q6J("ngIf",a.dataSource),t.xp6(1),t.Q6J("pageSize",a.pageSize)("hidePageSize",!0)("showFirstLastButtons",!0)("length",t.lcZ(10,13,a.dataSource.totalSize$)),t.xp6(2),t.Q6J("ngIf",!(null!=e.processor&&e.processor.hasCommanding))}}function Uo(n,i){1&n&&t._uU(0," -\n")}let Rt=(()=>{class n{constructor(e,a,o,c){this.yamcs=a,this.route=o,this.router=c,this.pageSize=100,this.system=null,this.breadcrumb$=new T.X([]),this.filterControl=new l.NI,this.columns=[{id:"name",label:"Name",alwaysVisible:!0},{id:"significance",label:"Significance",visible:!0},{id:"shortDescription",label:"Description"},{id:"actions",label:"",alwaysVisible:!0}],this.aliasColumns$=new T.X([]),this.selection=new M.Ov(!1),e.setTitle("Send a command"),this.connectionInfo$=a.connectionInfo$,this.dataSource=new zi.S(a)}ngAfterViewInit(){this.filterControl.setValue(this.route.snapshot.queryParamMap.get("filter")),this.changeSystem(this.route.snapshot.queryParamMap),this.queryParamMapSubscription=this.route.queryParamMap.subscribe(e=>{e.get("system")!==this.system&&this.changeSystem(e)}),this.filterControl.valueChanges.subscribe(()=>{this.paginator.pageIndex=0,this.updateDataSource()}),this.paginator.page.subscribe(()=>{this.updateDataSource(),this.top.nativeElement.scrollIntoView()})}changeSystem(e){this.system=e.get("system"),this.updateBrowsePath(),this.paginator.pageIndex=e.has("page")?Number(e.get("page")):0,this.updateDataSource()}updateDataSource(){this.updateURL();const e={system:this.system||"/",noAbstract:!0,details:!0,pos:this.paginator.pageIndex*this.pageSize,limit:this.pageSize},a=this.filterControl.value;a&&(e.q=a.toLowerCase()),this.dataSource.loadCommands(e).then(()=>{this.selection.clear(),this.updateBrowsePath();for(const c of this.aliasColumns$.value){const s=this.columns.indexOf(c);-1!==s&&this.columns.splice(s,1)}const o=[];for(const c of this.dataSource.getAliasNamespaces())o.push({id:c,label:c,alwaysVisible:!0});this.columns.splice(1,0,...o),this.aliasColumns$.next(o),this.columnChooser.recalculate(this.columns)})}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{page:this.paginator.pageIndex||null,filter:this.filterControl.value||null,system:this.system||null},queryParamsHandling:"merge"})}updateBrowsePath(){const e=[];let a="";if(this.system)for(const o of this.system.slice(1).split("/"))a+="/"+o,e.push({name:o,route:"/commanding/send",queryParams:{system:a,c:this.yamcs.context}});this.breadcrumb$.next(e)}selectNext(){const e=this.dataSource.items$.value;let a=0;if(this.selection.hasValue()){const o=this.selection.selected[0];-1!==e.indexOf(o)&&(a=Math.min(e.indexOf(o)+1,e.length-1))}this.selection.select(e[a])}selectPrevious(){const e=this.dataSource.items$.value;let a=0;if(this.selection.hasValue()){const o=this.selection.selected[0];-1!==e.indexOf(o)&&(a=Math.max(e.indexOf(o)-1,0))}this.selection.select(e[a])}applySelection(){var e;if(this.selection.hasValue()){const a=this.selection.selected[0],o=this.dataSource.items$.value;a.command&&-1!==o.indexOf(a)&&this.router.navigate(["/commanding/send",null===(e=a.command)||void 0===e?void 0:e.qualifiedName],{queryParams:{c:this.yamcs.context}})}}ngOnDestroy(){this.queryParamMapSubscription&&this.queryParamMapSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(k.Dx),t.Y36(y.C),t.Y36(h.gz),t.Y36(h.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&(t.Gf(Ki,7),t.Gf(J.NW,5),t.Gf(nt.k,5)),2&e){let o;t.iGM(o=t.CRH())&&(a.top=o.first),t.iGM(o=t.CRH())&&(a.paginator=o.first),t.iGM(o=t.CRH())&&(a.columnChooser=o.first)}},decls:10,vars:3,consts:[["top",""],["step","1"],["class","panel-content",4,"ngIf"],["dash",""],[1,"panel-content"],[4,"ngIf"],[1,"filter-bar"],["placeholder","Search by name","icon","search",3,"formControl","onArrowDown","onArrowUp","onEnter"],["preferenceKey","sendCommand",3,"columns"],["columnChooser",""],["mat-table","","class","ya-data-table expand",3,"dataSource",4,"ngIf"],[3,"pageSize","hidePageSize","showFirstLastButtons","length"],["headerTitle","Send a command",4,"ngIf"],["class","filter-bar",4,"ngIf"],["link","/commanding/send","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label",4,"ngFor","ngForOf"],[3,"link","queryParams","label"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","significance"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","","class","primary-td",4,"matCellDef"],["matColumnDef","shortDescription"],["mat-cell","","class","wrap200",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[4,"ngIf","ngIfElse"],[3,"level"],["mat-cell","",1,"primary-td"],[1,"icon12",2,"vertical-align","middle"],[3,"routerLink","queryParams"],[3,"text","term",4,"ngIf"],[3,"text","term"],["mat-cell","",1,"wrap200"],[3,"matColumnDef"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""],["headerTitle","Send a command"]],template:function(e,a){1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Send a command "),t.qZA(),t._UZ(3,"span",null,0),t._UZ(5,"app-send-command-wizard-step",1),t.YNc(6,No,12,15,"div",2),t.ALo(7,"async"),t.qZA(),t.YNc(8,Uo,1,0,"ng-template",null,3,t.W1O)),2&e&&(t.xp6(6),t.Q6J("ngIf",t.lcZ(7,1,a.connectionInfo$)))},directives:[A.a,S.k,it,d.O5,Et.w,Lt.a,d.sg,et.a,l.JJ,l.oH,nt.k,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,Y.U,b.fo,b.D5,v.Hw,h.yS,wt.y,r.as,r.XQ,r.nj,r.Gk,J.NW,lt.M],pipes:[d.Ov,j.m,Ht.X,d.OU,Xi.p],styles:[".pullRight[_ngcontent-%COMP%]{float:right}.primary-td[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:7px}"],changeDetection:0}),n})();const Qo=["intervalSelect"];function Po(n,i){if(1&n){const e=t.EpF();t.ynx(0),t._UZ(1,"app-date-time-input",15),t._UZ(2,"app-date-time-input",16),t.TgZ(3,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().applyCustomDates()}),t._uU(4,"Apply"),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("disabled",e.filterForm.invalid)}}function Io(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().jumpToNow()}),t._uU(2," Jump to now "),t.qZA(),t.BQk()}}function Do(n,i){1&n&&(t.TgZ(0,"th",19),t._uU(1,"Time"),t.qZA())}function Jo(n,i){if(1&n&&(t.TgZ(0,"td",20),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,e.time))}}function Oo(n,i){1&n&&(t.TgZ(0,"th",19),t._uU(1,"User"),t.qZA())}function Yo(n,i){if(1&n&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Oqu(e.user||"-")}}function Fo(n,i){1&n&&(t.TgZ(0,"th",19),t._uU(1,"Action"),t.qZA())}function Mo(n,i){if(1&n&&(t.TgZ(0,"td",20),t._UZ(1,"span",21),t.ALo(2,"actionLogFormat"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,e.summary)||"-",t.oJD)}}function $o(n,i){1&n&&t._UZ(0,"th",22)}function Eo(n,i){1&n&&t._UZ(0,"td",20)}function Lo(n,i){1&n&&t._UZ(0,"tr",23)}function Ho(n,i){1&n&&t._UZ(0,"tr",24)}let jt=(()=>{class n{constructor(e,a,o,c){this.yamcs=e,this.messageService=a,this.router=o,this.route=c,this.filterForm=new l.cw({filter:new l.NI,interval:new l.NI("NO_LIMIT"),customStart:new l.NI(null),customStop:new l.NI(null)}),this.displayedColumns=["time","user","summary","actions"],this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.dataSource=new r.by,this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(s=>{if("CUSTOM"===s){const u=new Date,_=this.validStart||u,f=this.validStop||u;this.filterForm.get("customStart").setValue(x.Y6(_)),this.filterForm.get("customStop").setValue(x.Y6(f))}else"NO_LIMIT"===s?(this.validStart=null,this.validStop=null,this.appliedInterval=s,this.loadData()):(this.validStop=new Date,this.validStart=(0,x.rV)(this.validStop,s),this.appliedInterval=s,this.loadData())})}initializeOptions(){const e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),"CUSTOM"===this.appliedInterval){const a=e.get("customStart");this.filterForm.get("customStart").setValue(a),this.validStart=x.ZU(a);const o=e.get("customStop");this.filterForm.get("customStop").setValue(o),this.validStop=x.ZU(o)}else"NO_LIMIT"===this.appliedInterval?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=(0,x.rV)(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=x.ZU(this.filterForm.value.customStart),this.validStop=x.ZU(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();const e={service:"QueueApi"};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.filter&&(e.q=this.filter),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,e).then(a=>this.dataSource.data=a.records||[]).catch(a=>this.messageService.showError(a))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,interval:this.appliedInterval,customStart:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStart:null,customStop:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C),t.Y36(I.e),t.Y36(h.F0),t.Y36(h.gz))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&t.Gf(Qo,5),2&e){let o;t.iGM(o=t.CRH())&&(a.intervalSelect=o.first)}},decls:21,vars:7,consts:[[3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],["intervalSelect",""],[4,"ngIf"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"disabled","click"],[1,"ya-button",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(e,a){1&e&&(t.TgZ(0,"form",0),t.TgZ(1,"div",1),t._UZ(2,"app-select",2,3),t.YNc(4,Po,5,1,"ng-container",4),t.YNc(5,Io,3,0,"ng-container",4),t.qZA(),t.qZA(),t.TgZ(6,"table",5),t.ynx(7,6),t.YNc(8,Do,2,0,"th",7),t.YNc(9,Jo,3,3,"td",8),t.BQk(),t.ynx(10,9),t.YNc(11,Oo,2,0,"th",7),t.YNc(12,Yo,2,1,"td",8),t.BQk(),t.ynx(13,10),t.YNc(14,Fo,2,0,"th",7),t.YNc(15,Mo,3,3,"td",8),t.BQk(),t.ynx(16,11),t.YNc(17,$o,1,0,"th",12),t.YNc(18,Eo,1,0,"td",8),t.BQk(),t.YNc(19,Lo,1,0,"tr",13),t.YNc(20,Ho,1,0,"tr",14),t.qZA()),2&e&&(t.Q6J("formGroup",a.filterForm),t.xp6(2),t.Q6J("options",a.intervalOptions),t.xp6(2),t.Q6J("ngIf","CUSTOM"===a.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf","CUSTOM"!==a.filterForm.value.interval),t.xp6(1),t.Q6J("dataSource",a.dataSource),t.xp6(13),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns))},directives:[l._Y,l.JL,l.sg,B.P,l.JJ,l.u,d.O5,R.Y,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk],pipes:[N.i,ht.N],encapsulation:2,changeDetection:0}),n})();function Bo(n,i){1&n&&(t.TgZ(0,"th",18),t._uU(1,"Time"),t.qZA())}function Ro(n,i){if(1&n&&(t.TgZ(0,"td",19),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e.generationTime)," ")}}function jo(n,i){1&n&&(t.TgZ(0,"th",20),t.TgZ(1,"mat-icon",21),t._uU(2,"comment"),t.qZA(),t.qZA())}function Vo(n,i){if(1&n&&(t.TgZ(0,"mat-icon",25),t._uU(1,"comment"),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("matTooltip",e.comment)}}function Go(n,i){1&n&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function Wo(n,i){if(1&n&&(t.TgZ(0,"td",22),t.YNc(1,Vo,2,1,"mat-icon",23),t.YNc(2,Go,2,0,"ng-container",24),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.comment),t.xp6(1),t.Q6J("ngIf",!e.comment)}}function zo(n,i){1&n&&(t.TgZ(0,"th",18),t._uU(1,"Command"),t.qZA())}function Xo(n,i){if(1&n&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.commandName||"-"," ")}}function Ko(n,i){1&n&&(t.TgZ(0,"th",18),t._uU(1,"Queue"),t.qZA())}function tc(n,i){if(1&n&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.queueName||"-"," ")}}function ec(n,i){1&n&&(t.TgZ(0,"th",18),t._uU(1,"Issuer"),t.qZA())}function nc(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij("@",e.origin,"")}}function ac(n,i){if(1&n&&(t.TgZ(0,"td",19),t._uU(1),t.YNc(2,nc,2,1,"span",24),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.username,""),t.xp6(1),t.Q6J("ngIf",e.origin)}}function ic(n,i){1&n&&(t.TgZ(0,"th",18),t._uU(1,"Source"),t.qZA())}function oc(n,i){if(1&n&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.origin||"-"," ")}}function cc(n,i){1&n&&(t.TgZ(0,"th",26),t._uU(1,"Command"),t.qZA())}function sc(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"tr"),t.TgZ(2,"td",29),t._uU(3),t.qZA(),t.TgZ(4,"td",30),t._uU(5),t.ALo(6,"value"),t.qZA(),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(t.lcZ(6,2,e.value))}}function lc(n,i){if(1&n&&(t.ynx(0),t.YNc(1,sc,7,4,"ng-container",24),t.BQk()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.userInput)}}function rc(n,i){if(1&n&&(t.TgZ(0,"td",19),t._uU(1),t.TgZ(2,"table",27),t.YNc(3,lc,2,1,"ng-container",28),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.commandName," "),t.xp6(2),t.Q6J("ngForOf",e.assignments)}}function mc(n,i){1&n&&(t.TgZ(0,"th",31),t._uU(1,"Actions"),t.qZA())}function uc(n,i){1&n&&(t.TgZ(0,"span",33),t.TgZ(1,"mat-icon",34),t._uU(2,"cached"),t.qZA(),t._uU(3," Checking transmission constraints "),t.qZA())}function dc(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-text-action",35),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(2).acceptEntry(o)}),t._uU(2,"ACCEPT"),t.qZA(),t.TgZ(3,"app-text-action",36),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(2).rejectEntry(o)}),t._uU(4,"REJECT"),t.qZA(),t.BQk()}if(2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("disabled",e.pendingTransmissionConstraints),t.xp6(2),t.Q6J("disabled",e.pendingTransmissionConstraints)}}function _c(n,i){if(1&n&&(t.TgZ(0,"td",19),t.YNc(1,uc,4,0,"span",32),t.YNc(2,dc,5,2,"ng-container",24),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.pendingTransmissionConstraints),t.xp6(1),t.Q6J("ngIf",!e.pendingTransmissionConstraints)}}function pc(n,i){1&n&&t._UZ(0,"tr",37)}function gc(n,i){1&n&&t._UZ(0,"tr",38)}function fc(n,i){if(1&n&&(t.TgZ(0,"table",1),t.ynx(1,2),t.YNc(2,Bo,2,0,"th",3),t.YNc(3,Ro,3,3,"td",4),t.BQk(),t.ynx(4,5),t.YNc(5,jo,3,0,"th",6),t.YNc(6,Wo,3,2,"td",7),t.BQk(),t.ynx(7,8),t.YNc(8,zo,2,0,"th",3),t.YNc(9,Xo,2,1,"td",4),t.BQk(),t.ynx(10,9),t.YNc(11,Ko,2,0,"th",3),t.YNc(12,tc,2,1,"td",4),t.BQk(),t.ynx(13,10),t.YNc(14,ec,2,0,"th",3),t.YNc(15,ac,3,2,"td",4),t.BQk(),t.ynx(16,11),t.YNc(17,ic,2,0,"th",3),t.YNc(18,oc,2,1,"td",4),t.BQk(),t.ynx(19,12),t.YNc(20,cc,2,0,"th",13),t.YNc(21,rc,4,2,"td",4),t.BQk(),t.ynx(22,14),t.YNc(23,mc,2,0,"th",15),t.YNc(24,_c,3,2,"td",4),t.BQk(),t.YNc(25,pc,1,0,"tr",16),t.YNc(26,gc,1,0,"tr",17),t.qZA()),2&n){const e=t.oxw();t.Q6J("dataSource",e.dataSource),t.xp6(25),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns)}}let hc=(()=>{class n{constructor(e){this.yamcs=e,this.dataSource=new r.by,this.displayedColumns=["generationTime","comment","source","queueName","issuer","actions"]}ngAfterViewInit(){this.dataSource.sort=this.sort,this.cqueues$.subscribe(e=>{const a=[];for(const o of e)o.entry&&a.push(...o.entry);this.dataSource.data=a})}acceptEntry(e){confirm(`Are you sure you want to accept this command?\n\n ${e.commandName}`)&&this.yamcs.yamcsClient.acceptCommand(e.instance,e.processorName,e.queueName,e.id)}rejectEntry(e){confirm(`Are you sure you want to reject this command?\n\n ${e.commandName}`)&&this.yamcs.yamcsClient.rejectCommand(e.instance,e.processorName,e.queueName,e.id)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-queued-commands-table"]],viewQuery:function(e,a){if(1&e&&t.Gf(O.YE,5),2&e){let o;t.iGM(o=t.CRH())&&(a.sort=o.first)}},inputs:{cqueues$:"cqueues$"},decls:1,vars:1,consts:[["mat-table","","class","ya-data-table expand","matSort","","matSortActive","generationTime","matSortDirection","asc","matSortDisableClear","",3,"dataSource",4,"ngIf"],["mat-table","","matSort","","matSortActive","generationTime","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","generationTime"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","comment"],["mat-header-cell","","style","text-align: center",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","commandName"],["matColumnDef","queueName"],["matColumnDef","issuer"],["matColumnDef","origin"],["matColumnDef","source"],["mat-header-cell","","mat-sort-header","","style","width: 350px",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",2,"text-align","center"],["matTooltip","Comment"],["mat-cell","",2,"text-align","center"],[3,"matTooltip",4,"ngIf"],[4,"ngIf"],[3,"matTooltip"],["mat-header-cell","","mat-sort-header","",2,"width","350px"],[1,"args"],[4,"ngFor","ngForOf"],["width","1",1,"key"],[1,"value"],["mat-header-cell","",1,"expand"],["style","color: #999",4,"ngIf"],[2,"color","#999"],[1,"icon16","spin",2,"vertical-align","middle"],["icon","check",3,"disabled","click"],["icon","close",3,"disabled","click"],["mat-header-row",""],["mat-row",""]],template:function(e,a){1&e&&t.YNc(0,fc,27,3,"table",0),2&e&&t.Q6J("ngIf",a.dataSource)},directives:[d.O5,r.BZ,O.YE,r.w1,r.fO,r.ge,O.nU,r.Dz,r.ev,v.Hw,w.gM,d.sg,ot.l,r.as,r.XQ,r.nj,r.Gk],pipes:[N.i,K.V],styles:[".args[_ngcontent-%COMP%]{margin:0 0 0 10px}.args[_ngcontent-%COMP%]   .key[_ngcontent-%COMP%]{min-width:120px;white-space:nowrap}.args[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:gray;padding-left:10px}.args[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .args[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border:none;font-size:10px;line-height:12px;font-family:Roboto Mono,monospace}"],changeDetection:0}),n})();function xc(n,i){if(1&n&&t._UZ(0,"app-queued-commands-table",2),2&n){const e=t.oxw();t.Q6J("cqueues$",e.cqueues$)}}function Tc(n,i){1&n&&t._uU(0," All queues are empty.\n")}let Vt=(()=>{class n{constructor(e){this.cqueues$=new T.X([]),this.hasEntries$=new T.X(!1),this.cqueueByName={},e.yamcsClient.getCommandQueues(e.instance,e.processor).then(a=>{for(const o of a)this.cqueueByName[o.name]=o;this.emitChange()}),this.queueEventSubscription=e.yamcsClient.createQueueEventsSubscription({instance:e.instance,processor:e.processor},a=>{const o=this.cqueueByName[a.data.queueName];if(o){if("COMMAND_ADDED"===a.type)o.entry=o.entry||[],o.entry.push(a.data);else if("COMMAND_UPDATED"===a.type){const c=(o.entry||[]).findIndex(s=>s.id===a.data.id);-1!==c&&(o.entry[c]=a.data)}else if("COMMAND_REJECTED"===a.type)o.entry=o.entry||[],o.entry=o.entry.filter(c=>c.id!==a.data.id);else{if("COMMAND_SENT"!==a.type)throw new Error(`Unexpected queue event ${a.type}`);o.entry=o.entry||[],o.entry=o.entry.filter(c=>c.id!==a.data.id)}this.emitChange()}else console.warn("Received an event for an unknown queue",a)})}emitChange(){this.cqueues$.next(Object.values(this.cqueueByName));let e=!1;for(const a of this.cqueues$.getValue())if(a.entry&&a.entry.length){e=!0;break}this.hasEntries$.next(e)}ngOnDestroy(){this.queueEventSubscription&&this.queueEventSubscription.cancel()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:4,vars:4,consts:[[3,"cqueues$",4,"ngIf","ngIfElse"],["empty",""],[3,"cqueues$"]],template:function(e,a){if(1&e&&(t.YNc(0,xc,1,1,"app-queued-commands-table",0),t.ALo(1,"async"),t.YNc(2,Tc,1,0,"ng-template",null,1,t.W1O)),2&e){const o=t.MAs(3);t.Q6J("ngIf",t.lcZ(1,2,a.hasEntries$))("ngIfElse",o)}},directives:[d.O5,hc],pipes:[d.Ov],encapsulation:2,changeDetection:0}),n})();var Zc=m(4763);function yc(n,i){1&n&&(t.TgZ(0,"th",15),t._uU(1,"#"),t.qZA())}function Cc(n,i){if(1&n&&(t.TgZ(0,"td",16),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.order," ")}}function bc(n,i){1&n&&(t.TgZ(0,"th",15),t._uU(1,"Queue"),t.qZA())}function vc(n,i){if(1&n&&(t.TgZ(0,"td",16),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function Ac(n,i){1&n&&(t.TgZ(0,"th",15),t._uU(1,"Issuer"),t.qZA())}function Sc(n,i){if(1&n&&(t.TgZ(0,"app-label",20),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Oqu(e)}}function kc(n,i){if(1&n&&(t.TgZ(0,"app-label",21),t._uU(1),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Oqu(e)}}function wc(n,i){1&n&&(t.ynx(0),t._uU(1,"any"),t.BQk())}function qc(n,i){if(1&n&&(t.TgZ(0,"td",16),t.YNc(1,Sc,2,1,"app-label",17),t.YNc(2,kc,2,1,"app-label",18),t.YNc(3,wc,2,0,"ng-container",19),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngForOf",e.groups),t.xp6(1),t.Q6J("ngForOf",e.users),t.xp6(1),t.Q6J("ngIf",!e.groups&&!e.users)}}function Nc(n,i){1&n&&(t.TgZ(0,"th",15),t._uU(1,"Min.\xa0level"),t.qZA())}function Uc(n,i){if(1&n&&(t.TgZ(0,"td",16),t._UZ(1,"app-significance-level",22),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("level",e.minLevel)("grayscale",!0)}}function Qc(n,i){1&n&&(t.TgZ(0,"th",15),t._uU(1,"Action"),t.qZA())}function Pc(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1," ACCEPT "),t.qZA())}function Ic(n,i){if(1&n&&(t.TgZ(0,"span"),t.ALo(1,"async"),t._uU(2," HOLD "),t.qZA()),2&n){const e=t.oxw(3);t.Udp("visibility",t.lcZ(1,2,e.visibility$)?"visible":"hidden")}}function Dc(n,i){1&n&&(t.TgZ(0,"span"),t._uU(1," REJECT "),t.qZA())}function Jc(n,i){if(1&n&&(t.TgZ(0,"td",16),t.YNc(1,Pc,2,0,"span",19),t.YNc(2,Ic,3,4,"span",23),t.YNc(3,Dc,2,0,"span",19),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf","ENABLED"===e.state),t.xp6(1),t.Q6J("ngIf","BLOCKED"===e.state),t.xp6(1),t.Q6J("ngIf","DISABLED"===e.state)}}function Oc(n,i){1&n&&(t.TgZ(0,"th",15),t._uU(1,"Pending"),t.qZA())}function Yc(n,i){if(1&n&&(t.TgZ(0,"td",24),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,(null==e.entry?null:e.entry.length)||0)," ")}}function Fc(n,i){1&n&&t._UZ(0,"th",25)}const Mc=function(n,i){return{c:n,queue:i}};function $c(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"td",16),t.TgZ(1,"app-more"),t.TgZ(2,"button",26),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).enableQueue(c)}),t.TgZ(3,"mat-icon"),t._uU(4,"check"),t.qZA(),t._uU(5," Accept mode "),t.qZA(),t.TgZ(6,"button",26),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).blockQueue(c)}),t.TgZ(7,"mat-icon"),t._uU(8,"pause"),t.qZA(),t._uU(9," Hold mode "),t.qZA(),t.TgZ(10,"button",26),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).disableQueue(c)}),t.TgZ(11,"mat-icon"),t._uU(12,"close"),t.qZA(),t._uU(13," Reject mode "),t.qZA(),t._UZ(14,"mat-divider"),t.TgZ(15,"a",27),t._uU(16," View command history "),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw(2);t.xp6(15),t.Q6J("queryParams",t.WLB(1,Mc,a.yamcs.context,e.name))}}function Ec(n,i){1&n&&t._UZ(0,"tr",28)}function Lc(n,i){1&n&&t._UZ(0,"tr",29)}function Hc(n,i){if(1&n&&(t.TgZ(0,"table",1),t.ynx(1,2),t.YNc(2,yc,2,0,"th",3),t.YNc(3,Cc,2,1,"td",4),t.BQk(),t.ynx(4,5),t.YNc(5,bc,2,0,"th",3),t.YNc(6,vc,2,1,"td",4),t.BQk(),t.ynx(7,6),t.YNc(8,Ac,2,0,"th",3),t.YNc(9,qc,4,3,"td",4),t.BQk(),t.ynx(10,7),t.YNc(11,Nc,2,0,"th",3),t.YNc(12,Uc,2,2,"td",4),t.BQk(),t.ynx(13,8),t.YNc(14,Qc,2,0,"th",3),t.YNc(15,Jc,4,3,"td",4),t.BQk(),t.ynx(16,9),t.YNc(17,Oc,2,0,"th",3),t.YNc(18,Yc,3,3,"td",10),t.BQk(),t.ynx(19,11),t.YNc(20,Fc,1,0,"th",12),t.YNc(21,$c,17,4,"td",4),t.BQk(),t.YNc(22,Ec,1,0,"tr",13),t.YNc(23,Lc,1,0,"tr",14),t.qZA()),2&n){const e=t.oxw();t.Q6J("dataSource",e.dataSource)("trackBy",e.tableTrackerFn),t.xp6(22),t.Q6J("matHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",e.displayedColumns)}}let Bc=(()=>{class n{constructor(e,a,o){this.yamcs=e,this.changeDetection=a,this.dataSource=new r.by,this.displayedColumns=["order","name","issuer","level","action","pending","actions"],this.visibility$=new T.X(!0),this.tableTrackerFn=(c,s)=>s.name,this.syncSubscription=o.syncFast(()=>{this.visibility$.next(!this.visibility$.value)})}ngAfterViewInit(){this.cqueues$.subscribe(e=>{this.dataSource.data=e,this.changeDetection.detectChanges()})}enableQueue(e){var a;const o=(null===(a=e.entry)||void 0===a?void 0:a.length)||0;let c="Are you sure you want to change this queue's action to ACCEPT?\n\n";c+=1===o?`There is ${o} queued command that will be accepted immediately.`:`There are ${o} queued commands that will be accepted immediately.`,(!o||confirm(c))&&this.yamcs.yamcsClient.enableCommandQueue(e.instance,e.processorName,e.name)}disableQueue(e){var a;const o=(null===(a=e.entry)||void 0===a?void 0:a.length)||0;let c="Are you sure you want to change this queue's action to REJECT?\n\n";c+=1===o?`There is ${o} queued command that will be rejected immediately.`:`There are ${o} queued commands that will be rejected immediately.`,(!o||confirm(c))&&this.yamcs.yamcsClient.disableCommandQueue(e.instance,e.processorName,e.name)}blockQueue(e){this.yamcs.yamcsClient.blockCommandQueue(e.instance,e.processorName,e.name)}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C),t.Y36(t.sBO),t.Y36(At.j))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-queues-table"]],inputs:{cqueues$:"cqueues$"},decls:1,vars:1,consts:[["mat-table","","class","ya-data-table expand",3,"dataSource","trackBy",4,"ngIf"],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["matColumnDef","order"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","issuer"],["matColumnDef","level"],["matColumnDef","action"],["matColumnDef","pending"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["icon","people",4,"ngFor","ngForOf"],["icon","person",4,"ngFor","ngForOf"],[4,"ngIf"],["icon","people"],["icon","person"],[3,"level","grayscale"],[3,"visibility",4,"ngIf"],["mat-cell","",2,"text-align","center"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","","routerLink","/commanding/history",3,"queryParams"],["mat-header-row",""],["mat-row",""]],template:function(e,a){1&e&&t.YNc(0,Hc,24,4,"table",0),2&e&&t.Q6J("ngIf",a.dataSource)},directives:[d.O5,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,d.sg,Zc._,Y.U,at.T,q.OP,v.Hw,U.d,h.yS,r.as,r.XQ,r.nj,r.Gk],pipes:[d.Ov,d.JJ],encapsulation:2,changeDetection:0}),n})();const Gt=function(n){return{c:n}};function Rc(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-queues-table",5),t.TgZ(2,"p"),t._uU(3,"\xa0"),t.qZA(),t.TgZ(4,"nav",6),t.TgZ(5,"a",7,8),t._uU(7," PENDING "),t.qZA(),t.TgZ(8,"a",9,10),t._uU(10," ACTION LOG "),t.qZA(),t.qZA(),t.TgZ(11,"div",11),t._UZ(12,"router-outlet"),t.qZA(),t.BQk()),2&n){const e=t.MAs(6),a=t.MAs(9),o=t.oxw();t.xp6(1),t.Q6J("cqueues$",o.cqueues$),t.xp6(4),t.Q6J("active",e.isActive)("queryParams",t.VKq(5,Gt,o.yamcs.context)),t.xp6(3),t.Q6J("active",a.isActive)("queryParams",t.VKq(7,Gt,o.yamcs.context))}}function jc(n,i){1&n&&(t.ynx(0),t._uU(1,"replay"),t.BQk())}function Vc(n,i){if(1&n&&(t.TgZ(0,"app-empty-message",13),t.TgZ(1,"p"),t._uU(2," You are connected to the "),t.YNc(3,jc,2,0,"ng-container",14),t._uU(4," processor "),t.TgZ(5,"strong"),t._uU(6),t.qZA(),t._uU(7,". "),t.qZA(),t.TgZ(8,"p"),t._uU(9," This processor does not support commanding. "),t.qZA(),t.qZA()),2&n){const e=i.ngIf;t.xp6(3),t.Q6J("ngIf",null==e.processor?null:e.processor.replay),t.xp6(3),t.Oqu(null==e.processor?null:e.processor.name)}}function Gc(n,i){if(1&n&&(t.YNc(0,Vc,10,2,"app-empty-message",12),t.ALo(1,"async")),2&n){const e=t.oxw();t.Q6J("ngIf",t.lcZ(1,1,e.connectionInfo$))}}let Wt=(()=>{class n{constructor(e,a,o){this.yamcs=e,this.cqueues$=new T.X([]),this.cqueueByName={},a.setTitle("Queues"),this.connectionInfo$=e.connectionInfo$,e.yamcsClient.getCommandQueues(e.instance,e.processor).then(c=>{for(const s of c)this.cqueueByName[s.name]=s;this.emitChange()}).catch(c=>o.showError(c)),this.queueSubscription=e.yamcsClient.createQueueStatisticsSubscription({instance:e.instance,processor:e.processor},c=>{const s=this.cqueueByName[c.name];s&&(c.entry=s.entry,this.cqueueByName[c.name]=c,this.emitChange())}),this.queueEventSubscription=e.yamcsClient.createQueueEventsSubscription({instance:e.instance,processor:e.processor},c=>{const s=this.cqueueByName[c.data.queueName];if(s){if("COMMAND_ADDED"===c.type)s.entry=s.entry||[],s.entry.push(c.data);else if("COMMAND_UPDATED"===c.type){const u=(s.entry||[]).findIndex(_=>_.id===c.data.id);-1!==u&&(s.entry[u]=c.data)}else if("COMMAND_REJECTED"===c.type)s.entry=s.entry||[],s.entry=s.entry.filter(u=>u.id!==c.data.id);else{if("COMMAND_SENT"!==c.type)throw new Error(`Unexpected queue event ${c.type}`);s.entry=s.entry||[],s.entry=s.entry.filter(u=>u.id!==c.data.id)}this.emitChange()}else console.warn("Received an event for an unknown queue",c)})}emitChange(){this.cqueues$.next(Object.values(this.cqueueByName))}ngOnDestroy(){var e,a;null===(e=this.queueSubscription)||void 0===e||e.cancel(),null===(a=this.queueEventSubscription)||void 0===a||a.cancel()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y.C),t.Y36(k.Dx),t.Y36(I.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:31,vars:4,consts:[[1,"ya-data-table"],["width","1"],[1,"panel-content"],[4,"ngIf","ngIfElse"],["noCommanding",""],[3,"cqueues$"],["mat-tab-nav-bar","",1,"secondary"],["mat-tab-link","","routerLink","/commanding/queues/pending","routerLinkActive","",3,"active","queryParams"],["rla","routerLinkActive"],["mat-tab-link","","routerLink","/commanding/queues/log","routerLinkActive","",3,"active","queryParams"],["rlb","routerLinkActive"],[2,"margin-top","16px"],["headerTitle","Queues",4,"ngIf"],["headerTitle","Queues"],[4,"ngIf"]],template:function(e,a){if(1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Queues "),t.TgZ(3,"app-help"),t.TgZ(4,"p"),t._uU(5," A queue is a temporary holding location for issued commands that are waiting to enter the next stage of processing. "),t.qZA(),t.TgZ(6,"p"),t._uU(7," Queues are an ordered list. Issued commands are offered to the first matching queue. "),t.qZA(),t.TgZ(8,"p"),t._uU(9," A queue can perform these actions: "),t.qZA(),t.TgZ(10,"table",0),t.TgZ(11,"tr"),t.TgZ(12,"td",1),t._uU(13," ACCEPT "),t.qZA(),t.TgZ(14,"td"),t._uU(15,"The queue accepts and releases commands."),t.qZA(),t.qZA(),t.TgZ(16,"tr"),t.TgZ(17,"td"),t._uU(18," HOLD "),t.qZA(),t.TgZ(19,"td"),t._uU(20,"The queue accepts commands but does not release them. These commands may be released manually, or automatically as soon as the queue action changes to ACCEPT."),t.qZA(),t.qZA(),t.TgZ(21,"tr"),t.TgZ(22,"td"),t._uU(23," REJECT "),t.qZA(),t.TgZ(24,"td"),t._uU(25,"The queue does not accept commands. Matching commands will fail immediately."),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"div",2),t.YNc(27,Rc,13,9,"ng-container",3),t.ALo(28,"async"),t.YNc(29,Gc,2,3,"ng-template",null,4,t.W1O),t.qZA(),t.qZA()),2&e){const o=t.MAs(30);let c;t.xp6(27),t.Q6J("ngIf",null==(c=t.lcZ(28,2,a.connectionInfo$))||null==c.processor?null:c.processor.hasCommanding)("ngIfElse",o)}},directives:[A.a,S.k,z.W,d.O5,Bc,H.BU,h.yS,H.Nj,h.Od,h.lC,lt.M],pipes:[d.Ov],encapsulation:2,changeDetection:0}),n})();var V=m(4409),Wc=m(4004),zc=m(4773);const Xc=["commandSelector"],Kc=["commandForm"];function ts(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",1),t.TgZ(2,"form",2),t.TgZ(3,"h2"),t._uU(4,"Select command"),t.qZA(),t.TgZ(5,"div",3),t._UZ(6,"app-command-selector",4,5),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div",6),t.TgZ(9,"mat-toolbar"),t.TgZ(10,"mat-toolbar-row"),t.TgZ(11,"button",7),t._uU(12,"CANCEL"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.BQk()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("formGroup",e.selectCommandForm)}}function es(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-text-action",12),t.NdJ("click",function(){const c=t.CHM(e).ngIf;return t.oxw(2).returnToList(c)}),t._uU(2),t.qZA(),t.BQk()}if(2&n){const e=i.ngIf;t.xp6(1),t.Q6J("padding",!1),t.xp6(1),t.hij(" ",e," ")}}function ns(n,i){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1),t.TgZ(2,"div",8),t.YNc(3,es,3,2,"ng-container",0),t.ALo(4,"spaceSystemName"),t.TgZ(5,"h2"),t._uU(6),t.qZA(),t._UZ(7,"app-command-form",9,10),t.qZA(),t.qZA(),t.TgZ(9,"div",6),t.TgZ(10,"mat-toolbar"),t.TgZ(11,"mat-toolbar-row"),t.TgZ(12,"button",7),t._uU(13,"CANCEL"),t.qZA(),t._uU(14,"\xa0\xa0 "),t.TgZ(15,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().handleOK()}),t._uU(16),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&n){const e=i.ngIf,a=t.MAs(8),o=t.oxw();t.xp6(3),t.Q6J("ngIf",t.lcZ(4,6,e.qualifiedName)),t.xp6(3),t.Oqu(e.name),t.xp6(1),t.Q6J("command",e)("templateProvider",o.templateProvider),t.xp6(8),t.Q6J("disabled",!a.form.valid),t.xp6(1),t.Oqu(o.okLabel)}}class as{constructor(i){this.entry=i}getAssignment(i){for(const e in this.entry.args)if(e===i)return{type:"STRING",stringValue:this.entry.args[e]}}getComment(){return this.entry.comment}}let zt=(()=>{class n{constructor(e,a,o,c,s){this.dialogRef=e,this.yamcs=a,this.changeDetection=c,this.data=s,this.okLabel="OK",this.commandFormValid$=new T.X(!1),this.selectedCommand$=new T.X(null),(null==s?void 0:s.entry)&&(this.templateProvider=new as(s.entry),this.selectedCommand$.next(s.entry.command)),(null==s?void 0:s.okLabel)&&(this.okLabel=null==s?void 0:s.okLabel),this.selectCommandForm=o.group({command:["",l.kI.required]}),this.selectCommandForm.valueChanges.subscribe(()=>{this.selectedCommand$.next(this.selectCommandForm.value.command||null)})}handleOK(){const e={command:this.selectedCommand$.value,args:this.commandForm.getAssignments(),comment:this.commandForm.getComment(),extra:this.commandForm.getExtraOptions()};this.dialogRef.close(e)}returnToList(e){this.templateProvider=null,this.selectedCommand$.next(null),this.changeDetection.detectChanges(),this.selectCommandForm.reset(),this.commandSelector.changeSystem("/"===e?"":e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so),t.Y36(y.C),t.Y36(l.qu),t.Y36(t.sBO),t.Y36(g.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&(t.Gf(Xc,5),t.Gf(Kc,5)),2&e){let o;t.iGM(o=t.CRH())&&(a.commandSelector=o.first),t.iGM(o=t.CRH())&&(a.commandForm=o.first)}},decls:4,vars:6,consts:[[4,"ngIf"],[1,"wrapper","mat-typography"],[1,"ya-form",3,"formGroup"],[1,"command-table-wrapper"],["formControlName","command"],["commandSelector",""],[1,"footer","mat-typography"],["mat-dialog-close","",1,"ya-button"],[1,"command-detail"],[3,"command","templateProvider"],["commandForm",""],[1,"ya-button","primary",3,"disabled","click"],[3,"padding","click"]],template:function(e,a){1&e&&(t.YNc(0,ts,13,1,"ng-container",0),t.ALo(1,"async"),t.YNc(2,ns,17,8,"ng-container",0),t.ALo(3,"async")),2&e&&(t.Q6J("ngIf",!t.lcZ(1,2,a.selectedCommand$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(3,4,a.selectedCommand$)))},directives:[d.O5,l._Y,l.JL,l.sg,zc.C,l.JJ,l.u,Q.Ye,Q.rD,g.ZT,ot.l,Jt],pipes:[d.Ov,st.B],styles:[".mat-dialog-container{border-radius:0;position:relative}.wrapper[_ngcontent-%COMP%]{position:relative;height:calc(100% - 32px);overflow:auto}.command-table-wrapper[_ngcontent-%COMP%]{position:absolute;overflow:auto;inset:56px 0 1em}.command-detail[_ngcontent-%COMP%]{max-width:600px}.footer[_ngcontent-%COMP%]{position:absolute;bottom:0;height:64px;left:0;right:0;border-top:1px solid #d3d3d3}"]}),n})();class is{constructor(i=[]){this.entries=i}addEntry(i){this.entries.push(i)}toXML(){const i=document.implementation.createDocument(null,null,null),e=i.createElement("commandStack");i.appendChild(e);for(const o of this.entries){const c=i.createElement("command");c.setAttribute("qualifiedName",o.name),o.comment&&c.setAttribute("comment",o.comment);for(const s in o.args){const u=i.createElement("commandArgument");u.setAttribute("argumentName",s),u.setAttribute("argumentValue",o.args[s]),c.appendChild(u)}e.appendChild(c)}let a=(new XMLSerializer).serializeToString(e);return this.formatXml(a)}formatXml(i){let e="",a="";return i.split(/>\s*</).forEach(function(c){c.match(/^\/\w/)&&(a=a.substring("  ".length)),e+=a+"<"+c+">\r\n",c.match(/^<?\w[^>]*[^\/]$/)&&(a+="  ")}),e.substring(1,e.length-3)}}function os(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",2),t._uU(2),t.qZA(),t.TgZ(3,"div",1),t._uU(4),t.qZA(),t.BQk()),2&n){const e=i.$implicit;t.xp6(2),t.Oqu(e.namespace),t.xp6(2),t.hij(" ",e.name," ")}}function cs(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-markdown",8),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("text",null==e.entry.command?null:e.entry.command.longDescription)}}function ss(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",(null==e.entry.command?null:e.entry.command.shortDescription)||"-"," ")}}function ls(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-significance-level",9),t._uU(2),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("level",e.consequenceLevel),t.xp6(1),t.hij(" ",e.reasonForWarning," ")}}function rs(n,i){1&n&&(t.TgZ(0,"span",15),t._uU(1," satisfied "),t.qZA())}function ms(n,i){1&n&&(t.TgZ(0,"span",16),t._uU(1," not satisfied "),t.qZA())}function us(n,i){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t.YNc(6,rs,2,0,"span",11),t.ALo(7,"async"),t.YNc(8,ms,2,0,"span",12),t.ALo(9,"async"),t._UZ(10,"app-live-expression",13,14),t.qZA(),t.qZA()),2&n){const e=i.$implicit,a=t.MAs(11);t.xp6(2),t.Oqu(e.expression),t.xp6(2),t.Oqu(e.timeout||"-"),t.xp6(2),t.Q6J("ngIf",!0===t.lcZ(7,7,a.result$)),t.xp6(2),t.Q6J("ngIf",!1===t.lcZ(9,9,a.result$)),t.xp6(2),t.Udp("display","none"),t.Q6J("expression",e.expression)}}function ds(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"table",10),t.TgZ(2,"tr"),t.TgZ(3,"th"),t._uU(4,"Constraint"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Timeout"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Live Evaluation"),t.qZA(),t.qZA(),t.YNc(9,us,12,11,"tr",3),t.qZA(),t.BQk()),2&n){const e=i.ngIf;t.xp6(9),t.Q6J("ngForOf",e)}}function _s(n,i){1&n&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function ps(n,i){1&n&&t._uU(0," -\n")}let gs=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stacked-command-detail"]],inputs:{entry:"entry"},decls:30,vars:15,consts:[[1,"block-title",2,"padding-top","0"],[1,"block"],[1,"block-title"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"margin-top","1em","margin-bottom","1em"],[4,"ngIf","ngIfElse"],["dash",""],[3,"text"],[3,"level"],["yaDataTable",""],["class","evaluation valid",4,"ngIf"],["class","evaluation invalid",4,"ngIf"],[3,"expression"],["expr",""],[1,"evaluation","valid"],[1,"evaluation","invalid"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0),t._uU(1,"Command"),t.qZA(),t.TgZ(2,"div",1),t._uU(3),t.ALo(4,"shortName"),t.qZA(),t.TgZ(5,"div",2),t._uU(6,"Space system"),t.qZA(),t.TgZ(7,"div",1),t._uU(8),t.ALo(9,"spaceSystemName"),t.qZA(),t.YNc(10,os,5,2,"ng-container",3),t.TgZ(11,"div",2),t._uU(12,"Description"),t.qZA(),t.TgZ(13,"div",1),t.YNc(14,cs,2,1,"ng-container",4),t.YNc(15,ss,2,1,"ng-container",4),t.qZA(),t._UZ(16,"mat-divider",5),t.TgZ(17,"div",2),t._uU(18,"Significance"),t.qZA(),t.TgZ(19,"div",1),t.YNc(20,ls,3,2,"ng-container",6),t.ALo(21,"effectiveSignificance"),t.qZA(),t._UZ(22,"mat-divider",5),t.TgZ(23,"div",0),t._uU(24,"Constraints"),t.qZA(),t.TgZ(25,"div",1),t.YNc(26,ds,10,1,"ng-container",4),t.YNc(27,_s,2,0,"ng-container",4),t.qZA(),t.YNc(28,ps,1,0,"ng-template",null,7,t.W1O)),2&e){const o=t.MAs(29);t.xp6(3),t.hij(" ",t.lcZ(4,9,a.entry.name),"\n"),t.xp6(5),t.hij(" ",t.lcZ(9,11,a.entry.name)||"-","\n"),t.xp6(2),t.Q6J("ngForOf",null==a.entry.command?null:a.entry.command.alias),t.xp6(4),t.Q6J("ngIf",null==a.entry.command?null:a.entry.command.longDescription),t.xp6(1),t.Q6J("ngIf",!(null!=a.entry.command&&a.entry.command.longDescription)),t.xp6(5),t.Q6J("ngIf",t.lcZ(21,13,a.entry.command))("ngIfElse",o),t.xp6(6),t.Q6J("ngIf",null==a.entry.command?null:a.entry.command.constraint),t.xp6(1),t.Q6J("ngIf",!(null!=a.entry.command&&a.entry.command.constraint))}},directives:[d.sg,d.O5,Ot.U,U.d,Y.U,Yt.O,Ft.Q],pipes:[Mt.y,st.B,j.m,d.Ov],styles:[".evaluation[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace;background-color:#dc143c;color:#fff;padding-left:2px;padding-right:2px}.evaluation.valid[_ngcontent-%COMP%]{background-color:#adff2f;color:#000}"],changeDetection:0}),n})();var rt=m(1292),mt=function(n,i,e,a){return new(e||(e=Promise))(function(c,s){function u(p){try{f(a.next(p))}catch(Z){s(Z)}}function _(p){try{f(a.throw(p))}catch(Z){s(Z)}}function f(p){p.done?c(p.value):function o(c){return c instanceof e?c:new e(function(s){s(c)})}(p.value).then(u,_)}f((a=a.apply(n,i||[])).next())})};const fs=["entryParent"];function hs(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"app-detail-toolbar"),t._uU(2," Command Info "),t.qZA(),t.TgZ(3,"div",20),t._UZ(4,"app-stacked-command-detail",21),t.TgZ(5,"p"),t._uU(6,"\xa0"),t.qZA(),t.qZA(),t.BQk()),2&n){const e=i.ngIf;t.xp6(4),t.Q6J("entry",e)}}function xs(n,i){1&n&&(t.TgZ(0,"app-detail-toolbar"),t._uU(1," Select an entry "),t.qZA())}function Ts(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" [",e.executionNumber,"]: ")}}function Zs(n,i){1&n&&(t.ynx(0),t._uU(1," [ ]: "),t.BQk())}function ys(n,i){if(1&n&&(t.TgZ(0,"mat-icon",31),t._uU(1," comment "),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("matTooltip",e.comment)}}function Cs(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"value"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.AsE(" [",e.key,": ",t.lcZ(2,2,e.value),"] ")}}function bs(n,i){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"td",32),t._uU(2),t.qZA(),t.TgZ(3,"td",33),t._uU(4),t.qZA(),t.qZA()),2&n){const e=i.$implicit;t.xp6(2),t.hij(" ",e.key," "),t.xp6(2),t.Oqu(e.value)}}function vs(n,i){if(1&n&&(t.ynx(0),t._uU(1),t.BQk()),2&n){const e=t.oxw(2).$implicit;t.xp6(1),t.hij(" ",e.err," ")}}function As(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"div",38),t._UZ(2,"app-extra-acknowledgments-table",37),t.qZA(),t.BQk()),2&n){const e=t.oxw(3).$implicit;t.xp6(2),t.Q6J("command",e.record)("inline",!0)}}function Ss(n,i){if(1&n&&(t.ynx(0),t._UZ(1,"app-yamcs-acknowledgments-table",37),t.YNc(2,As,3,2,"ng-container",25),t.BQk()),2&n){const e=t.oxw(2).$implicit;t.xp6(1),t.Q6J("command",e.record)("inline",!0),t.xp6(1),t.Q6J("ngIf",null==e.record?null:e.record.extra.length)}}function ks(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",34),t.TgZ(1,"div",35),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().selectEntry(o)}),t.qZA(),t.TgZ(2,"div",36),t.YNc(3,vs,2,1,"ng-container",25),t.YNc(4,Ss,3,3,"ng-container",25),t.qZA(),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.xp6(2),t.ekj("err",e.err),t.xp6(1),t.Q6J("ngIf",e.err),t.xp6(1),t.Q6J("ngIf",!e.err)}}function ws(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",22),t.ALo(1,"async"),t.TgZ(2,"div",23),t.TgZ(3,"div",24),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw().selectEntry(c)}),t.YNc(4,Ts,2,1,"ng-container",25),t.YNc(5,Zs,2,0,"ng-container",25),t.qZA(),t.TgZ(6,"div",26),t.NdJ("dblclick",function(){const c=t.CHM(e).$implicit;return t.oxw().editCommand(c)}),t._uU(7),t.YNc(8,ys,2,1,"mat-icon",27),t.YNc(9,Cs,3,4,"span",28),t.ALo(10,"keyvalue"),t.TgZ(11,"table",29),t.YNc(12,bs,5,2,"tr",28),t.ALo(13,"keyvalue"),t.qZA(),t.qZA(),t.qZA(),t.YNc(14,ks,5,4,"div",30),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw();t.ekj("selected",e===t.lcZ(1,9,a.selectedEntry$)),t.xp6(4),t.Q6J("ngIf",0===e.executionNumber||e.executionNumber),t.xp6(1),t.Q6J("ngIf",0!==e.executionNumber&&!e.executionNumber),t.xp6(2),t.hij(" ",e.name," "),t.xp6(1),t.Q6J("ngIf",e.comment),t.xp6(1),t.Q6J("ngForOf",t.lcZ(10,11,e.extra)),t.xp6(3),t.Q6J("ngForOf",t.lcZ(13,13,e.args)),t.xp6(2),t.Q6J("ngIf",0===e.executionNumber||e.executionNumber)}}const qs=function(n){return{c:n}};let Xt=(()=>{class n{constructor(e,a,o,c,s){this.dialog=e,this.yamcs=a,this.route=o,this.title=c,this.dirty$=new T.X(!1),this.entries$=new T.X([]),this.hasOutputs$=this.entries$.pipe((0,Wc.U)(_=>{for(const f of _)if(f.record)return!0;return!1})),this.running$=new T.X(!1),this.selectedEntry$=new T.X(null),this.clipboardEntry$=new T.X(null),this.commandHistoryRecords=new Map,this.executionCounter=0,this.folderPerInstance=s.getConfig().displayFolderPerInstance,this.storageClient=a.createStorageClient();const u=this.getObjectNameFromUrl();this.loadFile(u),this.commandSubscription=a.yamcsClient.createCommandSubscription({instance:a.instance,processor:a.processor,ignorePastCommands:!0},_=>{const f=_.id;let p=this.commandHistoryRecords.get(f);p=p?p.mergeEntry(_):new F(_),this.commandHistoryRecords.set(f,p);for(const Z of this.entries$.value)if(Z.id===f){Z.record=p;break}})}handleDrop(e){e.previousIndex!==e.currentIndex&&((0,V.bA)(this.entries$.value,e.previousIndex,e.currentIndex),this.entries$.next([...this.entries$.value]),this.dirty$.next(!0))}getObjectNameFromUrl(){const e=this.route.snapshot.url;let a="";this.folderPerInstance&&(a+=this.yamcs.instance);for(const o of e)a&&(a+="/"),a+=o.path;return a}getNameWithoutInstance(e){return this.folderPerInstance?e.substr(this.yamcs.instance.length):e}loadFile(e){return mt(this,void 0,void 0,function*(){this.objectName=e;const a=this.objectName.lastIndexOf("/");if(-1===a)this.folderLink="/commanding/stacks/browse/",this.filename=this.objectName;else{const c=this.getNameWithoutInstance(this.objectName.substring(0,a));this.folderLink="/commanding/stacks/browse/"+c,this.filename=this.objectName.substring(a+1)}this.title.setTitle(this.filename);const o=yield this.storageClient.getObject("_global","stacks",e);if(o.ok){const c=yield o.text(),u=(new DOMParser).parseFromString(c,"text/xml"),_=this.parseXML(u.documentElement),f=[];for(const p of _)f.push(this.yamcs.yamcsClient.getCommand(this.yamcs.instance,p.name).then(Z=>{p.command=Z}));for(const p of f)try{yield p}catch(Z){}this.entries$.next(_),this.selectedEntry$.next(_.length?_[0]:null)}})}parseXML(e){const a=[];for(let o=0;o<e.childNodes.length;o++){const c=e.childNodes[o];if(3!==c.nodeType&&"command"===c.nodeName){const s=this.parseEntry(c);a.push(s)}}return a}selectEntry(e){this.selectedEntry$.next(e)}deleteSelectedCommands(){const e=this.selectedEntry$.value;if(e){const a=this.entries$.value.indexOf(e);-1!==a&&(this.entries$.value.splice(a,1),this.entries$.next([...this.entries$.value]),this.selectedEntry$.next(null),this.dirty$.next(!0))}}clearSelectedOutputs(){const e=this.selectedEntry$.value;e&&(e.executionNumber=void 0,e.id=void 0,e.record=void 0,e.err=void 0)}clearOutputs(){for(const e of this.entries$.value)e.executionNumber=void 0,e.id=void 0,e.record=void 0,e.err=void 0;this.executionCounter=0,this.entries$.next([...this.entries$.value]),this.entries$.value.length&&this.selectEntry(this.entries$.value[0])}hasPendingChanges(){return this.dirty$.value}runSelection(){const e=this.selectedEntry$.value;!e||this.runEntry(e).finally(()=>{this.advanceSelection(e)})}runEntry(e){return mt(this,void 0,void 0,function*(){const a=++this.executionCounter;return this.yamcs.yamcsClient.issueCommand(this.yamcs.instance,this.yamcs.processor,e.name,{sequenceNumber:a,args:e.args,extra:e.extra}).then(o=>{e.executionNumber=a,e.id=o.id;const c=this.commandHistoryRecords.get(e.id);c&&(e.record=c),this.entries$.next([...this.entries$.value])}).catch(o=>{e.executionNumber=a,e.err=o.message||o})})}runFromSelection(){return mt(this,void 0,void 0,function*(){let e=this.selectedEntry$.value;if(e){this.running$.next(!0);try{const a=this.entries$.value;for(let o=a.indexOf(e);o<a.length;o++)e=a[o],yield this.runEntry(e),this.advanceSelection(e)}finally{this.running$.next(!1)}}})}stopRun(){this.running$.next(!1)}advanceSelection(e){const a=this.entries$.value,o=a.indexOf(e);if(o<a.length-1){this.selectEntry(a[o+1]);const u=this.entryParent.nativeElement.getElementsByClassName("entry")[o+1];this.isVisible(u)||u.scrollIntoView()}else this.selectedEntry$.next(null)}isVisible(e){const a=e.getBoundingClientRect(),o=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(a.bottom<0||a.top-o>=0)}parseEntry(e){const a={};for(let c=0;c<e.childNodes.length;c++){const s=e.childNodes[c];"commandArgument"===s.nodeName&&(a[this.getStringAttribute(s,"argumentName")]=this.getStringAttribute(s,"argumentValue"))}const o={name:this.getStringAttribute(e,"qualifiedName"),args:a};return e.hasAttribute("comment")&&(o.comment=this.getStringAttribute(e,"comment")),o}addCommand(){this.dialog.open(zt,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},data:{okLabel:"ADD TO STACK"}}).afterClosed().subscribe(a=>{if(a){const o={name:a.command.qualifiedName,args:a.args,comment:a.comment,extra:a.extra,command:a.command},c=this.selectedEntry$.value;if(c){const s=this.entries$.value,u=s.indexOf(c);s.splice(u+1,0,o),this.entries$.next([...this.entries$.value])}else this.entries$.next([...this.entries$.value,o]);this.selectEntry(o),this.dirty$.next(!0)}})}editSelectedCommand(){this.editCommand(this.selectedEntry$.value)}editCommand(e){return this.selectEntry(e),this.dialog.open(zt,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},data:{okLabel:"UPDATE",entry:e}}).afterClosed().subscribe(o=>{if(o){const c={name:o.command.qualifiedName,args:o.args,comment:o.comment,extra:o.extra,command:o.command},s=this.entries$.value,u=s.indexOf(e);s.splice(u,1,c),this.entries$.next([...this.entries$.value]),this.selectEntry(c),this.dirty$.next(!0)}}),!1}cutSelectedCommand(){const e=this.selectedEntry$.value;this.advanceSelection(e),this.clipboardEntry$.next(e);const a=this.entries$.value,o=a.indexOf(e);a.splice(o,1),this.entries$.next([...this.entries$.value]),this.dirty$.next(!0)}copySelectedCommand(){this.clipboardEntry$.next(this.selectedEntry$.value)}pasteCommand(){const e=this.clipboardEntry$.value;if(e){const a={name:e.name,args:Object.assign({},e.args),comment:e.comment,command:e.command};e.extra&&(a.extra=Object.assign({},e.extra));const o=this.selectedEntry$.value;if(o){const c=this.entries$.value,s=c.indexOf(o);c.splice(s+1,0,a),this.entries$.next([...this.entries$.value])}else this.entries$.next([...this.entries$.value,a]);this.selectEntry(a),this.dirty$.next(!0)}}saveStack(){const e=new is(this.entries$.value).toXML(),a=new Blob([e]);this.storageClient.uploadObject("_global","stacks",this.objectName,a).then(()=>{this.dirty$.next(!1)})}getStringAttribute(e,a){const o=e.attributes.getNamedItem(a);if(null===o)throw new Error(`No attribute named ${a}`);return o.textContent||""}ngOnDestroy(){this.commandSubscription&&this.commandSubscription.cancel()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.uw),t.Y36(y.C),t.Y36(h.gz),t.Y36(k.Dx),t.Y36(D.E))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&t.Gf(fs,5),2&e){let o;t.iGM(o=t.CRH())&&(a.entryParent=o.first)}},decls:68,vars:59,consts:[[3,"hasDetailPane"],["mat-icon-button","","color","primary",3,"routerLink","queryParams"],["mat-button","","color","primary","matTooltip","Save stack",3,"disabled","click"],["vertical","",2,"height","100%"],["mat-icon-button","","color","primary","matTooltip","Add a command below",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Edit the selected command",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Cut the selected command",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Copy the selected command",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Paste command from the clipboard",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Run the selected command",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Stop current execution",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Clear all outputs",3,"disabled","click"],["mat-icon-button","","color","primary","matTooltip","Run all from selected command",3,"disabled","click"],[4,"ngIf","ngIfElse"],["noSelection",""],[1,"panel-wrapper"],["cdkDropList","",1,"panel-content",3,"cdkDropListDropped"],["entryParent",""],["id","drag-boundary"],["cdkDrag","","cdkDragBoundary","#drag-boundary","class","entry",3,"selected",4,"ngFor","ngForOf"],[2,"padding","0 16px"],[3,"entry"],["cdkDrag","","cdkDragBoundary","#drag-boundary",1,"entry"],[1,"in"],["cdkDragHandle","",1,"seq",3,"click"],[4,"ngIf"],[1,"body",3,"dblclick"],["class","icon14","style","vertical-align: middle;",3,"matTooltip",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"args"],["class","out",4,"ngIf"],[1,"icon14",2,"vertical-align","middle",3,"matTooltip"],["width","1",1,"key"],[1,"value"],[1,"out"],[1,"seq",3,"click"],[1,"body"],[3,"command","inline"],[1,"block"]],template:function(e,a){if(1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar",0),t.TgZ(2,"a",1),t.TgZ(3,"mat-icon"),t._uU(4,"arrow_back"),t.qZA(),t.qZA(),t._uU(5),t.ALo(6,"basename"),t.TgZ(7,"button",2),t.NdJ("click",function(){return a.saveStack()}),t.ALo(8,"async"),t.TgZ(9,"mat-icon"),t._uU(10,"save"),t.qZA(),t._uU(11," SAVE "),t.qZA(),t._UZ(12,"mat-divider",3),t.TgZ(13,"button",4),t.NdJ("click",function(){return a.addCommand()}),t.ALo(14,"async"),t.TgZ(15,"mat-icon"),t._uU(16,"add_circle_outline"),t.qZA(),t.qZA(),t.TgZ(17,"button",5),t.NdJ("click",function(){return a.editSelectedCommand()}),t.ALo(18,"async"),t.ALo(19,"async"),t.TgZ(20,"mat-icon"),t._uU(21,"edit"),t.qZA(),t.qZA(),t.TgZ(22,"button",6),t.NdJ("click",function(){return a.cutSelectedCommand()}),t.ALo(23,"async"),t.ALo(24,"async"),t.TgZ(25,"mat-icon"),t._uU(26,"content_cut"),t.qZA(),t.qZA(),t.TgZ(27,"button",7),t.NdJ("click",function(){return a.copySelectedCommand()}),t.ALo(28,"async"),t.ALo(29,"async"),t.TgZ(30,"mat-icon"),t._uU(31,"content_copy"),t.qZA(),t.qZA(),t.TgZ(32,"button",8),t.NdJ("click",function(){return a.pasteCommand()}),t.ALo(33,"async"),t.ALo(34,"async"),t.TgZ(35,"mat-icon"),t._uU(36,"content_paste"),t.qZA(),t.qZA(),t._UZ(37,"mat-divider",3),t.TgZ(38,"button",9),t.NdJ("click",function(){return a.runSelection()}),t.ALo(39,"async"),t.ALo(40,"async"),t.TgZ(41,"mat-icon"),t._uU(42,"play_arrow"),t.qZA(),t.qZA(),t.TgZ(43,"button",10),t.NdJ("click",function(){return a.stopRun()}),t.ALo(44,"async"),t.TgZ(45,"mat-icon"),t._uU(46,"stop"),t.qZA(),t.qZA(),t.TgZ(47,"button",11),t.NdJ("click",function(){return a.clearOutputs()}),t.ALo(48,"async"),t.ALo(49,"async"),t.TgZ(50,"mat-icon"),t._uU(51,"refresh"),t.qZA(),t.qZA(),t.TgZ(52,"button",12),t.NdJ("click",function(){return a.runFromSelection()}),t.ALo(53,"async"),t.ALo(54,"async"),t.TgZ(55,"mat-icon"),t._uU(56,"playlist_play"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(57,"app-detail-pane"),t.YNc(58,hs,7,1,"ng-container",13),t.ALo(59,"async"),t.YNc(60,xs,2,0,"ng-template",null,14,t.W1O),t.qZA(),t.TgZ(62,"div",15),t.TgZ(63,"div",16,17),t.NdJ("cdkDropListDropped",function(c){return a.handleDrop(c)}),t.TgZ(65,"div",18),t.YNc(66,ws,15,15,"div",19),t.ALo(67,"async"),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e){const o=t.MAs(61);t.xp6(1),t.Q6J("hasDetailPane",!0),t.xp6(1),t.Q6J("routerLink",a.folderLink)("queryParams",t.VKq(57,qs,a.yamcs.context)),t.xp6(3),t.hij(" ",t.lcZ(6,17,a.filename)," \xa0\xa0\xa0 "),t.xp6(2),t.Q6J("disabled",!t.lcZ(8,19,a.dirty$)),t.xp6(6),t.Q6J("disabled",t.lcZ(14,21,a.running$)),t.xp6(4),t.Q6J("disabled",t.lcZ(18,23,a.running$)||!t.lcZ(19,25,a.selectedEntry$)),t.xp6(5),t.Q6J("disabled",t.lcZ(23,27,a.running$)||!t.lcZ(24,29,a.selectedEntry$)),t.xp6(5),t.Q6J("disabled",t.lcZ(28,31,a.running$)||!t.lcZ(29,33,a.selectedEntry$)),t.xp6(5),t.Q6J("disabled",t.lcZ(33,35,a.running$)||!t.lcZ(34,37,a.clipboardEntry$)),t.xp6(6),t.Q6J("disabled",t.lcZ(39,39,a.running$)||!t.lcZ(40,41,a.selectedEntry$)),t.xp6(5),t.Q6J("disabled",!t.lcZ(44,43,a.running$)),t.xp6(4),t.Q6J("disabled",t.lcZ(48,45,a.running$)||!t.lcZ(49,47,a.hasOutputs$)),t.xp6(5),t.Q6J("disabled",t.lcZ(53,49,a.running$)||!t.lcZ(54,51,a.selectedEntry$)),t.xp6(6),t.Q6J("ngIf",t.lcZ(59,53,a.selectedEntry$))("ngIfElse",o),t.xp6(8),t.Q6J("ngForOf",t.lcZ(67,55,a.entries$))}},directives:[A.a,S.k,$.zs,h.yS,v.Hw,$.lW,w.gM,U.d,St.Z,d.O5,kt.j,gs,V.Wj,d.sg,V.Zt,V.Bh,bt,vt],pipes:[rt.u,d.Ov,d.Nd,K.V],styles:[".panel-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:top}table.args[_ngcontent-%COMP%]{margin:0 0 0 10px;font-size:10px}table.args[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0;border:0}table.args[_ngcontent-%COMP%]   td.key[_ngcontent-%COMP%]{min-width:120px;white-space:nowrap}table.args[_ngcontent-%COMP%]   td.value[_ngcontent-%COMP%]{color:gray;padding-left:10px}div.entry[_ngcontent-%COMP%]{font-size:13px;line-height:17px}div.entry[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%], div.entry[_ngcontent-%COMP%]   div.out[_ngcontent-%COMP%]{display:flex;border-left:8px solid transparent;margin-bottom:10px}div.entry.selected[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%], div.entry.selected[_ngcontent-%COMP%]   div.out[_ngcontent-%COMP%]{border-color:#009e87}div.entry[_ngcontent-%COMP%]   .seq[_ngcontent-%COMP%]{width:64px;text-align:right;padding-top:5px;padding-right:10px;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none;font-family:Roboto Mono,monospace;color:#bdbdbd}div.entry[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%]   .seq[_ngcontent-%COMP%]{cursor:move}div.entry.selected[_ngcontent-%COMP%]   .seq[_ngcontent-%COMP%]{color:#009e87}div.entry[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{flex-grow:1;padding:5px}div.entry[_ngcontent-%COMP%]   div.in[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{background-color:#fafafa;border:1px solid rgb(224,224,224);font-family:Roboto Mono,monospace}div.entry[_ngcontent-%COMP%]   div.out[_ngcontent-%COMP%]   .body.err[_ngcontent-%COMP%]{background-color:#fcc;color:#dc143c}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.6}"],changeDetection:0}),n})();var Kt=m(8306),Ns=m(9646);let Us=(()=>{class n{constructor(e){this.dialogRef=e}confirmDiscard(){this.dialogRef.close(!0)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-stack-file-page-dirty-dialog"]],decls:10,vars:0,consts:[[1,"mat-typography"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"mat-dialog-content",0),t.TgZ(1,"h3"),t._uU(2,"Close without saving?"),t.qZA(),t.TgZ(3,"p"),t._uU(4,"You have unsaved changes, close without saving?"),t.qZA(),t.qZA(),t.TgZ(5,"mat-dialog-actions",1),t.TgZ(6,"button",2),t._uU(7,"CANCEL"),t.qZA(),t.TgZ(8,"button",3),t.NdJ("click",function(){return a.confirmDiscard()}),t._uU(9," OK "),t.qZA(),t.qZA())},directives:[g.xY,g.H8,g.ZT],encapsulation:2}),n})(),te=(()=>{class n{constructor(e,a){this.dialog=e,this.authService=a,this.dialogOpen$=new T.X(!1)}canDeactivate(e){return this.dialogOpen$.value?Kt.y.create(a=>{this.dialogRef.afterClosed().subscribe(o=>{a.next(o),a.complete()},o=>{a.next(!1),a.complete()})}):e.hasPendingChanges()&&this.mayManageStacks()?Kt.y.create(a=>{this.dialogOpen$.next(!0),this.dialogRef=this.dialog.open(Us,{width:"400px"}),this.dialogRef.afterClosed().subscribe(o=>{this.dialogOpen$.next(!1),a.next(o),a.complete()},o=>{this.dialogOpen$.next(!1),a.next(!1),a.complete()})}):(0,Ns.of)(!0)}mayManageStacks(){const e=this.authService.getUser();return e.hasObjectPrivilege("ManageBucket","stacks")||e.hasSystemPrivilege("ManageAnyBucket")}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(g.uw),t.LFG(E.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();var Qs=m(9300),Ps=m(3043);let Is=(()=>{class n{constructor(e,a,o,c){this.dialogRef=e,this.data=c,this.storageClient=o.createStorageClient(),this.form=a.group({name:["",l.kI.required]})}save(){let{path:e,bucketInstance:a,bucket:o}=this.data;e.startsWith("/")&&(e=e.substring(1));const c=this.form.value.name;this.storageClient.uploadObject(a,o,e?`${e}/${c}/`:`${c}/`,new Blob).then(()=>this.dialogRef.close(!0))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so),t.Y36(l.qu),t.Y36(y.C),t.Y36(g.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name","pattern","\\w[\\w\\s\\.\\-\\(\\)\\[\\]]*"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(e,a){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Create folder"),t.qZA(),t.TgZ(2,"mat-dialog-content",1),t.TgZ(3,"form",2),t.TgZ(4,"label"),t._uU(5," Folder name "),t._UZ(6,"input",3),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"mat-dialog-actions",4),t.TgZ(8,"button",5),t._uU(9,"CANCEL"),t.qZA(),t.TgZ(10,"button",6),t.NdJ("click",function(){return a.save()}),t._uU(11,"CREATE"),t.qZA(),t.qZA()),2&e&&(t.xp6(3),t.Q6J("formGroup",a.form),t.xp6(7),t.Q6J("disabled",!a.form.valid))},directives:[g.uh,g.xY,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,l.c5,g.H8,g.ZT],encapsulation:2,changeDetection:0}),n})();const Ds=["filename"];let Js=(()=>{class n{constructor(e,a,o,c){this.dialogRef=e,this.data=c,this.storageClient=o.createStorageClient(),this.filenameForm=a.group({name:["",[l.kI.required]]})}save(){const e=this.filenameForm.get("name").value.trim()+".xml";let a=this.data.path;a.startsWith("/")&&(a=a.substring(1));const o=a?a+"/"+e:e,c=this.data.prefix+o,s=new Blob([],{type:"application/xml"});this.storageClient.uploadObject("_global","stacks",c,s).then(()=>{this.dialogRef.close(o)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so),t.Y36(l.qu),t.Y36(y.C),t.Y36(g.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-create-stack-dialog"]],viewQuery:function(e,a){if(1&e&&t.Gf(Ds,5),2&e){let o;t.iGM(o=t.CRH())&&(a.filenameInput=o.first)}},decls:13,vars:4,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["filename",""],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Create stack"),t.qZA(),t.TgZ(2,"mat-dialog-content",1),t.TgZ(3,"form",2),t.TgZ(4,"label"),t._uU(5," Name "),t._UZ(6,"input",3,4),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"mat-dialog-actions",5),t.TgZ(9,"button",6),t._uU(10,"CANCEL"),t.qZA(),t.TgZ(11,"button",7),t.NdJ("click",function(){return a.save()}),t._uU(12,"SAVE"),t.qZA(),t.qZA()),2&e){let o;t.xp6(3),t.Q6J("formGroup",a.filenameForm),t.xp6(1),t.ekj("invalid",null==(o=a.filenameForm.get("name"))?null:o.invalid),t.xp6(7),t.Q6J("disabled",!a.filenameForm.valid)}},directives:[g.uh,g.xY,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,g.H8,g.ZT],encapsulation:2}),n})();let Ys=(()=>{class n{constructor(e,a,o,c,s){this.dialogRef=e,this.data=s,this.storageClient=o.createStorageClient();const u=c.transform(this.data.name);this.filenameForm=a.group({name:[u,[l.kI.required]]})}rename(){return function(n,i,e,a){return new(e||(e=Promise))(function(c,s){function u(p){try{f(a.next(p))}catch(Z){s(Z)}}function _(p){try{f(a.throw(p))}catch(Z){s(Z)}}function f(p){p.done?c(p.value):function o(c){return c instanceof e?c:new e(function(s){s(c)})}(p.value).then(u,_)}f((a=a.apply(n,i||[])).next())})}(this,void 0,void 0,function*(){let e;const a=this.data.name.lastIndexOf("/");-1!==a&&(e=this.data.name.substring(0,a+1));const c=yield(yield this.storageClient.getObject("_global","stacks",this.data.name)).blob(),s=(e||"")+this.filenameForm.get("name").value+".xml";yield this.storageClient.uploadObject("_global","stacks",s,c),yield this.storageClient.deleteObject("_global","stacks",this.data.name),this.dialogRef.close(s)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.so),t.Y36(l.qu),t.Y36(y.C),t.Y36(rt.u),t.Y36(g.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-rename-stack-dialog"]],decls:13,vars:4,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["filename",""],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Rename stack"),t.qZA(),t.TgZ(2,"mat-dialog-content",1),t.TgZ(3,"form",2),t.TgZ(4,"label"),t._uU(5," Name "),t._UZ(6,"input",3,4),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"mat-dialog-actions",5),t.TgZ(9,"button",6),t._uU(10,"CANCEL"),t.qZA(),t.TgZ(11,"button",7),t.NdJ("click",function(){return a.rename()}),t._uU(12,"RENAME"),t.qZA(),t.qZA()),2&e){let o;t.xp6(3),t.Q6J("formGroup",a.filenameForm),t.xp6(1),t.ekj("invalid",null==(o=a.filenameForm.get("name"))?null:o.invalid),t.xp6(7),t.Q6J("disabled",!a.filenameForm.valid)}},directives:[g.uh,g.xY,l._Y,l.JL,l.sg,l.Fj,l.JJ,l.u,g.H8,g.ZT],encapsulation:2}),n})();const Fs=["droparea"],Ms=["uploader"];function $s(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().createStack()}),t.TgZ(1,"mat-icon"),t._uU(2,"add_circle_outline"),t.qZA(),t._uU(3," CREATE STACK "),t.qZA()}}function Es(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){return t.CHM(e),t.MAs(5).click()}),t.TgZ(1,"mat-icon"),t._uU(2,"file_upload"),t.qZA(),t._uU(3," UPLOAD STACK "),t.TgZ(4,"input",10,11),t.NdJ("change",function(){return t.CHM(e),t.oxw().importStack()}),t.qZA(),t.qZA()}}function Ls(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().createFolder()}),t.TgZ(1,"mat-icon"),t._uU(2,"create_new_folder"),t.qZA(),t._uU(3," CREATE FOLDER "),t.qZA()}}function Hs(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().deleteSelectedStacks()}),t.TgZ(1,"mat-icon"),t._uU(2,"delete"),t.qZA(),t._uU(3," DELETE "),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("disabled",!e.selection.hasValue())}}const G=function(n){return{c:n}};function Bs(n,i){if(1&n&&t._UZ(0,"app-breadcrumb",15),2&n){const e=i.$implicit,a=t.oxw(3);t.Q6J("link",e.route)("queryParams",t.VKq(3,G,a.yamcs.context))("label",e.name)}}function Rs(n,i){if(1&n&&(t.TgZ(0,"app-breadcrumb-trail"),t._UZ(1,"app-breadcrumb",13),t.YNc(2,Bs,1,5,"app-breadcrumb",14),t.qZA()),2&n){const e=t.oxw().ngIf,a=t.oxw();t.xp6(1),t.Q6J("queryParams",t.VKq(2,G,a.yamcs.context)),t.xp6(1),t.Q6J("ngForOf",e)}}function js(n,i){if(1&n&&(t.ynx(0),t.YNc(1,Rs,3,4,"app-breadcrumb-trail",6),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("ngIf",e.length)}}function Vs(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"input",32),t.NdJ("change",function(o){t.CHM(e);const c=t.oxw(3);return o?c.masterToggle():null}),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("checked",e.selection.hasValue()&&e.isAllSelected())}}function Gs(n,i){if(1&n&&(t.TgZ(0,"th",30),t.YNc(1,Vs,1,1,"input",31),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.mayManageStacks())}}function Ws(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"input",35),t.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){t.CHM(e);const c=t.oxw().$implicit,s=t.oxw(2);return o?s.selection.toggle(c):null}),t.qZA()}if(2&n){const e=t.oxw().$implicit,a=t.oxw(2);t.Q6J("checked",a.selection.isSelected(e))}}function zs(n,i){if(1&n&&(t.TgZ(0,"td",33),t.YNc(1,Ws,1,1,"input",34),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.mayManageStacks())}}function Xs(n,i){1&n&&(t.TgZ(0,"th",36),t._uU(1,"Name"),t.qZA())}function Ks(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",38),t._uU(2,"folder"),t.qZA(),t.TgZ(3,"a",39),t.NdJ("click",function(a){return a.stopPropagation()}),t._uU(4),t.ALo(5,"filename"),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit,a=t.oxw(2);t.xp6(3),t.Q6J("routerLink","/commanding/stacks/browse/"+e.nameWithoutInstance)("queryParams",t.VKq(5,G,a.yamcs.context)),t.xp6(1),t.hij(" ",t.lcZ(5,3,e.name)," ")}}function tl(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"mat-icon",38),t._uU(2,"description"),t.qZA(),t.TgZ(3,"a",39),t.NdJ("click",function(a){return a.stopPropagation()}),t._uU(4),t.ALo(5,"basename"),t.ALo(6,"filename"),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit,a=t.oxw(2);t.xp6(3),t.Q6J("routerLink","/commanding/stacks/files/"+e.nameWithoutInstance)("queryParams",t.VKq(7,G,a.yamcs.context)),t.xp6(1),t.hij(" ",t.lcZ(5,3,t.lcZ(6,5,e.name))," ")}}function el(n,i){if(1&n&&(t.TgZ(0,"td",37),t.YNc(1,Ks,6,7,"ng-container",6),t.YNc(2,tl,7,9,"ng-container",6),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf",e.folder),t.xp6(1),t.Q6J("ngIf",!e.folder)}}function nl(n,i){1&n&&(t.TgZ(0,"th",36),t._uU(1,"Visibility"),t.qZA())}function al(n,i){1&n&&(t.TgZ(0,"td",37),t._uU(1," Private "),t.qZA())}function il(n,i){1&n&&(t.TgZ(0,"th",36),t._uU(1,"Date modified"),t.qZA())}function ol(n,i){if(1&n&&(t.TgZ(0,"td",37),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&n){const e=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e.modified)||"-"," ")}}function cl(n,i){1&n&&t._UZ(0,"th",40)}function sl(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"app-more"),t.TgZ(1,"button",41),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(2).renameFile(o)}),t._uU(2," Rename "),t.qZA(),t.TgZ(3,"a",42),t._uU(4," Download "),t.qZA(),t._UZ(5,"mat-divider"),t.TgZ(6,"button",41),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(2).deleteFile(o)}),t._uU(7," Delete "),t.qZA(),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.xp6(3),t.Q6J("href",e.objectUrl,t.LSH)}}function ll(n,i){if(1&n&&(t.TgZ(0,"td",37),t.YNc(1,sl,8,1,"app-more",6),t.qZA()),2&n){const e=i.$implicit,a=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!e.folder&&a.mayManageStacks())}}function rl(n,i){1&n&&t._UZ(0,"tr",43)}function ml(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"tr",44),t.NdJ("click",function(){const c=t.CHM(e).$implicit;return t.oxw(2).toggleOne(c)}),t.qZA()}if(2&n){const e=i.$implicit,a=t.oxw(2);t.ekj("selected",a.selection.isSelected(e))}}function ul(n,i){if(1&n&&(t.TgZ(0,"table",16),t.ynx(1,17),t.YNc(2,Gs,2,1,"th",18),t.YNc(3,zs,2,1,"td",19),t.BQk(),t.ynx(4,20),t.YNc(5,Xs,2,0,"th",21),t.YNc(6,el,3,2,"td",22),t.BQk(),t.ynx(7,23),t.YNc(8,nl,2,0,"th",21),t.YNc(9,al,2,0,"td",22),t.BQk(),t.ynx(10,24),t.YNc(11,il,2,0,"th",21),t.YNc(12,ol,3,3,"td",22),t.BQk(),t.ynx(13,25),t.YNc(14,cl,1,0,"th",26),t.YNc(15,ll,2,1,"td",27),t.BQk(),t.YNc(16,rl,1,0,"tr",28),t.YNc(17,ml,1,2,"tr",29),t.qZA()),2&n){const e=t.oxw();t.Q6J("dataSource",e.dataSource),t.xp6(16),t.Q6J("cdkHeaderRowDef",e.displayedColumns),t.xp6(1),t.Q6J("cdkRowDefColumns",e.displayedColumns)}}function dl(n,i){1&n&&(t.TgZ(0,"app-empty-message"),t._uU(1," Empty directory. "),t.qZA())}function _l(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"p"),t.TgZ(1,"button",47),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).createStack()}),t._uU(2,"Create a stack"),t.qZA(),t._uU(3," or "),t.TgZ(4,"button",48),t.NdJ("click",function(){return t.CHM(e),t.oxw(4).importStack()}),t._uU(5,"Import a stack"),t.qZA(),t.qZA()}}function pl(n,i){if(1&n&&(t.TgZ(0,"app-empty-message",46),t.TgZ(1,"p"),t._uU(2," Command stacks are used to interactively execute a prepared set of commands. To start, either: "),t.qZA(),t.YNc(3,_l,6,0,"p",6),t.qZA()),2&n){const e=t.oxw(3);t.xp6(3),t.Q6J("ngIf",e.mayManageStacks())}}function gl(n,i){if(1&n&&(t.ynx(0),t.YNc(1,dl,2,0,"app-empty-message",6),t.YNc(2,pl,4,1,"app-empty-message",45),t.BQk()),2&n){const e=i.ngIf;t.xp6(1),t.Q6J("ngIf",e.length),t.xp6(1),t.Q6J("ngIf",!e.length)}}function fl(n,i){if(1&n&&(t.YNc(0,gl,3,2,"ng-container",6),t.ALo(1,"async")),2&n){const e=t.oxw();t.Q6J("ngIf",t.lcZ(1,1,e.breadcrumb$))}}let ee=(()=>{class n{constructor(e,a,o,c,s,u,_,f){this.dialog=e,this.yamcs=a,this.router=c,this.route=s,this.authService=u,this.messageService=_,this.breadcrumb$=new T.X([]),this.dragActive$=new T.X(!1),this.displayedColumns=["select","name","modified","actions"],this.dataSource=new r.by([]),this.selection=new M.Ov(!0,[]),o.setTitle("Stacks"),this.storageClient=a.createStorageClient(),this.folderPerInstance=f.getConfig().stackFolderPerInstance,this.loadCurrentFolder(),this.routerSubscription=c.events.pipe((0,Qs.h)(p=>p instanceof h.m2)).subscribe(()=>{this.loadCurrentFolder()})}loadCurrentFolder(){const e={delimiter:"/"};let a="";this.folderPerInstance&&(a=this.yamcs.instance+"/");const o=this.route.snapshot.url;o.length?e.prefix=a+o.map(c=>c.path).join("/")+"/":a&&(e.prefix=a),this.storageClient.listObjects("_global","stacks",e).then(c=>{this.updateBrowsePath(),this.changedir(c)})}getNameWithoutInstance(e){return this.folderPerInstance?e.substr(this.yamcs.instance.length):e}changedir(e){this.selection.clear();const a=[];for(const o of e.prefixes||[])a.push({folder:!0,name:o,nameWithoutInstance:this.getNameWithoutInstance(o)});for(const o of e.objects||[])o.name.endsWith("/")||a.push({folder:!1,name:o.name,nameWithoutInstance:this.getNameWithoutInstance(o.name),modified:o.created,objectUrl:this.storageClient.getObjectURL("_global","stacks",o.name)});this.dataSource.data=a}isAllSelected(){const a=this.dataSource.data.length;return this.selection.selected.length===a&&a>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(e=>this.selection.select(e))}toggleOne(e){(!this.selection.isSelected(e)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(e)}createStack(){this.dialog.open(Js,{width:"400px",data:{path:this.getCurrentPath(),prefix:this.folderPerInstance?this.yamcs.instance+"/":""}}).afterClosed().subscribe(a=>{a&&this.router.navigateByUrl(`/commanding/stacks/files/${a}?c=${this.yamcs.context}`)})}createFolder(){this.dialog.open(Is,{width:"400px",data:{bucketInstance:"_global",bucket:"stacks",path:this.getCurrentPath()}}).afterClosed().subscribe({next:()=>this.loadCurrentFolder()})}importStack(){let e=this.getCurrentPath();e.startsWith("/")&&(e=e.substring(1));const a=this.uploaderEl.nativeElement.files,o=[];for(const c in a)if(!isNaN(parseInt(c,10))){const s=a[c],p=this.storageClient.uploadObject("_global","stacks",(this.folderPerInstance?this.yamcs.instance+"/":"")+(e?e+"/"+s.name:s.name),s);o.push(p)}Promise.all(o).then(()=>this.loadCurrentFolder()).catch(c=>this.messageService.showError(c))}getCurrentPath(){let e="";for(const a of this.route.snapshot.url)e+="/"+a.path;return e||"/"}deleteSelectedStacks(){const e=[],a=[];for(const o of this.selection.selected)o.folder?a.push(this.storageClient.listObjects("_global","stacks",{prefix:o.name}).then(c=>{e.push(...(c.objects||[]).map(u=>u.name))})):e.push(o.name);Promise.all(a).then(()=>{if(confirm(`You are about to delete ${e.length} files. Are you sure you want to continue?`)){const o=[];for(const c of e)o.push(this.storageClient.deleteObject("_global","stacks",c));Promise.all(o).then(()=>{this.loadCurrentFolder()})}})}renameFile(e){this.dialog.open(Ys,{data:{name:e.name},width:"400px"}).afterClosed().subscribe(o=>{o&&this.loadCurrentFolder()})}deleteFile(e){confirm(`Are you sure you want to delete ${e.nameWithoutInstance}?`)&&this.storageClient.deleteObject("_global","stacks",e.name).then(()=>{this.loadCurrentFolder()})}dragEnter(e){return this.dragActive$.next(!0),e.preventDefault(),e.stopPropagation(),!1}dragOver(e){return e.preventDefault(),e.stopPropagation(),!1}dragLeave(e){return this.dragActive$.next(!1),e.preventDefault(),e.stopPropagation(),!1}drop(e){const a=e.dataTransfer||{};if(a){let o=this.getCurrentPath().substring(1);""!==o&&(o+="/"),Ps.v(a).then(c=>{const s=[];for(const u of c){let _=o+u._fullPath;this.folderPerInstance&&(_=this.yamcs.instance+"/"+_);const f=this.storageClient.uploadObject("_global","stacks",_,u);s.push(f)}Promise.all(s).finally(()=>{this.loadCurrentFolder()})})}return this.dragActive$.next(!1),e.preventDefault(),e.stopPropagation(),!1}mayManageStacks(){const e=this.authService.getUser();return e.hasObjectPrivilege("ManageBucket","stacks")||e.hasSystemPrivilege("ManageAnyBucket")}updateBrowsePath(){const e=[];let a="";for(const o of this.route.snapshot.url)a+="/"+o.path,e.push({name:o.path,route:"/commanding/stacks/browse"+a});return this.breadcrumb$.next(e),a||"/"}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.uw),t.Y36(y.C),t.Y36(k.Dx),t.Y36(h.F0),t.Y36(h.gz),t.Y36(E.e),t.Y36(I.e),t.Y36(D.E))},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(e,a){if(1&e&&(t.Gf(Fs,7),t.Gf(Ms,5)),2&e){let o;t.iGM(o=t.CRH())&&(a.dropArea=o.first),t.iGM(o=t.CRH())&&(a.uploaderEl=o.first)}},decls:18,vars:17,consts:[["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],[1,"droparea",3,"dragenter"],["droparea",""],[1,"droparea-overlay",3,"dragover","dragleave","drop"],[1,"panel-content"],[4,"ngIf"],["mat-table","","class","ya-data-table expand",3,"dataSource",4,"ngIf","ngIfElse"],["empty",""],["mat-button","","color","primary",3,"click"],["type","file","hidden","","accept",".xml","multiple","",3,"change"],["uploader",""],["mat-button","","color","primary",3,"disabled","click"],["link","/commanding/stacks/browse","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label",4,"ngFor","ngForOf"],[3,"link","queryParams","label"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","visibility"],["cdkColumnDef","modified"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change",4,"ngIf"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change",4,"ngIf"],["type","checkbox",3,"checked","click","change"],["mat-header-cell",""],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","queryParams","click"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","","download","",3,"href"],["mat-header-row",""],["mat-row","",3,"click"],["headerTitle","Command Stacks",4,"ngIf"],["headerTitle","Command Stacks"],[1,"ya-button","primary",3,"click"],[1,"ya-button",3,"click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"app-instance-page"),t.TgZ(1,"app-instance-toolbar"),t._uU(2," Command Stacks \xa0\xa0\xa0 "),t.YNc(3,$s,4,0,"button",0),t.YNc(4,Es,6,0,"button",0),t.YNc(5,Ls,4,0,"button",0),t.YNc(6,Hs,4,1,"button",1),t.qZA(),t.TgZ(7,"div",2,3),t.NdJ("dragenter",function(c){return a.dragEnter(c)}),t.ALo(9,"async"),t.TgZ(10,"div",4),t.NdJ("dragover",function(c){return a.dragOver(c)})("dragleave",function(c){return a.dragLeave(c)})("drop",function(c){return a.drop(c)}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"div",5),t.YNc(13,js,2,1,"ng-container",6),t.ALo(14,"async"),t.YNc(15,ul,18,3,"table",7),t.YNc(16,fl,2,3,"ng-template",null,8,t.W1O),t.qZA(),t.qZA(),t.qZA()),2&e){const o=t.MAs(17);t.xp6(3),t.Q6J("ngIf",a.mayManageStacks()),t.xp6(1),t.Q6J("ngIf",a.mayManageStacks()),t.xp6(1),t.Q6J("ngIf",a.mayManageStacks()),t.xp6(1),t.Q6J("ngIf",a.mayManageStacks()),t.xp6(1),t.ekj("active",t.lcZ(9,11,a.dragActive$)),t.xp6(3),t.ekj("hide",!t.lcZ(11,13,a.dragActive$)),t.xp6(3),t.Q6J("ngIf",t.lcZ(14,15,a.breadcrumb$)),t.xp6(2),t.Q6J("ngIf",a.dataSource&&a.dataSource.data.length)("ngIfElse",o)}},directives:[A.a,S.k,d.O5,$.lW,v.Hw,Et.w,Lt.a,d.sg,r.BZ,b.fo,b.D5,r.ge,b.O_,r.ev,h.yS,r.w1,r.fO,r.Dz,at.T,q.OP,U.d,b.s$,r.XQ,b.Sq,r.Gk,lt.M],pipes:[d.Ov,Ht.X,rt.u,N.i],styles:[".droparea[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:auto}.droparea-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box;background:rgba(27,97,185,.1);border:1px solid rgba(27,97,185,1);z-index:10}"],changeDetection:0}),n})(),ne=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,a){1&e&&t._UZ(0,"router-outlet")},directives:[h.lC],encapsulation:2,changeDetection:0}),n})();const hl=[{path:"",canActivate:[pt.a,ce.z],canActivateChild:[pt.a],runGuardsAndResolvers:"always",component:le.K,children:[{path:"clearances",canActivate:[be],children:[{path:"",pathMatch:"full",component:Tt},{path:"log",component:xt}]},{path:"send",pathMatch:"full",component:Rt},{path:"send/:qualifiedName",component:$t},{path:"report/:commandId",component:Pt},{path:"history",component:Qt},{path:"queues",component:Wt,canActivate:[se.k],children:[{path:"",pathMatch:"full",redirectTo:"pending"},{path:"pending",component:Vt},{path:"log",component:jt}]},{path:"stacks",pathMatch:"full",redirectTo:"stacks/browse"},{path:"stacks/browse",component:(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,a){1&e&&t._UZ(0,"router-outlet")},directives:[h.lC],encapsulation:2,changeDetection:0}),n})(),children:[{path:"**",component:ee}]},{path:"stacks/files",component:ne,children:[{path:"**",component:Xt,canDeactivate:[te]}]}]}];let xl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[te],imports:[[h.Bz.forChild(hl)],h.Bz]}),n})(),Tl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[oe.m,xl]]}),n})()}}]);